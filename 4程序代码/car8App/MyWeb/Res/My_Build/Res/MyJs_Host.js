jv.FindNotTempDialogSrc=function(c){var b,a=jv.boxdy(c);if(a.length==1){return c}a.each(function(){var d=$(this);if(!d.data("boxy")){return true}if(d.data("boxy").options.tempDialog){b=d.data("srcForBoxy");return false}else{return false}});if(b){return b}else{return c}};function Boxy(b,a){this.boxy=jQuery(Boxy.WRAPPER);jQuery.data(this.boxy[0],"boxy",this);this.visible=false;this.options=jQuery.extend({},Boxy.DEFAULTS,a||{});this.options.unloadOnHide=true;if(this.options.modal){this.options=jQuery.extend(this.options,{center:true})}if(this.options.actuator){jQuery.data(this.options.actuator,"active.boxy",this)}if(a.width){this.boxy.find(".boxy-inner").width(a.width)}if(a.height){this.boxy.find(".boxy-inner").height(a.height)}this.setContent(b||"<div></div>");this._setupTitleBar();this.boxy.css("display","none").appendTo(document.body);this.options.tempDialog=true;this.boxy.addClass("jvRequest_waite").data("srcForBoxy",jv.FindNotTempDialogSrc(jv.GetDoer()));jv.AddRequest({boxy:this.boxy});this.toTop();this.center();if(this.options.show){this.show()}}Boxy.EF=function(){};jQuery.extend(Boxy,{WRAPPER:"<div class='boxy-wrapper'><div class='boxy-inner'></div></div>",DEFAULTS:{opacity:0.5,title:null,closeable:true,draggable:true,clone:false,actuator:null,center:true,hideAnimateTime:0,show:true,modal:false,fixed:true,closeText:"关闭",closeButton:false,unloadOnHide:true,clickToFront:false,behaviours:Boxy.EF,afterDrop:Boxy.EF,afterShow:Boxy.EF,beforeHide:Boxy.EF,afterHide:Boxy.EF,beforeUnload:Boxy.EF,afterUnload:Boxy.EF},DEFAULT_X:50,DEFAULT_Y:50,dragConfigured:false,resizeConfigured:false,dragging:null,load:function(){var d,c,b,g;if(arguments.length>1){d=arguments[0];c=arguments[1];b=arguments[2];g=arguments[3];c.url=d;c.LoadedCallBack=b;c.ReturnCallback=g}else{c=arguments[0];d=c.url;b=c.LoadedCallBack;g=c.ReturnCallback}c=c||{};c.unloadOnHide=true;c.url=d;c.ReturnCallback=g;if(!("width" in c)){c.width=701}var a=new Boxy($("<div><div class='loading'>加载中</div></div>"),$.extend({},c,{width:false,height:false}));if(!d){if(b){b(a)}return a}if(c.iframe){window._BoxyIframeLoad_=function(){b(a,a.boxy.find("iframe")[0].contentDocument)};var e=Boxy._viewport(c);a.moveToX(-3000).moveToY(-3000);a.setContent('<iframe src="'+d+'" style="padding:0px;margin:0px;border-width:0px;width:100%;height:99.9%;" onload="window._BoxyIframeLoad_();"/>',c);a.getContent().width(c.width||e.suitWidth).height(c.height||e.suitHeight).css("maxHeight",e.height+"px");a.center();return a}a.boxy.addClass("jvRequest_waite");var f={url:d,type:"GET",dataType:"html",cache:false,beforeSend:function(h){jv.CreateEventSource(h,a.boxy[0]);h.setRequestHeader("MyTitle","Json")},success:function(i){if(jv.HasValue(i)==false){a.options.loaderror=true;a.boxy.find(".boxy-content>div").html("<label style='color:red'>没有内容！</label>");return}else{if(i.charAt(0)=="{"){var h=null;try{h=$.parseJSON(i)}catch(l){}if(jv.IsNull(h)==false&&h.data=="power"){a.options.loaderror=true;var m="<div style='color:red'>"+h.msg+"</div><br /> 请联系管理员！";a.setContent($("<div style='padding:20px'>"+m+"</div>"),c);a.center();return}}}if(c.loading){c.loading(a)}a.options.tempDialog=false;i=$(i);var k=jv.myFilter(i,c.filter);var j=Boxy._viewport(c);a.moveToX(-3000).moveToY(-3000);a.setContent(k,c);a.getContent().width(j.suitWidth).height(j.suitHeight).css("maxHeight",j.height+"px");if(b){b(a)}jv.execHtml(i,null,a.boxy[0]);a.center();jv.page().boxy=a.boxy},error:function(h){a.options.loaderror=true;var j=jv.getErrorFromPage(h.responseText)||"服务器出现错误!";var i=j.indexOf("登录");if(i>=0){j=j.slice(0,i)+'<a class="Link" onclick="javascript:top.document.location='+(jv.url().root)+'Login.aspx"> 登录 </a>'+j.slice(i+2)}var j='<div><div class="question" style="color:red"><div class="icon error" /> <p class="Wrap">'+j+'</p></div><div class="answers">请检查数据正确性,或联系运维管理员.</div></div>';a.setContent(j,c);a.center()}};jQuery.each(["type","cache"],function(){if(this in c){f[this]=c[this];delete c[this]}});jQuery.ajax(f)},get:function(a){var b=jQuery(a);if(!b.hasClass("boxy-wrapper")){b=b.parents(".boxy-wrapper:first")}return b.length?jQuery.data(b[0],"boxy"):null},getOne:function(b){var d=0,c=null;if(!b){b=window}var a=$(".boxy-wrapper");a.each(function(){if(this.style.display=="none"){return}var e=$(this);if(e.css("zIndex")>d){if(e.hasClass("Ignore")){return true}d=e.css("zIndex");c=this}});if(c){return jQuery.data(c,"boxy")}else{if(b.parent&&b!=b.parent){return Boxy.getOne(b.parent)}}return null},linkedTo:function(a){return jQuery.data(a,"active.boxy")},alert:function(b,c,a){return Boxy.ask(b,["OK"],c,$.extend({title:"!"},a))},msg:function(c,b,e,a){var d=Boxy.ask(c,["OK"],e,a);if(parseInt(b)>0){setTimeout(function(){d.hide()},parseInt(b))}return d},confirm:function(b,c,a){return Boxy.ask(b,["OK","Cancel"],function(d){if(d=="OK"){c()}},a)},ask:function(a,c,d,b){return Boxy.html('<div class="question">'+a+"</div>",c,d,b)},html:function(b,e,i,j){j=jQuery.extend({modal:true,closeable:true,title:"?"},j||{},{show:true,unloadOnHide:true,center:true});var f="";if(jv.getType(b)=="string"){f=b}else{if(b instanceof jQuery){b.each(function(){f+=this.outerHTML})}else{f+=b.outerHTML}}var c="<div>"+f+"<div class='answers'>";if($.isArray(e)){var a={};$(e).each(function(k,l){a[l]=l});e=a}var g=[];for(var h in e){c+=" <input type='button' value='{0}' class='button' {1}/>".format(e[h],e[h]==h?"":"data='{0}'".format(h))}c+="</div></div>";var d=new Boxy(c,j);$("input[type=button]",d.boxy).each(function(k,l){$(l).bind("click",{bxy:d},function(n){var m=this;if(i){i(m.data||m.value,n.data.bxy,n)}n.data.bxy.hide()})});$("input[type=button]:first",d.boxy).focus();return d},isModalVisible:function(){return jQuery(".boxy-modal-blackout").length>0},_u:function(){for(var b=0,a=arguments.length;b<a;b++){if(typeof arguments[b]!="undefined"){return false}}return true},_handleDrag:function(a){var b;if(b=Boxy.dragging){b[0].boxy.css({left:a.pageX-b[1],top:a.pageY-b[2]})}},_nextZ:function(){if(!jv.zIndex){jv.zIndex=1337}return ++jv.zIndex},_viewport:function(b){var d=jv.getEyeSize();if(b){var a,c;d.width-=60;d.height-=80;if(b.width=="auto"||!b.width){a="auto"}else{if(b.width<0){a=Math.min(d.width+b.width*2,d.width)}else{a=Math.min(b.width,d.width)}}if(b.height=="auto"||!b.height){c="auto"}else{if(b.height<0){c=Math.min(d.height+b.height*2,d.height)}else{c=Math.min(b.height,d.height)}}d.suitWidth=a;d.suitHeight=c}return d}});Boxy.prototype={estimateSize:function(){this.boxy.css({visibility:"hidden",display:"block"});var a=this.getSize();this.boxy.css("display","none").css("visibility","visible");return a},getSize:function(){return[this.boxy.width(),this.boxy.height()]},getPosition:function(){var a=this.boxy[0];return[a.offsetLeft,a.offsetTop]},getCenter:function(){var b=this.getPosition(),a=this.getSize();return[Math.floor(b[0]+a[0]/2),Math.floor(b[1]+a[1]/2)]},getInner:function(){return jQuery(".boxy-inner",this.boxy)},getContent:function(){return jQuery(".boxy-content",this.boxy)},setContent:function(a){if(a.jquery&&a.html){a=a.html()}a=jQuery(a);if(this.options.clone){a=a.clone(true)}var b=this.getContent();if(b.length){b.empty().append(a)}else{this.getInner().append("<div class='boxy-content' style='display:block'></div>");this.getContent().append(a)}this._setupDefaultBehaviours(a);this.options.behaviours.call(this,a);return this},moveTo:function(a,b){this.moveToX(a).moveToY(b);return this},moveToX:function(a){if(typeof a=="number"){this.boxy.css({left:a})}else{this.centerX()}return this},moveToY:function(a){if(typeof a=="number"){this.boxy.css({top:a})}else{this.centerY()}return this},centerAt:function(a,c){var b=this[this.visible?"getSize":"estimateSize"]();if(typeof a=="number"){this.moveToX((a-b[0]/2-8<0)?0:(a-b[0]/2-8))}if(typeof c=="number"){this.moveToY((c-b[1]/2<0)?0:(c-b[1]/2))}return this},centerAtX:function(a){return this.centerAt(a,null)},centerAtY:function(a){return this.centerAt(null,a)},center:function(b){this.moveTo(0,0);if(this.options.center){var a=jv.getEyeSize();if(!b||b=="x"){this.centerAt(a.width/2,null)}if(!b||b=="y"){this.centerAt(null,a.height/2)}}else{this.moveTo(Boxy._u(this.options.x)?this.options.x:Boxy.DEFAULT_X,Boxy._u(this.options.y)?this.options.y:Boxy.DEFAULT_Y)}return this},centerX:function(){return this.center("x")},centerY:function(){return this.center("y")},resize:function(b,a,d){if(!this.visible){return}if(b>0){this.getContent().css("width",b)}var c=this._getBoundsForResize(b,a);this.boxy.css({left:c[0],top:c[1]||0});if(c[3]>0){this.getContent().css("height",c[3])}if(d){d(this)}return this},tween:function(c,a,e){if(!this.visible){return}var d=this._getBoundsForResize(c,a),b=this;this.boxy.stop().animate({left:d[0],top:d[1]});this.getContent().stop().animate({width:d[2],height:d[3]},function(){if(e){e(b)}});return this},isVisible:function(){return this.visible},show:function(){if(this.visible){return}if(this.options.modal){var a=this;this.modalBlackout=jQuery('<div class="boxy-modal-blackout"></div>').css({zIndex:Boxy._nextZ()}).appendTo(document.body);this.toTop();if(this.options.closeable){jQuery(document.body).bind("keypress.boxy",function(b){})}}this.boxy.stop().css({opacity:1}).css("filter","").show();this.visible=true;this._fire("afterShow");this.boxy.bind("resize",function(b){Boxy.get(this).center()});return this},hide:function(e){var b=$(document).data("oriPos");if(false&&top.document!=document&&b&&b.obj==this){$(window.frameElement).width(0).height(0).css("position",b.positon).offset({top:Math.ceil(b.offset.top),left:Math.ceil(b.offset.left)}).width(b.size.width).height(b.size.height);$(document).removeData("oriPos")}if(!this.visible){return}var a=this;if(a._fire("beforeHide")==false){return false}jv.UnloadRequest();var d={originalEvent:true,target:jv.boxdy().data("srcForBoxy")};var c=function(){a.boxy.css({display:"none"});a.visible=false;a._fire("afterHide");if(a.options.modal){jQuery(document.body).unbind("keypress.boxy");if(a.options.hideAnimateTime){a.modalBlackout.animate({opacity:0},a.options.hideAnimateTime,function(){jQuery(this).remove()})}else{jQuery(a.modalBlackout).remove()}}if(a.options&&a.options.unloadOnHide){a.unload()}if(a.options.ReturnCallback){var f=a.ReturnValue;if($.isFunction(f)){f=f()}a.options.ReturnCallback(f,d)}if(e){e(a,d)}};if(a.options.hideAnimateTime){this.boxy.stop().animate({opacity:0},a.options.hideAnimateTime,c)}else{c()}return this},toggle:function(){this[this.visible?"hide":"show"]();return this},hideAndUnload:function(a){this.options.unloadOnHide=true;this.hide(a);return this},unload:function(){this._fire("beforeUnload");var a=this.boxy.find(".boxy-inner .boxy-content");this.boxy.remove();if(this.options.actuator){jQuery.data(this.options.actuator,"active.boxy",false)}this._fire("afterUnload")},toTop:function(){this.boxy.css({zIndex:Boxy._nextZ()});return this},getTitle:function(){return jQuery("> .title-bar h2",this.getInner()).html()},setTitle:function(a){jQuery("> .title-bar h2",this.getInner()).html(a);return this},_getBoundsForResize:function(f,b){var a=b,c=this.getContent(),d=[c.width(),c.innerHeight()];if(!f){f=d[0]}if(!b){b=d[1]}var e=document.documentElement.clientHeight-80;if(b>e){a=b=e}var h=[f-d[0],b-d[1]],g=this.getPosition();return[Math.max(g[0]-h[0]/2,0),Math.max(g[1]-h[1]/2,0),f,a]},_setupTitleBar:function(){if(this.options.title!==false){var b=this,a=jQuery("<div class='title-bar'><span class='title'>"+this.options.title+"</span><span class='BoxyTool'></span></div>"),c=a.find(".BoxyTool");c.bind("mousedown",function(d){d.stopPropagation()});if(this.options.closeable){$('<div class="close button view"></div>').appendTo(a)}if(this.options.draggable){a[0].onselectstart=function(){return false};a[0].unselectable="on";a[0].style.MozUserSelect="none";if(!Boxy.dragConfigured){jQuery(document).mousemove(Boxy._handleDrag);Boxy.dragConfigured=true}a.mousedown(function(d){$(document).bind("selectstart.boxy",function(){return false});b.toTop();Boxy.dragging=[b,d.pageX-b.boxy[0].offsetLeft,d.pageY-b.boxy[0].offsetTop];jQuery(this).addClass("dragging")}).mouseup(function(){$(document).unbind("selectstart.boxy");jQuery(this).removeClass("dragging");Boxy.dragging=null;b._fire("afterDrop")})}this.getInner().prepend(a);this._setupDefaultBehaviours(a)}},_setupDefaultBehaviours:function(a){var b=this;if(this.options.clickToFront){a.click(function(){b.toTop()})}jQuery(".close",a).click(function(){if(b.options.closeButton){var c=b.options.closeButton;if($.isFunction(c)){var d=c(b.boxy);d.data("defBtned",true).trigger("click")}}b.hide();$(document.body).trigger("click");return}).mousedown(function(c){$(document).click();c.stopPropagation()})},_fire:function(a){return this.options[a].call(this)}};(function(a){jv.CssHasBorderRadius=(typeof(document.createElement("div").style.borderRadius)=="string");jv.CssHasBoxShadow=(typeof(document.createElement("div").style.boxShadow)=="string");a.fn.TextHelper=function(b){var e={beforeClickInput:false,callback:false,change:false,changeCallback:false,clear:"清除",checkByKey:true,checkByVal:false,click:false,clickCallback:false,confirm:"确定",data:{},display:false,hideCallback:false,loadData:true,post:"none",quote:"radio",postCallback:false,renderCallback:false,require:true,selectIndex:null,selectValue:null,triggerEvent:"mousedown",url:"",useSelect:(jv.csm?false:false),width:0},c=this;e=a.extend(e,b);if(e.callback&&!e.postCallback){e.postCallback=e.callback}if(e.change&&!e.changeCallback){e.changeCallback=e.change}if(e.click&&!e.clickCallback){e.clickCallback=e.click}if(!e.require){e.clear=false;e.confirm=false}e.post=e.post||"none";var f=function(r,q,j){if(!r){return r}if(r.tagName.toLowerCase()=="select"){return r}var t=a(r);var u=[];for(var s in t[0].attributes){var o=t[0].attributes[s];if(!o){continue}if(o.name=="type"){continue}else{if(o.name=="size"){continue}else{if(o.nodeValue===false){continue}else{if(o.nodeValue===null){continue}else{if(o.name=="readonly"){continue}else{if(a.isFunction(o.value)){continue}}}}}}if(o.name&&o.value){u.push(o.name+'="'+o.value+'"')}}var n=t.val();var k=t.hide().after("<select {0}></select>".format(u.join(" "))).next();t.remove();if(!j.require){k[0].options.add(new Option("",""))}if(j.changeCallback){k.bind("change",function(g){j.changeCallback(k.val(),k,g)})}if(j.clickCallback){k.bind("change",function(g){j.clickCallback(k.val(),k,g)})}if(j.data){for(var m=0;m<j.data.length;m++){var l=j.data[m];k[0].options.add(new Option(l.val,l.key));if(n&&(n==l.key||n==l.val)){k[0].selectedIndex=k[0].length-1}else{if(!n&&j.selectValue){if(l.key==j.selectValue){k[0].selectedIndex=k[0].length-1}}}}if(!n&&!jv.IsNull(j.selectIndex)){k[0].selectedIndex=j.selectIndex;k.trigger("change")}}if(j.url){var h=function(){a.ajax({url:a.isFunction(j.url)?j.url():j.url,data:{},type:"post",success:function(v){v=q.tidyData(v);j.data=v;if(j.postCallback){var g=j.postCallback(v);if(g===false){return false}else{if(jv.HasValue(g)){v=g}}}for(var p=0;p<j.data.length;p++){var w=j.data[p];k[0].options.add(new Option(w.val,w.key));if(n&&(n==w.key||n==w.val)){k[0].selectedIndex=k[0].length-1}else{if(!n&&j.selectValue){if(w.key==j.selectValue){k[0].selectedIndex=k[0].length-1}}}}if(!n&&!jv.IsNull(j.selectIndex)){k[0].selectedIndex=j.selectIndex;k.trigger("change")}if(j.renderCallback){j.renderCallback(k[0])}}})};if(j.loadData){h()}else{k.one("focus",h)}}return k};var d=a();this.UnTextHelper().addClass("TextHelperInput").each(function(o,h){var j=h.name||h.id,n={},i,m,p,l;if(!j){h.id=Math.random().toString(16).slice(2);j=h.id}var n={id:j,p:e,divId:j+"_Div_"+Math.random().toString(16).slice(2),init:function(){h.name="";i=a(h);m=i.next("input[type=hidden]");if(m.attr("name")!=j){m=a('<input type="hidden" name="{0}" />'.format(j))}if(e.selectValue&&!i.val()){i.val(e.selectValue)}m=m.val(i.val());i.after(m).attr("autocomplete","off");l=a("#"+n.divId,jv.boxdy());if(l.length){l.html("")}else{a('<div class="TextHelperWrap"><div id="'+n.divId+'"  class="TextHelper"></div></div>').appendTo(jv.boxdy(h,document.body))}if(!l.length){l=a("#"+n.divId,jv.boxdy())}p=l.parent().hide();p.add(i).click(function(g){g.stopPropagation()})},tidyData:function(s){var u=[];if(typeof(s)=="string"){var t=s.split(",");a(t).each(function(w,y){var x=y.split(":");u.push({key:x[0],val:x[1]||x[0]})});return u}if(a.isPlainObject(s)){for(var v in s){if(!v&&(v!=0)){continue}if(a.isFunction(s[v])){continue}u.push({key:v,val:s[v]})}}else{if(a.isArray(s)){for(var g=0,r=s.length;g<r;g++){if((s[g].key||(s[g].key==0))&&(s[g].val||(s[g].val==0))){u.push(s[g]);continue}u.push({key:s[g],val:s[g]})}}}return u},getSelectValues:function(){var g=[],r=[];l.find(">span.check").each(function(s,t){g.push(a(t).text());r.push(a(t).attr("val"))});return{txts:g,vals:r}},displayCheck:function(){var r=[],g=[];r=i.val().split(",");g=m.val().split(",");l.find(">span").each(function(v,w){var s=a(this).attr("val").trim(),u=a(this).text().trim();if(a(this).hasClass("check")){var t=true;if(e.checkByKey&&g.indexOf(s)<0){t=false}if(!t){if(e.checkByVal){if(r.indexOf(u)<0){t=false}else{t=true}}}if(!t){a(this).removeClass("check")}}else{if(a(this).html()){if(e.checkByKey&&g.indexOf(s)>=0){a(this).addClass("check");return}if(e.checkByVal&&r.indexOf(u)>=0){a(this).addClass("check");return}}}})},spanClick:function(s,t){var g=a(s);if(!g.html()){return false}if(e.beforeClickInput){if(e.beforeClickInput(i)==false){return false}}if(e.quote=="radio"){var r=g.attr("val");if(m.val()!=r){m.val(r);i.val(g.text());i.trigger("change");if(e.changeCallback){e.changeCallback(r,i,t)}m.trigger("change");n.displayCheck()}if(e.clickCallback&&e.clickCallback(r,i,t)){}else{if(e.hideCallback){e.hideCallback(i,t)}else{p.hide()}}}else{g.toggleClass("check");var u=n.getSelectValues();i.val(u.txts.join(","));m.val(u.vals.join(","));i.trigger("change");if(e.changeCallback){e.changeCallback(u.vals.join(","),i,t)}if(e.clickCallback){e.clickCallback(u.vals.join(","),i,t)}m.trigger("change")}},loadDataToDiv:function(){l.find("span").remove();l.find("button").remove();var t=[],g=m.val();for(var s=0;s<e.data.length;s++){var u=e.data[s];t.push(a('<span val="'+u.key+'">'+jv.encode(u.val)+"</span>")[0]);if(e.quote=="radio"&&(g==u.key||g==u.val)){m.val(u.key);i.val(u.val)}}i.data("data",e.data);if(!e.data.length){return}if(e.quote=="check"){var r=[];a(g.split(",")).each(function(v,w){if(!w){return true}a(e.data).filter(function(y,x){return w==x.key||w==x.val}).each(function(y,x){r.push(x.val)})});if(r.length){i.val(r.join(","))}}a(t).each(function(v,w){a(w).appendTo(l).click(function(x){n.spanClick(w,x)})});if(e.quote=="check"&&e.confirm){a("<button></button").html(e.confirm).appendTo(l).bind("click",function(v){var w=n.getSelectValues();i.val(w.txts.join(","));m.val(w.vals.join(","));if(e.hideCallback){e.hideCallback(i,v)}else{p.hide()}n.displayCheck()})}else{if(e.quote=="radio"&&e.clear){a("<button></button").html(e.clear).appendTo(l).bind("click",function(v){if(m.val()){i.val("");m.val("");i.trigger("change");m.trigger("change");n.displayCheck()}if(e.changeCallback){e.changeCallback("",i,v)}if(e.hideCallback){e.hideCallback(i,v)}else{p.hide()}n.displayCheck()})}}n.displayCheck()},getValueFromInput:function(){var g=[],r=i.val();if(e.quote=="radio"){if(e.checkByKey){g=a(e.data).filter(function(s,t){return t.key==r}).each(function(s,t){return t.val}).toArray()}if(g.length){return g}else{return[r]}if(e.checkByVal){g=a(e.data).filter(function(s,t){return t.val==r}).each(function(s,t){return t.val}).toArray()}if(g.length){return g}else{return[r]}}else{r=r.split(",");if(e.checkByKey){a.merge(g,a(e.data).filter(function(s,t){return r.indexOf(t.key)>=0}).each(function(s,t){return t.val}).toArray())}if(e.checkByVal){a.merge(g,a(e.data).filter(function(s,t){return r.indexOf(t.key)>=0}).each(function(s,t){return t.val}).toArray())}return g}},txtClick:function(g,r){if(p.length==0){return}i.addClass("TextHelper_Loading");if(e.hideCallback){e.hideCallback(i,r)}else{p.hide()}if((e.post=="change"||e.post=="click")&&(p.find("span").length==0)){n.post(g?null:n.showMe)}else{if(!g){n.showMe()}}},bindDivClick:function(){i.keyup(function(g){var r=g.witch||g.keyCode;if(r==27){a(document).trigger("click");return}i.addClass("TextHelper_Loading");if(e.hideCallback){e.hideCallback(i,g)}else{p.hide()}n.displayCheck();var s=n.getValueFromInput().join(",");m.val(s);if(e.changeCallback){e.changeCallback(s,i,g)}if(e.post=="change"||(e.post=="click")){jv.RestartTimer("TextHelper",function(){if(this.die){return false}n.post(function(){n.showMe()})})}else{n.showMe();return}});i.bind(e.triggerEvent,function(g){n.txtClick(false,g)})},post:function(g){var r=jv.JsonValuer(e.paras||{});r.query=i.val();a.ajax({url:a.isFunction(e.url)?e.url():e.url,data:r,type:"post",success:function(t){i.removeClass("Error").removeClass("TextHelper_Loading");t=n.tidyData(t);e.data=t;if(e.postCallback){var s=e.postCallback(t);if(s===false){return false}else{if(jv.HasValue(s)){t=s}}}if(t){e.data=t;n.loadDataToDiv();if(g){g()}}if(!jv.IsNull(e.selectIndex)&&!i.val()){l.find(">span:eq("+e.selectIndex+")").trigger("click");e.selectIndex=null}if(e.renderCallback){e.renderCallback(h,l[0],e)}},error:function(s){i.removeClass("TextHelper_Loading");i.addClass("Error")}})},showMe:function(){if(i.attr("disabled")){return}if(e.hideCallback){e.hideCallback(i)}else{a(document).trigger("click")}n.displayCheck();i.smartPosition(p,e.width);i.removeClass("TextHelper_Loading");a(document).one("click",function(){p.hide()});return}};if(e.data){e.data=n.tidyData(e.data)}if(e.useSelect){d=d.add(f(h,n,e));return true}else{d=d.add(h)}n.init();n.loadDataToDiv();n.bindDivClick();e.display=e.display||a("#"+j,jv.boxdy()).attr("display");if(e.display){a("#"+j,jv.boxdy()).val(e.display)}if(!jv.IsNull(e.selectIndex)&&!i.val()){l.find(">span:eq("+e.selectIndex+")").trigger("click")}else{var q=l.find("span.check");var k=q.attr("val");if(k){if(e.changeCallback){e.changeCallback(k,i,{originalEvent:true,eventTarget:q[0]})}}}jv.RegisteUnload("TextHelper",function(){p.hide()});a("#"+j,jv.boxdy()).data("TextHelper",n);if(e.url&&e.loadData){n.txtClick(true,null)}});return d};a.fn.UnTextHelper=function(){var b=a();this.each(function(g,c){if(c.tagName.toLowerCase()=="select"){var m=a(c);var n=[];for(var l in m[0].attributes){var h=m[0].attributes[l];if(!h){continue}if(h.name=="type"){continue}else{if(h.nodeValue===false){continue}else{if(h.nodeValue===null){continue}else{if(h.name=="readonly"){continue}}}}if(h.name&&h.value){n.push(h.name+'="'+h.value+'"')}}var f=m.val();var k=m.after("<input {0} />".format(n.join(" "))).next();k.val(f);m.remove();b=b.add(k);return true}b=b.add(c);var e=a(c).data("TextHelper");if(!e){return true}var j=a("input[name="+e.id+"]",jv.boxdy());var f=j.val();j.remove();a("#"+e.divId,jv.boxdy()).remove();c.name=e.id;var d=a(c);d.val(f);d.unbind().data("TextHelper",false).removeAttr("display")});return b};a.fn.ClearTextHelperData=function(){this.each(function(d,b){var c=a(b).data("TextHelper");if(!c||!c.divId){return true}a("#"+c.divId).find("span").remove()});return this}})(jQuery);(function(e){var a=[],d=/^url\(["']?([^"'\)]*)["']?\);?$/i,c=/\.png$/i,b=e.browser.msie&&e.browser.version==6;function f(){e.each(a,function(){this.refresh(true)})}e(window).resize(f);e.Poshytip=function(h,g){this.$elm=e(h);this.opts=e.extend({},e.fn.poshytip.defaults,g);this.$tip=e(['<div class="',this.opts.className,'">','<div class="tip-inner tip-bg-image"></div>','<div class="tip-arrow tip-arrow-top tip-arrow-right tip-arrow-bottom tip-arrow-left"></div>',"</div>"].join(""));this.$arrow=this.$tip.find("div.tip-arrow");this.$inner=this.$tip.find("div.tip-inner");this.disabled=false;this.init()};e.Poshytip.prototype={init:function(){a.push(this);this.$elm.data("title.poshytip",this.$elm.attr("title")||"").data("poshytip",this);switch(this.opts.showOn){case"hover":this.$elm.bind({"mouseenter.poshytip":e.proxy(this.mouseenter,this),"mouseleave.poshytip":e.proxy(this.mouseleave,this)});if(this.opts.alignTo=="cursor"){this.$elm.bind("mousemove.poshytip",e.proxy(this.mousemove,this))}if(this.opts.allowTipHover){this.$tip.hover(e.proxy(this.clearTimeouts,this),e.proxy(this.hide,this))}break;case"focus":this.$elm.bind({"focus.poshytip":e.proxy(this.show,this),"blur.poshytip":e.proxy(this.hide,this)});break}},mouseenter:function(g){if(this.disabled){return true}this.clearTimeouts();this.$elm.attr("title","");this.showTimeout=setTimeout(e.proxy(this.show,this),this.opts.showTimeout)},mouseleave:function(){if(this.disabled){return true}this.clearTimeouts();this.$elm.attr("title",this.$elm.data("title.poshytip"));this.hideTimeout=setTimeout(e.proxy(this.hide,this),this.opts.hideTimeout)},mousemove:function(g){if(this.disabled){return true}this.eventX=g.pageX;this.eventY=g.pageY;if(this.opts.followCursor&&this.$tip.data("active")){this.calcPos();this.$tip.css({left:this.pos.l,top:this.pos.t});if(this.pos.arrow){this.$arrow[0].className="tip-arrow tip-arrow-"+this.pos.arrow}}},show:function(){if(this.disabled||this.$tip.data("active")){return}this.reset();this.update();this.display()},hide:function(){if(this.disabled||!this.$tip.data("active")){return}this.display(true)},reset:function(){this.$tip.queue([]).detach().css("visibility","hidden").data("active",false);this.$inner.find("*").poshytip("hide");if(this.opts.fade){this.$tip.css("opacity",this.opacity)}this.$arrow[0].className="tip-arrow tip-arrow-top tip-arrow-right tip-arrow-bottom tip-arrow-left"},update:function(i){if(this.disabled){return}var h=i!==undefined;if(h){if(!this.$tip.data("active")){return}}else{i=this.opts.content}this.$inner.contents().detach();var g=this;this.$inner.append(typeof i=="function"?i.call(this.$elm[0],function(j){g.update(j)}):i=="[title]"?this.$elm.data("title.poshytip"):i);this.refresh(h)},refresh:function(h){if(this.disabled){return}if(h){if(!this.$tip.data("active")){return}var k={left:this.$tip.css("left"),top:this.$tip.css("top")}}this.$tip.css({left:0,top:0}).appendTo(document.body);if(this.opacity===undefined){this.opacity=this.$tip.css("opacity")}var l=this.$tip.css("background-image").match(d),m=this.$arrow.css("background-image").match(d);if(l){var i=c.test(l[1]);if(b&&i){this.$tip.css("background-image","none");this.$inner.css({margin:0,border:0,padding:0});l=i=false}else{this.$tip.prepend('<table border="0" cellpadding="0" cellspacing="0"><tr><td class="tip-top tip-bg-image" colspan="2"><span></span></td><td class="tip-right tip-bg-image" rowspan="2"><span></span></td></tr><tr><td class="tip-left tip-bg-image" rowspan="2"><span></span></td><td></td></tr><tr><td class="tip-bottom tip-bg-image" colspan="2"><span></span></td></tr></table>').css({border:0,padding:0,"background-image":"none","background-color":"transparent"}).find(".tip-bg-image").css("background-image",'url("'+l[1]+'")').end().find("td").eq(3).append(this.$inner)}if(i&&!e.support.opacity){this.opts.fade=false}}if(m&&!e.support.opacity){if(b&&c.test(m[1])){m=false;this.$arrow.css("background-image","none")}this.opts.fade=false}var o=this.$tip.find("table");if(b){this.$tip[0].style.width="";o.width("auto").find("td").eq(3).width("auto");var n=this.$tip.width(),j=parseInt(this.$tip.css("min-width")),g=parseInt(this.$tip.css("max-width"));if(!isNaN(j)&&n<j){n=j}else{if(!isNaN(g)&&n>g){n=g}}this.$tip.add(o).width(n).eq(0).find("td").eq(3).width("100%")}else{if(o[0]){o.width("auto").find("td").eq(3).width("auto").end().end().width(this.$tip.width()).find("td").eq(3).width("100%")}}this.tipOuterW=this.$tip.outerWidth();this.tipOuterH=this.$tip.outerHeight();this.calcPos();if(m&&this.pos.arrow){this.$arrow[0].className="tip-arrow tip-arrow-"+this.pos.arrow;this.$arrow.css("visibility","inherit");if(this.opts.arrow=="-right"){this.$arrow.css("left","auto").css("right",this.$arrow.css("marginLeft"))}}if(h){this.$tip.css(k).animate({left:this.pos.l,top:this.pos.t},200)}else{this.$tip.css({left:this.pos.l,top:this.pos.t})}},display:function(h){var i=this.$tip.data("active");if(i&&!h||!i&&h){return}this.$tip.stop();if((this.opts.slide&&this.pos.arrow||this.opts.fade)&&(h&&this.opts.hideAniDuration||!h&&this.opts.showAniDuration)){var m={},l={};if(this.opts.slide&&this.pos.arrow){var k,g;if(this.pos.arrow=="bottom"||this.pos.arrow=="top"){k="top";g="bottom"}else{k="left";g="right"}var j=parseInt(this.$tip.css(k));m[k]=j+(h?0:this.opts.slideOffset*(this.pos.arrow==g?-1:1));l[k]=j+(h?this.opts.slideOffset*(this.pos.arrow==g?1:-1):0)}if(this.opts.fade){m.opacity=h?this.$tip.css("opacity"):0;l.opacity=h?0:this.opacity}this.$tip.css(m).animate(l,this.opts[h?"hideAniDuration":"showAniDuration"])}h?this.$tip.queue(e.proxy(this.reset,this)):this.$tip.css("visibility","inherit");this.$tip.data("active",!i)},disable:function(){this.reset();this.disabled=true},enable:function(){this.disabled=false},destroy:function(){this.reset();this.$tip=e();this.$elm.unbind("poshytip").removeData("title.poshytip").removeData("poshytip");a.splice(e.inArray(this,a),1);this.$elm=e();this.disabled=true},clearTimeouts:function(){if(this.showTimeout){clearTimeout(this.showTimeout);this.showTimeout=0}if(this.hideTimeout){clearTimeout(this.hideTimeout);this.hideTimeout=0}},calcPos:function(){var n={l:0,t:0,arrow:""},h=e(window),k={l:h.scrollLeft(),t:h.scrollTop(),w:h.width(),h:h.height()},p,j,m,i,q,g;if(this.opts.alignTo=="cursor"){p=j=m=this.eventX;i=q=g=this.eventY}else{var o=this.$elm.offset(),l={l:o.left,t:o.top,w:this.$elm.outerWidth(),h:this.$elm.outerHeight()};p=l.l+(this.opts.alignX!="inner-right"?0:l.w);j=p+Math.floor(l.w/2);m=p+(this.opts.alignX!="inner-left"?l.w:0);i=l.t+(this.opts.alignY!="inner-bottom"?0:l.h);q=i+Math.floor(l.h/2);g=i+(this.opts.alignY!="inner-top"?l.h:0)}switch(this.opts.alignX){case"right":case"inner-left":n.l=m+this.opts.offsetX;if(n.l+this.tipOuterW>k.l+k.w){n.l=k.l+k.w-this.tipOuterW}if(this.opts.alignX=="right"||this.opts.alignY=="center"){n.arrow="left"}break;case"center":n.l=j-Math.floor(this.tipOuterW/2);if(n.l+this.tipOuterW>k.l+k.w){n.l=k.l+k.w-this.tipOuterW}else{if(n.l<k.l){n.l=k.l}}break;default:n.l=p-this.tipOuterW-this.opts.offsetX;if(n.l<k.l){n.l=k.l}if(this.opts.alignX=="left"||this.opts.alignY=="center"){n.arrow="right"}}switch(this.opts.alignY){case"bottom":case"inner-top":n.t=g+this.opts.offsetY;if(!n.arrow||this.opts.alignTo=="cursor"){n.arrow="top"}if(n.t+this.tipOuterH>k.t+k.h){n.t=i-this.tipOuterH-this.opts.offsetY;if(n.arrow=="top"){n.arrow="bottom"}}break;case"center":n.t=q-Math.floor(this.tipOuterH/2);if(n.t+this.tipOuterH>k.t+k.h){n.t=k.t+k.h-this.tipOuterH}else{if(n.t<k.t){n.t=k.t}}break;default:n.t=i-this.tipOuterH-this.opts.offsetY;if(!n.arrow||this.opts.alignTo=="cursor"){n.arrow="bottom"}if(n.t<k.t){n.t=g+this.opts.offsetY;if(n.arrow=="bottom"){n.arrow="top"}}}this.pos=n}};e.fn.poshytip=function(g){if(typeof g=="string"){return this.each(function(){var i=e(this).data("poshytip");if(i&&i[g]){i[g]()}})}var h=e.extend({},e.fn.poshytip.defaults,g);if(!e("#poshytip-css-"+h.className)[0]){e(['<style id="poshytip-css-',h.className,'" type="text/css">',"div.",h.className,"{visibility:hidden;position:absolute;top:0;left:0;}","div.",h.className," table, div.",h.className," td{margin:0;font-family:inherit;font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;}","div.",h.className," td.tip-bg-image span{display:block;font:1px/1px sans-serif;height:",h.bgImageFrameSize,"px;width:",h.bgImageFrameSize,"px;overflow:hidden;}","div.",h.className," td.tip-right{background-position:100% 0;}","div.",h.className," td.tip-bottom{background-position:100% 100%;}","div.",h.className," td.tip-left{background-position:0 100%;}","div.",h.className," div.tip-inner{background-position:-",h.bgImageFrameSize,"px -",h.bgImageFrameSize,"px;}","div.",h.className," div.tip-arrow{visibility:hidden;position:absolute;overflow:hidden;font:1px/1px sans-serif;}","</style>"].join("")).appendTo("head")}return this.each(function(){new e.Poshytip(this,h)})};e.fn.poshytip.defaults={content:"[title]",className:"tipWrap",bgImageFrameSize:10,showTimeout:100,hideTimeout:500,showOn:"hover",alignTo:"cursor",alignX:"right",alignY:"top",offsetX:-22,offsetY:18,allowTipHover:true,followCursor:false,fade:true,slide:true,slideOffset:8,showAniDuration:300,hideAniDuration:300}})(jQuery);jv.chk_one=function(setting){var Alert=function(alertOption){var p={con:false,msg:false};p=$.extend(p,alertOption);if($.fn.mytip){var con=$(p.con);if(con.css("textAlign")=="right"){con.mytip(p.msg,{alignX:"inner-right",arrow:"-right"})}else{con.mytip(p.msg)}}else{alert(p.msg)}};var UnAlert=function(obj){$(obj).poshytip("destroy")};if(!setting){setting={}}var chkCon=setting.con||jv.GetDoer(),jchkCon=$(chkCon);if(chkCon.disabled||(chkCon.type=="hidden")||!jchkCon.is(":visible")){return true}var option={con:chkCon,callback:false,chk:(jchkCon.attr("chk")||"").trim(),chkval:(jchkCon.attr("chkval")||"").trim(),chkmsg:(jchkCon.attr("chkmsg")||"").trim(),boxdy:false};option=$.extend(option,setting);var regFunc=function(regOptions){var p={expchk:false,val:false,msg:false,con:false};p=$.extend(p,regOptions);var regLastTemp=p.expchk.slice(3).trim();var expSignEqual=regLastTemp.slice(0,2)=="==";var expval=regLastTemp.slice(2).trim();var reg=new RegExp(expval);if(reg.test(p.val)==expSignEqual){Alert(p);return false}else{UnAlert(p.con)}return true};var funcFunc=function(funcOptions){var p={expchk:false,val:false,msg:false,con:false};p=$.extend(p,funcOptions);var expval=p.expchk;var res=eval("eval ("+expval+")")(p.val,p.msg,{originalEvent:true,target:p.con});if(res===true||jv.IsNull(res)){UnAlert(p.con)}else{if(res===false){return false}else{if(res.length>0){Alert({con:p.con,msg:res});return false}}}return true};var expLimit=function(expOptions){var p={dataType:false,expchk:false,val:false,msg:false,con:false};p=$.extend(p,expOptions);if(!p.expchk){return true}var getBetween=function(partStr,valProc){var ranges=partStr.split(",");var from=valProc?valProc(ranges[0]):(ranges[0]||"");var to=valProc?valProc(ranges[1]):(ranges[1]||"");if(from.length&&to.length){if(from>to){var temp=from;from=to;to=temp}}return{from:from,to:to}};var procLength=function(chkExp){if(/\{.+\}/g.test(chkExp)){var part=chkExp.match(/[^\{^\}]+/g)[0];var between=getBetween(part,parseInt),from=between.from,to=between.to,fromValue=parseInt(from),toValue=parseInt(to);var valLen=p.val.length;if(valLen<fromValue||(valLen>toValue)){Alert({con:p.con,msg:p.msg||"长度限定在: "+chkExp+" 之间!"});return false}else{if(valLen<fromValue){Alert({con:p.con,msg:p.msg||"长度限定必须 ≥ "+from+"!"});return false}else{if(valLen>toValue){Alert({con:p.con,msg:p.msg||"长度限定必须 ≤ "+to+"!"});return false}}}}return true};var procRange=function(chkExp){if(/\(.+\)/g.test(chkExp)){var part=chkExp.match(/[^\(^\)]+/g)[0];var between=getBetween(part,jv.typeIsNumberType(p.dataType)?parseFloat:null),from=between.from,to=between.to;if(p.dataType=="datetime"||p.dataType=="date"){from=from.getDate();to=to.getDate();p.val=p.val.getDate()}else{if(p.dataType=="time"){from=("2000-1-1 "+from).getDate();to=("2000-1-1 "+to).getDate();p.val=("2000-1-1 "+p.val).val.getDate()}else{if(p.dataType=="int"||p.dataType=="Int32"||p.dataType=="UInt32"){if(p.val.toString().length>12){Alert({con:p.con,msg:p.msg||"超出数字类型("+p.dataType+")的范围!"});return false}from=parseInt(from);to=parseInt(to);p.val=parseInt(p.val)}else{if(p.dataType=="Int16"||p.dataType=="UInt16"){if(p.val.toString().length>6){Alert({con:p.con,msg:p.msg||"超出数字类型("+p.dataType+")的范围!"});return false}from=parseInt(from);to=parseInt(to);p.val=parseInt(p.val)}else{if(p.dataType=="number"||p.dataType=="Single"){proc=function(v){return parseFloat(v)}}else{if(p.dataType=="Byte"||p.dataType=="SByte"){if(p.val.toString().length>3){Alert({con:p.con,msg:p.msg||"超出数字类型("+p.dataType+")的范围!"});return false}proc=function(v){return parseInt(v)}}else{if(p.dataType=="Int64"||p.dataType=="Decimal"||p.dataType=="Double"||p.dataType=="UInt64"||p.dataType=="VarNumeric"||p.dataType=="Currency"||p.dataType=="Binary"||p.dataType=="Decimal"||p.dataType=="Guid"||p.dataType=="Object"||p.dataType=="Xml"||p.dataType=="Boolean"){return true}}}}}}}if(p.val<from||p.val>to){Alert({con:p.con,msg:p.msg||"范围限定在: "+chkExp+" 之间!"});return false}}return true};var sects=p.expchk.match(/\(|\)|\{|\}/g),retVal=true;$.each(sects,function(i,d){if(i%2==0){return}if(d=="}"){retVal&=procLength(p.expchk.match(/\{.+\}/g)[0])}else{if(d==")"){retVal&=procRange(p.expchk.match(/\(.+\)/g)[0])}}if(!retVal){return retVal}});return retVal};var expFunc=function(expOptions){var p={expchk:false,val:false,msg:false,con:false};p=$.extend(p,expOptions);var expDateTimeType=p.expchk.slice(0,8).trim().toLowerCase();var exp6Type=expDateTimeType.slice(0,6);var exp4Type=exp6Type.slice(0,4);var exp3Type=exp4Type.slice(0,3);var expval4=p.expchk.slice(4).trim();if(expDateTimeType=="datetime"){var res=regFunc({expchk:"reg!=^\\d{1,4}(\\-|\\/|\\.|年)\\d{1,2}(\\-|\\/|\\.|月)\\d{1,2}日? \\d{1,2}:\\d{1,2}:\\d{1,2}$",val:p.val,msg:p.msg||"不正确的日期时间格式!",con:p.con});if(res==false){return false}return expLimit({dataType:expDateTimeType,expchk:p.expchk.slice(8).trim(),val:p.val,con:p.con,msg:p.msg})}else{if(exp6Type=="number"){var res=regFunc({expchk:"reg!=^[+-]?\\d*(\\.$|\\d*$|(\\.?\\d*$))",val:p.val,msg:p.msg||"不正确的数字格式!",con:p.con});if(res==false){return false}return expLimit({dataType:exp6Type,expchk:p.expchk.slice(6).trim(),val:p.val,con:p.con,msg:p.msg})}else{if(exp4Type=="email"){var res=regFunc({expchk:"reg!=^\\w+((-\\w+)|(\\.\\w+))*\\@[A-Za-z0-9]+((\\.|-)[A-Za-z0-9]+)*\\.[A-Za-z0-9]+$",val:p.val,msg:p.msg||"不正确的电子邮件格式!",con:p.con});if(res==false){return false}return expLimit({dataType:exp4Type,expchk:expval4,val:val,con:con,msg:p.msg})}else{if(exp4Type=="date"){var res=regFunc({expchk:"reg!=^\\d{1,4}(\\-|\\/|\\.|年)\\d{1,2}(\\-|\\/|\\.|月)\\d{1,2}日?$",val:p.val,msg:p.msg||"不正确的日期格式!",con:p.con});if(res==false){return false}return expLimit({dataType:exp4Type,expchk:expval4,val:p.val,con:p.con,msg:p.msg})}else{if(exp4Type=="time"){var res=regFunc({expchk:"reg!=\\d{1,2}:\\d{1,2}:\\d{1,2}$",val:p.val,msg:p.msg||"不正确的时间格式!",con:p.con});if(res==false){return false}return expLimit({dataType:exp4Type,expchk:expval4,val:p.val,con:p.con,msg:p.msg})}else{if(exp4Type=="enum"){var expContent=p.expchk.split(new RegExp("[()]"))[1].split(",");if(expContent.indexOf(p.val)<0){Alert({con:p.con,msg:p.msg||"不在枚举范围内: "+p.expchk+" 之间!"});return false}}else{if(exp3Type=="int"){var res=regFunc({expchk:"reg!=^[+-]?\\d+$",val:p.val,msg:p.msg||"需要整数!",con:p.con});if(res==false){return false}return expLimit({dataType:exp3Type,expchk:p.expchk.slice(3).trim(),val:p.val,con:p.con,msg:p.msg})}else{return expLimit({expchk:p.expchk,val:p.val,con:p.con,msg:p.msg})}}}}}}}};var dbChk=function(expOptions){var p={expchk:false,val:false,msg:false,con:false};p=$.extend(p,expOptions);var dbType=p.con.getAttribute("dbtype");var maxLen=parseInt(p.con.getAttribute("dblen"));if(dbType=="Int32"){var res=regFunc({expchk:"reg!=^[+-]?\\d+$",val:p.val,msg:p.msg||"需要32位整数!",con:p.con});if(res==false){return false}if(expLimit({dataType:"int",expchk:"(-2147483648,2147483647)",val:p.val,con:p.con,msg:p.msg})==false){return false}}else{if(dbType=="Int16"){var res=regFunc({expchk:"reg!=^[+-]?\\d+$",val:p.val,msg:p.msg||"需要16位整数!",con:p.con});if(res==false){return false}if(expLimit({dataType:"int",expchk:"(-32768,32767)",val:p.val,con:p.con,msg:p.msg})==false){return false}}else{if(dbType=="Byte"){var res=regFunc({expchk:"reg!=^[+]?\\d+$",val:p.val,msg:p.msg||"需要8位整数!",con:p.con});if(res==false){return false}if(expLimit({dataType:"int",expchk:"(0,255)",val:p.val,con:p.con,msg:p.msg})==false){return false}}else{if(dbType=="SByte"){var res=regFunc({expchk:"reg!=^[+-]?\\d+$",val:p.val,msg:p.msg||"需要8位整数!",con:p.con});if(res==false){return false}if(expLimit({dataType:"int",expchk:"(-128,127)",val:p.val,con:p.con,msg:p.msg})==false){return false}}else{if(dbType=="UInt16"){var res=regFunc({expchk:"reg!=^[+]?\\d+$",val:p.val,msg:p.msg||"需要16位整数!",con:p.con});if(res==false){return false}if(expLimit({dataType:"int",expchk:"(-32768,32767)",val:p.val,con:p.con,msg:p.msg})==false){return false}}else{if(dbType=="UInt32"){var res=regFunc({expchk:"reg!=^[+]?\\d+$",val:p.val,msg:p.msg||"需要32位整数!",con:p.con});if(res==false){return false}if(expLimit({dataType:"int",expchk:"(0,4294967295)",val:p.val,con:p.con,msg:p.msg})==false){return false}}else{if(dbType=="Date"){var res=regFunc({expchk:"reg!=^\\d{1,4}(\\-|\\/|\\.|年)\\d{1,2}(\\-|\\/|\\.|月)\\d{1,2}日?$",val:p.val,msg:p.msg||"不正确的日期格式!",con:p.con});if(res==false){return false}}else{if(dbType=="DateTime"||dbType=="DateTime2"||dbType=="DateTimeOffset"){var res=regFunc({expchk:"reg!=^\\d{1,4}(\\-|\\/|\\.|年)\\d{1,2}(\\-|\\/|\\.|月)\\d{1,2}日? \\d{1,2}:\\d{1,2}:\\d{1,2}$",val:p.val,msg:p.msg||"不正确的日期时间格式!",con:p.con});if(res==false){return false}}else{if(dbType=="Time"){var res=regFunc({expchk:"reg!=\\d{1,2}:\\d{1,2}:\\d{1,2}$",val:p.val,msg:p.msg||"不正确的时间格式!",con:p.con});if(res==false){return false}}else{if(dbType=="AnsiString"||dbType=="AnsiStringFixedLength"){if(p.val.byteLen()>maxLen){p.msg=p.msg||"超出了最大数据长度.";Alert(p);return false}}else{if(dbType=="String"||dbType=="StringFixedLength"){if(p.val.length>maxLen){p.msg=p.msg||"超出了最大数据长度.";Alert(p);return false}}}}}}}}}}}}p.expchk=p.expchk.slice(1);if(p.expchk&&jv.chk_one(p)==false){return false}UnAlert(p.con);return true};var functionType=option.chk.slice(0,8).toLowerCase();var regType=functionType.slice(0,3).toLowerCase();var shortFunctionType=regType.slice(0,1);var chkval;if(option.chkval){if(option.chkval.slice(0,8)=="function"){chkval=eval("eval ("+option.chkval+")")()}else{if(option.chkval.slice(0,1)==":"){chkval=eval("eval (function(){"+option.chkval.slice(1)+"})")()}else{var chk_val_con=$(option.chkval,jv.boxdy());if(!chk_val_con.length){chk_val_con=$(option.chkval,jv.boxdy())}chkval=chk_val_con.val()}}}else{chkval=$(chkCon,jv.boxdy()).val()}chkval=chkval.trim();if(shortFunctionType==":"){option.chk="function(val,msg){"+option.chk.slice(1)+"}"}if((functionType=="function")||(shortFunctionType==":")){if(funcFunc({expchk:option.chk,val:chkval,msg:option.chkmsg,con:chkCon})==false){return false}}else{if(regType=="reg"){if(regFunc({expchk:option.chk,val:chkval,msg:option.chkmsg,con:chkCon})==false){return false}}else{if(shortFunctionType=="$"){if(dbChk({expchk:option.chk,val:chkval,msg:option.chkmsg,con:chkCon})==false){return false}}else{if(expFunc({expchk:option.chk,val:chkval,msg:option.chkmsg,con:chkCon})==false){return false}}}}if(option.callback){var ret=option.callback(option);if(ret){Alert({con:option.con,msg:ret});return false}}return true};jv.chk=function(c){if(!c){c={}}var a=c.boxdy||jv.boxdy();var h=true;var b=function(j){var k=$.extend({con:false,chkval:false},j);if(!jv.SenseWord){return false}var e="";$(jv.SenseWord).each(function(l,m){if(k.chkval.indexOf(m)>=0){e=m;return false}});if(e){return"包含关键词:"+e}else{return false}};var g=function(e){var j=jv.chk_one({con:e,callback:b});if(j){$(e).poshytip("destroy")}return j};var f;var i=$(a);i.filter("[chk]").add(i.find("[chk]")).each(function(j,k){h&=g(k);if(!f&&!h){var e=$(k);if(e.attr("disabled")||(e.attr("type")=="hidden")||!e.is(":visible")){return}f=k}}).each(function(e,j){$($(j).attr("chkval")||j).unbind("change.jvchk").bind("change.jvchk",function(k){g(j)})});if(f){try{f.focus()}catch(d){}}if(!h){jv.UnOneClick()}jv.RegisteUnload("chk",function(){jv.boxdy().find("[chk]").each(function(e,j){$(j).poshytip("destroy")})});return h};