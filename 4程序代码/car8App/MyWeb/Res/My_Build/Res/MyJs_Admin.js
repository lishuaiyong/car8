(function(){if(jv.flexiRowEvent){return}history.Back=history.back;history.back=function(){if(document.referrer){document.location=document.referrer}else{history.Back(arguments)}};jv.JqLoadXml=function(a){var b=$("#"+a);if(jv.IsNull(window.ActiveXObject)==true){if(jv.IsNull(b.attr("src"))==false){b=$(jv.loadXML(b.attr("src")))}}return b};jv.LoadXML=jv.loadXML=function(b){var a=null;if(window.ActiveXObject){a=new ActiveXObject("Microsoft.XMLDOM")}else{if(document.implementation&&document.implementation.createDocument){a=document.implementation.createDocument("","",null)}else{alert("Your browser cannot handle this script.")}}a.async=false;a.load(b);return a};jv.ClearFileValue=jv.clearFileValue=function(a){a.value="";a.select();document.execCommand("Delete")};jv.GetHexColor=jv.getHexColor=function(g){if(g=="transparent"){return g}var c=document.createElement("div"),a="backgroundColor",b="background-color",f;$(c).css("backgroundColor",g);if(c.currentStyle){f=c.currentStyle[a];return f}else{var e=document.defaultView.getComputedStyle(c,null);f=e.getPropertyValue(b);e=f.substring(0,f.length-1).substring(4).mySplit(",");return"#"+parseInt(e[0]).toString(16).padLeft(2,"0")+parseInt(e[1]).toString(16).padLeft(2,"0")+parseInt(e[2]).toString(16).padLeft(2,"0")}};jv.GetOffsetColor=jv.getOffsetColor=function(i,h){var k=parseInt("0x"+jv.GetHexColor(i).substr(1));var f=(k>>16)&255;f+=parseInt(f*h/255);f=f<0?0:f>255?255:f;var e=(k>>8&255)&255;e+=parseInt(e*h/255);e=e<0?0:e>255?255:e;var a=k&255;a+=parseInt(a*h/255);a=a<0?0:a>255?255:a;return"#"+f.toString(16).padLeft(2,"0")+e.toString(16).padLeft(2,"0")+a.toString(16).padLeft(2,"0")};jv.GetParentColor=jv.getParentColor=function(c){if(jv.IsNull(c)){return"white"}var b=$(c)[0];if(b.tagName.toLowerCase()=="html"){return"white"}var e=$(b).parent();if(jv.IsNull(e)){return"white"}var a=e.css("background-color");if(a=="transparent"){return jv.GetParentColor(e[0])}return a};jv.FindParentsClass=jv.findParentsClass=function(a,b){if(jv.IsNull(a)){return null}var c=$(a).parent();if(c.length==0){return null}if(c.filter("."+b).length>0){return c}else{return jv.FindParentsClass(c,b)}return null};jv.FlexiRowEvent=jv.flexiRowEvent=function(f,c){if(!f){return}var a=$(jv.GetDoer());var b=a.getFlexi();var e=b.getjTr(a);a=a.closest("td");f(b.findRowData(b.data.rows,e.attr("id").slice(3)),e.index(),b,a,c)};jv.ReSortFlexi=jv.reSortFlexi=function(a){var b=a.table,c=a.SortColumn,g=a.callback;$(b.bDiv).find("table tr td.first").hover(function(){$(this).addClass("vDrag")},function(){$(this).removeClass("vDrag")});var f,e;$(b.bDiv).find("table").tableDnD({dragHandle:"first",onDragClass:"tDnD_whileDrag",onDragStart:function(h,i){f=$(i).closest("tr").index()},onDrop:function(m,n){e=$(n).index();var k=$(b.bDiv).find("table tbody tr:eq("+f+")");var i=$(b.bDiv).find("table tbody tr:eq("+e+")");var h=b.TableRowToData(k)[c];var l=b.TableRowToData(i)[c];g(h,l)}})};jv.HighlightLogin=jv.highlightLogin=function(a){return a.replace(/登录/g,"<a target=_top href="+jv.Root+"Login.aspx>登录</a>")};jv.MyInitOn["Admin.Style"]=function(){var b=$(document.body);if(!window.top.frames.length){var a=parseInt(b.css("paddingRight"));if(a){b.css("paddingLeft",a+"px")}}};jv.MyLoadOn.MyDate=function(a){a=a||document;$(".MyDate",a).click(function(){WdatePicker({$dpPath:jv.Root+"Res/My97/"})});$(".MyTime",a).click(function(){WdatePicker({dateFmt:"HH:mm:ss"})});$(".MyDateTime",a).click(function(){WdatePicker({dateFmt:"yyyy-MM-dd HH:mm:ss"})})};jv.GetErrorFromPage=jv.getErrorFromPage=function(a){var a=$(a),e=a.filter("title").text();if(!e){for(var b=0,c=a.length;b<c;b++){e=$(a[b]).text();if(!!e){break}}}return e||""};$(function(){jv._AjaxTimer;jv._TimerCount=0;jv.StartLoading=jv.startLoading=function(b){if(window.Boxy&&Boxy.getOne()){return}if(!b){if(jQuery.active!==1){return}var c=jv.getDoer(function(e){if(e&&(e.type=="ajaxStart")){return false}});if(c&&c.tagName&&(c.tagName=="INPUT")){}else{return}}else{jv.PageLoading=true}jv._TimerCount=0;$.timer(500,function(f){f.stop();if(b){if(!jv.PageLoading){return}}else{if(jQuery.active==0){return}}if($(document.body).find(">.loadingDiv").length){return}jv.loadingDiv();var e=$(document.body).find(">.loadingDiv");jv._AjaxTimer=$.timer(1000,function(g){if(b&&!jv.PageLoading){return}jv._TimerCount++;e.html(jv._TimerCount+"秒过去了...")})})};jv.StopLoading=jv.stopLoading=function(b){if(b){jv.PageLoading=false}var c=$(document.body);c.find(">.loadingDiv").remove();c.clearCover();if(jv._AjaxTimer&&jv._AjaxTimer.stop){jv._AjaxTimer.stop()}jv._TimerCount=0;jv.PageLoading=false};var a=$(document.body);if(a.data("events")&&a.data("events")["ajaxStart"]){return}a.ajaxStart(function(){$(this).css("cursor","wait");jv.StartLoading()}).ajaxStop(function(e,c,b){$($(document).data("OneClick")||[]).removeAttr("disabled");$(document).data("OneClick",null);$(this).css("cursor","default");jv.StopLoading()})})})();jQuery.fn.fixTableHeader=function(a){var b=jQuery.extend({size:1,scrollObj:document.body},a);this.each(function(){var i=$(this);var c=i.find("tr:lt("+b.size+")");var g="th";var e=c.find(g);if(e.length==0){g="td";e=c.find(g)}if(e.length===0){return}var h=i.clone();h[0].className="";h.find("thead,tbody,tfoot").empty();h.css({position:"fixed",top:$(b.scrollObj).offset().top,left:i.offset().left}).addClass("fixedTableHeader").width(i.outerWidth()).hide();if(h.find("thead").length==0){h.append(document.createElement("thead"))}var f=c.clone();f.each(function(k){var l=c.eq(k).find(g);$(this).find(g).each(function(m){$(this).width($(l[m]).width())})});h.find("thead").append(f);i.after(h);$((b.scrollObj==document||b.scrollObj==document.body)?window:b.scrollObj).scroll(function(){if(jQuery.browser.msie&&jQuery.browser.version=="6.0"){h.css({position:"absolute",top:$(b.scrollObj).offset().top,left:i.offset().left})}else{h.css({position:"fixed",top:$(b.scrollObj).offset().top,left:i.offset().left-$(window).scrollLeft()})}var k=$(window).scrollTop();var l=c.offset().top;if(k>l&&k<=(l+i.height()-c.height())){h.show()}else{h.hide()}});$(window).resize(function(){if(h.outerWidth()!=i.outerWidth()){c.find(g).each(function(m){var l=$(this);var k=l.width();l.css("width",k);h.find(g).eq(m).css("width",k)});h.width(i.outerWidth())}h.css("left",i.offset().left)})})};(function(a){a.addFlex=function(s,c){if(s.grid){return false}var b=a(s);c.role=a.extend({id:"Id",name:"Name",select:"IsSelected"},c.role);c.role.tree=c.role.tree||c.role.name;c._Ref_Type_=c._Ref_Type_||jv.url().attr("_Ref_Type_");c=a.extend({ajaxUrl:false,autoload:false,blankHtml:"&nbsp;",buttons:[],cgwidth:false,colModel:[],dataType:"json",defwidth:300,dbclick:function(g){if(c._Ref_Type_=="radio"){if(c.onSelect&&(c.onSelect(g,l)===false)){return false}if(c.onSelected){c.onSelected(g,l)}if(c.RefCallback){jv.Hide(function(){c.RefCallback(c.role,c.PageQuote,l,{originalEvent:true,target:g})})}}},draggable:false,errormsg:"发生异常",FillHeight:true,fixTableHeader:false,height:jv.oriCss(s,"height")||"auto",hideOnSubmit:true,IdName:"序号",keepQuote:false,method:"POST",minColToggle:1,minwidth:20,maxwidth:1200,minheight:80,moreCol:false,newButton:function(g,u){if(!g){return false}if(!this.container){return false}if(g.separator){return false}var i=a(this.container,jv.boxdy());var t=document.createElement("input");t.type="button";t.className=g.bclass;t.value=g.name;t.onclick=function(v){g.onpress(u.getSelectIds(),u,v)};i.append(t);return true},newp:1,nohresize:false,nomsg:"没有数据",novstripe:false,onChangeSort:false,onSelect:false,onSelected:false,onSubmit:false,onSuccess:false,onToggleCol:false,multiSelect:true,page:1,pages:1,params:{},procmsg:"正在处理，请稍候...",pagestat:"显示第 {from} 到 {to} 条记录，共{total}条记录。",preProcess:false,qtype:"",query:"",repeatHeader:false,resizable:false,role:{id:"Id",name:"Name",tree:"Name",select:"IsSelected",group:"",groupStyle:"1px solid green"},take:15,rpFixed:false,rpOptions:[5,10,15,20,25,40,50],selectExtend:"",checkSelectName:"<div class='inpbox check Inline'></div>全选",radioSelectName:"选择",selectType:"all",showHeader:true,showToggleBtn:false,sortorder:"asc",striped:true,thead:false,tfoot:false,toolBar:[".BoxyTool",".PageTool",".MyTool"],tooltip:true,total:0,treeOpen:true,useId:false,useSelect:false,url:false,usepager:false,width:jv.oriCss(s,"width")||"auto",_Ref_Type_:false,RefCallback:false,PageQuote:[],DataSource:false},c);if(!c.take&&c.rp){c.take=c.rp}c.role=a.extend({id:"Id",name:"Name",tree:"Name",select:"IsSelected",group:"",groupStyle:"1px solid green"},c.role);if(c._Ref_Type_){if(c._Ref_Type_=="radio"){c.multiSelect=false;c.selectExtend=""}c.PageQuote=(c.PageQuote.length?c.PageQuote:(window.opener&&window.opener._PageQuote_))||[];c.RefCallback=c.RefCallback||(window.opener&&window.opener._Ref_Callback_);c.PageQuote=jQuery.extend([],c.PageQuote);if(c._Ref_Type_.length>1){for(var f=0;f<c.colModel.length;f++){var h=c.colModel[f];if(!h){continue}if(h.bind===false&&(h.name!="View")){if(!h.css||(","+h.css+",").indexOf(",pin,")<0){h.hide=true}}}}c.DataSource=jv.boxdy()[0].DataSource||(window.opener&&window.opener.DataSource)}if(c.toolBar&&c.toolBar.length){a.each(c.toolBar,function(u,x){var t=a(x,jv.boxdy());if(!t.length){return}if(t[0].style.display=="none"){return}if(!c.container){c.container=x}if(c._Ref_Type_&&(c._Ref_Type_.length>1)){t.find("input").each(function(){var i=this;if(i.style.display=="none"){return}if(jv.nodeHasClass(i,"query")){return}if(jv.nodeHasClass(i,"pin")){return}i.style.display="none"});for(var u=0,g=c.buttons.length;u<g;u++){var v=c.buttons[u];var w=" "+v.bclass+" ";if(w.indexOf("query")>=0){return}if(w.indexOf("pin")>=0){return}c.buttons.removeAt(u);u--;g--}}})}if(c.rpOptions.indexOf(c.take)<0){c.rpOptions.push(c.take);c.rpOptions.sort(function e(i,g){return i-g})}var r={newTreeRows:function(x,w,u,t){if(x===true){return[]}if(!w){w=0}var z=u();l.dataToRow(x,z,w,x.rows===true?true:(x.rows?x.rows.length:0));if(l.data.isTree){l.addTreeProp(z);if(x.rows!==true&&x.rows){for(var v=0,g=x.rows.length;v<g;v++){var y=x.rows[v];if(y===true){continue}r.newTreeRows(y,w+1,u,{originalEvent:true,target:t||jv.getDoer()})}}}},removePageQuoteData:function(){if(c._Ref_Type_=="check"||c._Ref_Type_=="radio"||c.keepQuote){}else{l.clearSelectRow()}},updateHeaderChk:function(){if(c.useSelect){var v=null,t=null;for(var u=0,y=s.tBodies.length;u<y;u++){if(v!==null&&(t!==null)){break}var x=s.tBodies[u];for(var g=0,z=x.children.length;g<z;g++){if(v!==null&&(t!==null)){break}var A=x.children[g];var w=" "+A.className+" ";if(w.indexOf(" trSelected ")>=0){v=true}else{t=true}}}if(!r.chk||!r.chk.length){r.chk=r.chk||b.find("thead tr .inpbox")}if(v&&t){r.chk.removeClass("chked").addClass("chkpart")}else{if(v){r.chk.removeClass("chkpart").addClass("chked")}else{r.chk.removeClass("chked").removeClass("chkpart")}}}},tempReplaceFunc:function(i,v,u){var t="$"+v+"$";if(i.indexOf(t)>=0){var g=u();i=i.replace(new RegExp("\\$"+v+"\\$","g"),g)}return i},decideBtnClick:function(g){g=g||jv.GetDoer();var i=g.tagName.toLowerCase();var t=i=="a"||(i=="button")||(i=="input");if(t){return t}g=g.parentNode;if(!g){return false}i=g.tagName.toLowerCase();if(i=="div"||i=="td"||i=="tr"){return false}return r.decideBtnClick(g)},setUpSelect:function(v){var g=a(v),w=g.data("rowLevel");var u=(c.selectExtend||"").mySplit(",",true);var t=l.isSelected(g);if(!l.data){return}if((l.data.isTree&&t)&&(u.indexOf("up")>-1)){while(true){g=g.prev();if(g.length==0){break}var i=g.data("rowLevel");if(w>i){if(c.onSelect&&c.onSelect(g[0],l)===false){break}l.setSelectRow(g);if(c.onSelected){c.onSelected(g[0],l)}w=i}}}},setDownSelect:function(v){var g=a(v),w=g.data("rowLevel");var u=(c.selectExtend||"").mySplit(",",true);var t=l.isSelected(g);if(!l.data){return}if(l.data.isTree&&(u.indexOf("down")>-1)){while(true){g=g.next();if(g.length==0){break}var i=g.data("rowLevel");if(w>=i){break}if(c.onSelect&&c.onSelect(g[0],l)===false){break}if(t){l.setSelectRow(g)}else{l.setUnSelectRow(g)}if(c.onSelected){c.onSelected(g[0],l)}}}},btnPress:function(t){var u=a(jv.GetDoer());if(u.attr("disabled")){return false}var i=u.closest(".fbutton");if(i.attr("disabled")){return false}if(i.find(".submit").length){jv.SetDisable(i)}var g=t.data.btn.onpress(l.getSelectIds(),l,t);if(g===false){if(u.hasClass(".fbutton")){u.UnOneClick()}else{jv.UnOneClick(u.closest(".fbutton"))}}return g},headerOver:function(g,t){var v=a(this).addClass("thOver");var i=l.cols[l.keys[this.cellIndex]];if(i.sortable){if(i.name!=c.sortname){v.addClass("s"+c.sortorder)}else{var u="";if(c.sortorder=="asc"){u="desc"}else{u="asc"}v.removeClass("s"+c.sortorder).addClass("s"+u)}}},headerOut:function(){var t=a(this).removeClass("thOver");var g=l.cols[l.keys[this.cellIndex]];if(g.sortable){if(g.name==c.sortname){var i="";if(c.sortorder=="asc"){i="desc"}else{i="asc"}t.addClass("s"+c.sortorder).removeClass("s"+i)}else{t.removeClass("s"+c.sortorder)}}},findPOne:function(g){g=a(g);if(!g.length){return null}else{return g.closest("tr")}},btnRadioOkPress:function(u,t,v){var g=a(".trSelected",t.bDiv);if(g.length==1){c.dbclick(g[0])}else{if(g.length>1){alert("单选状态下，请选择一个返回。");return}else{var i=c.PageQuote;if(!i.length){i=[{}];i.IsEmpty=true}jv.Hide(function(){c.RefCallback(c.role,i,l,{originalEvent:true,target:jv.GetDoer()})})}}},btnCheckOkPress:function(t,i,u){var g=c.PageQuote;if(!g.length){g.IsEmpty=true}jv.Hide(function(){c.RefCallback(c.role,g,l,{originalEvent:true,target:jv.GetDoer()})})},subMenuPress:function(u){var w=a(".flexi_subMenu:first");if(w.length==0){a("body").append('<div class="flexigrid flexi_subMenu" />');w=a(".flexi_subMenu:first")}w.html("");var i=a(jv.GetDoer()).closest(".subBtn"),v=u.data.btns;for(j=0,dataLen=v.length;j<dataLen;j++){if(v[j].separator){a("<div class='menu-split'></div>").appendTo(w);continue}var g=v[j],t=a("<span>"+l.getName(g.name)+"</span>");if(g.bclass){t.addClass(g.bclass)}if(g.id){t.attr("id",g.id)}if(g.style){t.attr("style",g.style)}t.css("paddingLeft",20).css("paddingRight",20);t.wrap('<div class="menuitem"></div>').parent().bind("click",{btn:i,press:g.onpress},function(x){w.hide();if(x.data.press){x.data.press(l.getSelectIds(),l,x)}}).appendTo(w)}w.css({left:i.offset().left,top:i.offset().top+i.outerHeight()-1});if(w.width()<60){w.width(60)}w.show();u.stopPropagation();a("body").one("click",function(){w.hide()})},newAjaxRows:function(v,u,t,i){if(jv.IsNull(t)){t=v.data("rowLevel")+1}if(jv.IsNull(i)){i=v[0]}var g=[],w=document.createElement("tr");var x=a(w).insertAfter(i);l.dataToRow(u,w,t,u.rows===true?true:(u.rows?u.rows.length:0));l.addTreeProp(x);if(u.rows!=true&&!!u.rows){a.each(u.rows,function(y,z){if(d===true){return}newAjaxRows(v,z,t+1,x)})}},ajaxNodes:function(g){g.one("click.ajaxNode",function(i){var t=jv.getParentTag(g[0],"TR");l.populate({url:c.ajaxUrl.format(t.id.slice(3))},r.addAjaxNode,t,true)})},addAjaxNode:function(u,t){l.updateData(u,t.id.slice(3));a(l.block).remove();l.loading=false;if(!u||!u.rows||!u.rows.length){return}var i=t.rowIndex+1;if(u.isTree){var g=a(t);a.each(u.rows,function(v,w){if(w===true){return}r.newAjaxRows(g,w,g.data("rowLevel")+1)})}else{throw Error("Ajax加载要求是加载树节点.请检查代码.")}},setPageQuoteFromRow:function(g){a.each(l.getjTr(g),function(){var i=a(this);var t=i.attr("id").slice(3);if(!t){return}l.setPageQuoteValue(t,l.isSelected(i))})}};var l={hset:{},rePosDrag:function(){return;var g=0,i=false;if(a("thead tr:last th:visible",b).length<2){i=true}a("thead tr:last th",b).each(function(u,x){var t=a(x),y=t.index(),w=a("div:eq("+y+")",l.cDrag);if(!i&&t.is(":visible")){var v=g+t.width()+parseInt(t.css("paddingLeft"))+parseInt(t.css("paddingRight"))+parseInt(t.css("borderLeftWidth"))+parseInt(t.css("borderRightWidth"));w.css({left:v-1});g=v;if(a.browser.msie){g=g+2}}else{w.css({left:"0px"});w.hide()}})},fixHeight:function(g){return;g=g||c.height;a(l.bDiv).height(g)},dragStart:function(x,w,v){if(x=="colresize"){a(l.nDiv).hide();a(l.nBtn).hide();var y=a("div",this.cDrag).index(v),i=a("thead tr:last th:eq("+y+")",b),t=i.width()-jv.GetInt(i.css("borderLeftWidth"))-jv.GetInt(i.css("borderRightWidth"))-jv.GetInt(i.css("paddingLeft"))-jv.GetInt(i.css("paddingRight"));a(v).addClass("dragging");a(v).prevUntil("div:visible").eq(0).addClass("dragging").show();this.colresize={startX:w.pageX,ol:parseInt(v.style.left),ow:t,n:y};a("body").css("cursor","col-resize")}else{if(x=="vresize"){var u=false;a("body").css("cursor","row-resize");if(v){u=true;a("body").css("cursor","col-resize")}if(c.width=="auto"){c.width=a(this.gDiv).width()}this.vresize={h:c.height,sy:w.pageY,w:c.width,sx:w.pageX,hgo:u}}else{if(x=="colMove"){if(c.draggable){a(l.nDiv).hide();a(l.nBtn).hide();this.hset=a(this.bDiv).offset();var g=a("table:not(.fixedTableHeader) thead",this.bDiv);this.hset.right=this.hset.left+g.width();this.hset.bottom=this.hset.top+g.height();this.dcol=v;this.dcoln=g.find("th").index(v);this.colCopy=document.createElement("div");this.colCopy.className="colCopy";this.colCopy.innerHTML=v.innerHTML;if(a.browser.msie){this.colCopy.className="colCopy ie"}a(this.colCopy).css({position:"absolute","float":"left",display:"none",textAlign:v.align});a("body").append(this.colCopy);a(this.cDrag).hide()}}}}a("body").noSelect()},dragMove:function(w){if(this.colresize){var i=this.colresize.n,D=w.pageX-this.colresize.startX,z=this.colresize.ol+D,u=this.colresize.ow+D;if(u>c.minwidth){a("div:eq("+i+")",this.cDrag).css("left",z);this.colresize.nw=u}else{}}else{if(this.vresize){var E=this.vresize,B=w.pageY,D=B-E.sy;if(!c.defwidth){c.defwidth=300}if(!c.nohresize&&E.hgo){var C=w.pageX,t=C-E.sx,g=E.w+t;if(g>c.defwidth){this.gDiv.style.width=g+"px";c.width=g}}var A=E.h+D;if((A>c.minheight||c.height<c.minheight)&&!E.hgo){this.bDiv.style.height=A+"px";c.height=A;this.fixHeight(A)}E=null}else{if(this.colCopy){a(this.dcol).addClass("thMove").removeClass("thOver");if(w.pageX>this.hset.right||w.pageX<this.hset.left||w.pageY>this.hset.bottom||w.pageY<this.hset.top){a("body").css("cursor","move")}else{a("body").css("cursor","pointer")}a(this.colCopy).css({top:w.pageY+10,left:w.pageX+20,display:"block"})}}}},dragEnd:function(){l.standardRow=null;if(this.colresize){var t=this.colresize.n,g=this.colresize.nw;var i=function(v,u){var w=a("thead tr:last th:eq("+t+")",b);w.find(">div").css("width",v);if(u){w.css("width",v)}a("tbody tr",b).each(function(){var x=a("td:eq("+t+")",a(this));x.find(">div").css("width",v);if(u){x.css("width",v)}})};i(g,true);c.colModel[t].width=g;a(".dragging",this.cDrag).removeClass("dragging");this.rePosDrag();this.fixHeight();this.colresize=false}else{if(this.vresize){this.vresize=false}else{if(this.colCopy){a(this.colCopy).remove();if(this.dcolt!=null){if(this.dcoln>this.dcolt){a("thead tr:last th:eq("+this.dcolt+")",b).before(this.dcol)}else{a("thead tr:last th:eq("+this.dcolt+")",b).after(this.dcol)}this.switchCol(this.dcoln,this.dcolt);a(this.cdropleft).remove();a(this.cdropright).remove()}this.dcol=null;this.hset=null;this.dcoln=null;this.dcolt=null;this.colCopy=null;this.rePosDrag();a(".thMove",this.bDiv).removeClass("thMove");a(this.cDrag).show()}}}a("body").css("cursor","default");a("body").noSelect(false)},toggleCol:function(i,u){var t=this.bDiv;var v=a("thead tr:last th[bindName="+i+"]",t).index();var g=1;a("tr",s).each(function(){if(u){if(g>0){g--;a("th:eq("+v+")",this).css("display","")}else{a("td:eq("+v+")",this).css("display","")}a(".cDrag>div:eq("+v+")",t).show();c.colModel[v].headDisplay=true}else{if(g>0){g--;a("th:eq("+v+")",this).hide()}else{a("td:eq("+v+")",this).hide()}a(".cDrag>div:eq("+v+")",t).hide();c.colModel[v].headDisplay=false}});this.rePosDrag();if(c.onToggleCol){c.onToggleCol(cid,u)}return false},switchCol:function(i,g){a("tbody tr",s).each(function(){if(i>g){a("td:eq("+g+")",this).before(a("td:eq("+i+")",this))}else{a("td:eq("+g+")",this).after(a("td:eq("+i+")",this))}});if(i>g){a("tr:eq("+g+")",this.nDiv).before(a("tr:eq("+i+")",this.nDiv))}else{a("tr:eq("+g+")",this.nDiv).after(a("tr:eq("+i+")",this.nDiv))}},scroll:function(){},getColContent:function(v,t,w){var g=v.cell[l.getColModel(t.name)["indexOfBind"]],u;if(t.format){if(a.isFunction(t.format)){u=t.format(v,r.rowIndex,l,w,g)+"";if(jv.IsNull(u)){var i=l.getColModel(t.name)["indexOfBind"];u=v.cell[i]}}else{u=t.format+""}a.each(l.keys,function(z,y){var x=l.cols[y];u=r.tempReplaceFunc(u,y,function(){return v.cell[x.indexOfBind]})});u=r.tempReplaceFunc(u,"#",function(){return v.cell[l.cols[t.name]["indexOfBind"]]})}else{u=g}return u||c.blankHtml},setPageQuoteValue:function(y,w){var t=l.getJson(y);if(c._Ref_Type_=="radio"){c.PageQuote=[t]}else{var z=-1;a.each(c.PageQuote,function(i){var A=this;if("id" in A){if((A.id==t.id)||A.id==t[c.role.id]){z=i;return false}}if(c.role.id in A){if((A[c.role.id]==t.id)||A[c.role.id]==t[c.role.id]){z=i;return false}}});if(w){if(z<0){c.PageQuote.push(t)}else{var x=jv.GetJsonKeys(t);for(var v=0,g=x.length;v<g;v++){var u=x[v];c.PageQuote[z][u]=t[u]}}}else{if(z>=0){jv.remove(c.PageQuote,function(i){if("id" in i){return i.id==y}else{if(c.role.id in i){return i[c.role.id]==y}}})}}}},getRowCount:function(i){if(!i){return 0}if(!i.length){return 0}var g=i.length;a.each(i,function(){g+=l.getRowCount(this)});return g},setQuoteSelect:function(g){l.setQuoteData(g);l.setQuoteStyle(g)},setQuoteData:function(g){if(c.PageQuote){g=g||l.data.rows;if(g===true){return}if(!g.length){return}var t=l.getColModel(c.role.name).indexOfCell;var i=l.getColModel(c.role.id).indexOfBind;a.each(g,function(){if(this.rows){l.setQuoteData(this.rows)}var v=this;var w=jv.indexOf(c.PageQuote,function(x){return x.id==v.cell[i]||x.id==v.id});if(w>=0){var u=document.getElementById("row"+v.id);if(!u){return}l.setSelectRow(u)}})}},setQuoteStyle:function(g){if(c.PageQuote){g=g||l.data.rows;if(g===true){return}if(!g.length){return}var t=l.getColModel(c.role.name).indexOfCell;var i=l.getColModel(c.role.id).indexOfBind;a.each(g,function(){if(this.rows){l.setQuoteStyle(this.rows)}var w=this;var y=jv.indexOf(c.PageQuote,function(z){return z.id==w.cell[i]||z.id==w.id});if(y>=0){var v=document.getElementById("row"+w.id);if(!v){return}var x=v.cells[t];if(x){var u=jv.getNodes(x,function(z){return z.tagName=="DIV"});if(u.length){x=u[0]}x.style.outline="dotted 1px coral"}}})}},addTreeProp:function(g){g=a(g);if(l.data.isTree&&c.role.tree){var i=g.find(".addon");i.css("width",(g.data("rowLevel")||0)*12-3+8+"px");var u=function(){a(jv.getParentTag(i[0],"TD")).click(function(w){var v=jv.GetDoer(w);if(a(v).hasClass("addon")){l.toggleTree(v,w.altKey);w.stopPropagation()}})};var t=g.data("hasChild");if(t===true){i.html("±");i.data("status","close");r.ajaxNodes(i);u()}else{if(t){i.html("-");i.data("status","open");u()}}}},dataToRow:function(x,H,v,y){if(x===true){return null}r.rowIndex++;if(r.rowIndex%2&&c.striped){H.setAttribute("class","erow")}H.id="row"+x.id;var z=a(H);var g;var C=false;for(var A=0,D=l.keys.length;A<D;A++){var t=l.cols[l.keys[A]];if(!t){return}var w=document.createElement("td");H.appendChild(w);var F=[];if(t.css){F.push(t.css)}if(!t.headDisplay){w.style.display="none"}if(t.align){w.setAttribute("align",t.align)}if(t.sortable&&c.sortname&&(c.sortname==t.name)){F.push("sorted")}if(!C&&!c.useSelect&&t.headDisplay){F.push("first");C=true}if(F.length){w.setAttribute("class",F.join(" "))}var E=l.getColContent(x,t,w);var G="";if(l.data.isTree&&(t.name==c.role.tree)){G='<span class="addon"></span>';z.data("rowLevel",v||0).data("hasChild",y||false)}if(t.align){w.align=t.align}w.innerHTML=G+E;if(t.name==c.role.select){g=E}if(t.onpress){w.onclick=function(i){return t.onpress(x,r.rowIndex,l,jd,i)}}}if((g=="true"||g=="True"||g=="是"||parseInt(g)>0)){if(c.onSelect&&(c.onSelect(H,l)===false)){return false}l.setSelectRow(H);var u=H.cells[l.getColModel(c.role.name)["indexOfCell"]];if(u){var B=jv.getNodes(u,function(i){return i.tagName=="DIV"});if(B.length){u=B[0]}u.style.outline="dotted 1px coral"}if(c.onSelected){c.onSelected(H,l)}}},addRow:function(i,g){if(!i){return}if(!l.data){l.data={};l.data.rows=[];l.data.total=0}a(l.block).remove();l.data.rows.push(i);l.data.total+=1;var t=b.find(">tbody");if(t.length==0){b.append("<tbody />");t=b.find(">tbody")}r.newTreeRows(i,null,function(){var u=document.createElement("tr");t[0].appendChild(u);return u});l.createFooter()},deleteRow:function(x){if(!x){return}if(!l.data){return}a(l.block).remove();l.data.rows.Recursion(function(z,A,B){return B.rows},function(z,A,B){if(B.id==x){z.removeAt(A);return false}});l.data.total-=1;var g=a("#row"+x);if(l.data.isTree){var w=g.data("rowLevel");if(!jv.IsNull(w)){var y=g[0].rowIndex-b.find(">thead>tr").length;var v=b.find(">tbody>tr").length-y;g.remove();for(var t=y;t<v-1;t++){var u=b.find(">tbody>tr:eq("+y+")");if(u.data("rowLevel")<=w){break}u.remove()}}}else{g.remove()}r.rowIndex--;l.createFooter()},updateRow:function(u,t){if(!t){return}if(!l.data){return}a(l.block).remove();l.data.rows.Recursion(function(w,x,y){return y.rows},function(w,x,y){if(y.id==u){w[x]=t;return false}});var g=b.find(">tbody>tr#row"+u);var i=g.index();g.rmove();var v=document.createElement("tr");b.find(">tbody")[0].appendChild(v);l.dataToRow(t,v);l.createFooter()},setGroup:function(){var i=c.role.group.mySplit(",",true);if(!i||!i.length){return}b.find("thead tr:last th").css("borderBottomWidth","0px");var g=-1;var t=a.grep(l.data.sort.mySplit(",",true),function(v,u){return a.inArray(v,i)>-1});a.each(t,function(x,y){if(!y){return}var w=l.getColModel(y);if(!w){return}var v=w.indexOfCell;if(g<0){var u=-1;b.find(">tbody>tr").each(function(z,A){if(u<0){u=a(A).find("td:eq("+v+")").prevAll("td:visible:first").index()}var B=a(A).find("td:eq("+u+")").css("borderRight",c.role.groupStyle);if(a.browser.msie){B.css("borderRightWidth","2px")}})}l.setGroupColumnStyle(v,g);g=v})},setGroupColumnStyle:function(t,i){if(!t){return}var x,u,v,g="",w=1;b.find(">tbody>tr").each(function(A,E){var y=a(E),z=y.find(">td:eq("+t+")"),D=z.text(),C="";if(i>=0){C=y.find(">td:eq("+i+")").attr("wbs")}if(A===0){v=z;z.css("borderTop",c.role.groupStyle).css("borderRight",c.role.groupStyle).css("borderBottom",c.role.groupStyle).css("backgroundColor","white").css("backgroundImage","none").css("verticalAlign","middle")}else{if(A>0){if(u==D&&(C==g)){z.hide();w++}else{x.css("borderBottom",c.role.groupStyle);if(w>1){v.attr("rowspan",w)}v=z;v.css("borderRight",c.role.groupStyle).css("borderBottom",c.role.groupStyle).css("backgroundColor","white").css("backgroundImage","none").css("verticalAlign","middle");w=1}}}var B=jv.getParentTag(v[0],"TR").rowIndex;if(i>=0){z.attr("wbs",C+"."+B)}else{z.attr("wbs",B)}g=C;u=z.text();x=z});if(w>1){v.attr("rowspan",w)}},updateCache:function(g){g=g||l.data;if(!c.PageQuote||!c.PageQuote.length){return}if(!g||!g.rows){return}a.each(g.rows,function(){var t=this;var i=a.grep(c.PageQuote,function(v,u){return v.id==t.id})[0];if(i){l.setPageQuoteValue(t,true)}})},loadFromData:function(i){if(!i.entity){i.entity=""}l.standardRow=null;r.rowIndex=-1;if(c.preProcess){i=c.preProcess(i)}l.data=null;l.updateData(i);if(this.pDiv){a(".pReload",this.pDiv).removeClass("loading")}a(".inpbox",l.bDiv).removeClass("chked").removeClass("chkpart");a(l.block).remove();if(!i||i.ErrorMsg||i.msg){if(this.pDiv){a(".pPageStat",this.pDiv).html('<div class="flexiErrMsg Wrap">'+jv.highlightLogin(i.msg||i.ErrorMsg||i.msg||c.errormsg)+"</div>")}else{b.append('<tbody><tr><td colspan="100" class="flexiErrMsg Wrap">'+jv.highlightLogin(i.ErrorMsg||i.msg||c.errormsg)+"</td></tr></tbody>")}r.removePageQuoteData();this.loading=false;return false}b.attr("entity",i.entity);if(c.dataType=="xml"){c.total=+a("rows total",i).text()}else{c.total=i.total}if((c.total==0)||(c.total&&!i.rows.length)){a("tr, a, td, div",s).unbind();b.find(">tbody").remove();b.find(">tfoot").remove();c.pages=1;c.page=1;this.buildpager();if(this.pDiv){a(".pPageStat",this.pDiv).html(a("<span class='Wrap flexiErrMsg'>"+jv.highlightLogin(i.ErrorMsg||c.nomsg)+"</div>"))}if(c.onSuccess){if(l.data.ExtraJs){jv.ExecJs(l.data.ExtraJs)}c.onSuccess(this,s)}this.loading=false;return false}c.pages=Math.ceil(c.total/c.take);if(c.dataType=="xml"){c.page=+a("rows page",i).text()}else{c.page=i.page||c.newp}this.buildpager();a("tr",s).unbind();b.find(">tbody").remove();r.removePageQuoteData();var g=document.createElement("tbody");b.append(g);if(c.dataType=="json"){a.each(l.data.rows,function(){var t=r.newTreeRows(this,null,function(){var u=document.createElement("tr");g.appendChild(u);return u})})}else{if(c.dataType=="xml"){alert("请用 Json 格式!")}}l.appendNulHeader();l.createFooter();if(l.data.isTree&&!c.treeOpen){b.find(">tbody>tr:visible").each(function(){l.toggleTree(a(this).find("div>span.addon"))})}this.rePosDrag();l.setGroup();if(c.resizeCallback){c.resizeCallback()}if(c.onSuccess){if(l.data.ExtraJs){jv.ExecJs(l.data.ExtraJs)}c.onSuccess(this,s)}g=null;i=null;f=null;if(c.hideOnSubmit){a(l.block).remove()}if(a.browser.opera){b.css("visibility","visible")}l.fixBrower();if(c._Ref_Type_=="check"||c._Ref_Type_=="radio"||c.keepQuote){l.setQuoteSelect();r.All_Selected=r.updateHeaderChk();l.updateRefTile()}this.loading=false},updateRefTile:function(){if(c._Ref_Type_!="check"&&c._Ref_Type_!="radio"){return}if(l.refTitled){return}window.document.title="{0}-{1} (引用{2}条)({3})".format((c._Ref_Type_=="check"?"【多选】":(c._Ref_Type_=="radio"?"单选":"")),window.document.title,c.PageQuote.length,a.map(c.PageQuote,function(g){return g.name}).join(","));l.refTitled=true},appendNulHeader:function(){return;var t=document.createElement("tr");t.className="nulRow";a(b).find(">tbody").append(t);for(var v=0,g=l.keys.length;v<g;v++){var u=l.cols[l.keys[v]];if(!u){continue}var w=document.createElement("td");t.appendChild(w);if(!u.headDisplay){w.style.display="none"}}},createFooter:function(){if(c.tfoot){b.find("tfoot").remove();var z=document.createElement("tfoot");b.append(z);var A=document.createElement("tr");z.appendChild(A);for(var v=0;v<l.keys.length;v++){var t=l.cols[l.keys[v]];if(!t){continue}var u=document.createElement("td");A.appendChild(u);if(t.align){u.align=t.align}if(!t.headDisplay){u.style.display="none"}}z.appendChild(A);for(var g in c.tfoot){var y=l.getCellIndex(g);var w;if(a.isFunction(c.tfoot[g])){var B=[];a(b.find(">tbody>tr")).each(function(C,D){B.push(D.cells[y])});w=c.tfoot[g](B,b,l)}else{w=c.tfoot[g]}var x=A.cells[y];if(x.childNodes.length){x=x.childNodes[0]}x.innerHTML=w}}},changeSort:function(t,u){if(this.loading){return true}var g=a(t);a(l.nDiv).hide();a(l.nBtn).hide();var i=l.cols[l.keys[t.cellIndex]];if(!u){if(c.sortname==i.name){if(c.sortorder=="asc"){c.sortorder="desc"}else{if(c.sortorder=="desc"){c.sortname="";c.sortorder="asc";g.removeClass("sorted").siblings().removeClass("sorted");a(".sdesc",b).removeClass("sdesc");a(".sasc",b).removeClass("sasc");if(c.onChangeSort){c.onChangeSort(c.sortname,c.sortorder)}else{this.populate()}return}else{c.sortorder="asc"}}}else{c.sortname=i.name}g.addClass("sorted").siblings().removeClass("sorted");a(".sdesc",b).removeClass("sdesc");a(".sasc",b).removeClass("sasc");g.addClass("s"+c.sortorder)}else{if(c.sortname==i.name){if(c.sortorder=="asc"){c.sortorder="desc"}else{c.sortorder="asc"}}g.addClass("sorted").siblings().removeClass("sorted");a(".sdesc",b).removeClass("sdesc");a(".sasc",b).removeClass("sasc");g.addClass("s"+c.sortorder);c.sortname=i.name}if(c.onChangeSort){c.onChangeSort(c.sortname,c.sortorder)}else{this.populate()}},buildpager:function(){if(this.pDiv){a(".pcontrol input",this.pDiv).removeAttr("disabled").val(c.page);a(".pcontrol span",this.pDiv).html(c.pages);if(c.pages==1){a(".pcontrol input",this.pDiv).attr("disabled","true")}var i=(c.page-1)*c.take+1,g=i+c.take-1,t=c.pagestat;if(c.total<g||g<=0){g=c.total}t=t.replace(/{from}/,i);t=t.replace(/{to}/,g);t=t.replace(/{total}/,c.total);a(".pPageStat",this.pDiv).html(t)}},populate:function(u,t,i,w){var B=c.url;c=a.extend(c,u);var g=c.url;if(w){c.url=B}if(!g&&!c.DataSource){return false}if(this.loading){return true}this.loading=true;if(c.onSubmit){var y=c.onSubmit();if(y===false){return false}}if(this.pDiv){a(".pPageStat",this.pDiv).html(c.procmsg);a(".pReload",this.pDiv).addClass("loading")}a(l.block).css({marginBottom:0-l.bDiv.offsetHeight,height:l.bDiv.offsetHeight});if(c.hideOnSubmit){a(this.gDiv).prepend(l.block)}if(a.browser.opera){b.css("visibility","hidden")}if(!c.newp){c.newp=1}if(c.page>c.pages){c.page=c.pages}var z=c.query||{};z.FlexiGrid_Page=c.newp;z.FlexiGrid_Skip=(parseInt(c.newp||1)-1)*c.take;z.FlexiGrid_Take=c.take;z.FlexiGrid_SortName=(c.sortname=="__AutoID__"?"":c.sortname)||"";z.FlexiGrid_SortOrder=c.sortorder||"";z.FlexiGrid_Cols=l.bindKeys.join(",");z.FlexiGrid_Id=c.role.id;z.FlexiGrid_RefId=a.map(c.PageQuote||[],function(D){return D.id});if(a.isEmptyObject(c.params)){var C=jv.GetJsonKeys(c.params);for(var x=0,A=C.length;x<A;x++){var v=C[x]}z[v]=c.params[v]}if(c.DataSource){l.loadFromData(a.isFunction(c.DataSource)?c.DataSource(l.bindKeys,z,l):c.DataSource);if(l.pDiv){a(".pReload",l.pDiv).removeClass("loading");l.loading=false}c.DataSource=null;return}var g=jv.url(g);g.attr("_",jv.Random());g=g.tohref();a.ajax({type:c.method,url:g,data:z,dataType:c.dataType,success:function(D){t?t(D,i):l.loadFromData(D,i)},error:function(F){if(l.pDiv){a(".pReload",l.pDiv).removeClass("loading");l.loading=false;var D="（格式错误）";try{if(/^(?:\{.*\}|\[.*\])$/.test(F.responseText)){var E=a.parseJSON(F.responseText)||{};D=E.msg||E.ErrorMsg||E.error||"服务器错误，但并没有返回内容"}else{D=a(F.responseText).filter("title").text()}}catch(G){}a(".pPageStat",l.pDiv).html("<label class='Wrap flexiErrMsg'>数据加载错误: </label>"+jv.highlightLogin(D))}try{if(c.onError){c.onError(F)}}catch(G){}}})},doSearch:function(g){if(g instanceof String){c.query={query:g}}else{c.query=g}c.newp=1;c.PageQuote=jQuery.extend(c.PageQuote,c.PageQuote);l.populate()},changePage:function(i){if(this.loading){return true}switch(i){case"first":c.newp=1;break;case"prev":if(c.page>1){c.newp=parseInt(c.page)-1}break;case"next":if(c.page<c.pages){c.newp=parseInt(c.page)+1}break;case"last":c.newp=c.pages;break;case"input":var g=parseInt(a(".pcontrol input",this.pDiv).val());if(isNaN(g)){g=1}if(g<1){g=1}else{if(g>c.pages){g=c.pages}}a(".pcontrol input",this.pDiv).val(g);c.newp=g;break}if(c.newp==c.page){return false}if(c.onChangePage){c.onChangePage(c.newp)}else{this.populate()}},findRowData:function(g,t){var i;if(g===true){return null}a.each(g,function(u,v){if(v.id==t){i=v;return false}if(v.rows){i=l.findRowData(v.rows,t);if(i){return false}}});return i},getAllJsons:function(D){if(!l.data){D=true}var x=[];if(D){for(var g=0,y=b.find(">tbody>tr").length;g<y;g++){var B=b.find(">tbody>tr:eq("+g+")");var u={};for(var w=0,t=l.bindKeys.length;w<t;w++){var A=l.bindKeys[w];var z=l.cols[A]["indexOfCell"];var v=B.children("td:eq("+z+")").text();u[A]=v}x.push(u)}}else{for(var g=0,y=l.data.rows.length;g<y;g++){var u={};for(var w=0,t=l.bindKeys.length;w<t;w++){var A=l.bindKeys[w];var z=l.cols[A]["indexOfBind"];var C=l.data.rows[g];var v=jv.decode(C.cell[z]);u[l.bindKeys[w]]=v}x.push(u)}}return x},getRowJson:function(B,H,A){var E,g,C,x,y=jv.getType(B);if(B&&B.id&&(y=="object")){C=!!B.cell;if(!C){x=true}}if(C||x){g=B.id;E=a("#row"+g)}else{if(y=="string"){g=B;E=a("#row"+g)}else{E=l.getjTr(B);g=E.attr("id").slice(3)}}if(!g){return null}var u={};if(!l.data){H=true}if(H){for(var w=0,t=l.bindKeys.length;w<t;w++){var D=l.bindKeys[w];if(D){var z=l.cols[D]["indexOfCell"];var v=E.children("td:eq("+z+")").text();if(A&&(A(D,v,z)===false)){return v}else{u[D]=v}}}}else{var G=C?B:l.findRowData(l.data.rows,g);if(jv.IsNull(G)){u=a.grep(c.PageQuote,function(J,I){return J.id==g||J[c.role.id]==g})[0];if(u){var F=jv.GetJsonKeys(u);if(A){var v;a.each(F,function(I,J){v=u[J];if(A(I,v,J)==false){return false}});return v}if(l.bindKeys.minus(F).length){if(A){var v;a.each(F,function(I,J){v=u[J];if(A(I,v,J)==false){return false}});return v}return u}}}u={};for(var w=0,t=l.bindKeys.length;w<t;w++){var D=l.bindKeys[w];var z=l.cols[D]["indexOfBind"];var v=jv.decode(G.cell[z]);if(A&&(A(D,v,z)===false)){return v}else{u[l.bindKeys[w]]=v}}}if(!(c.role.id in u)){u[c.role.id]=g}if(!("id" in u)){u.id=g}if(!("name" in u)){u.name=u[c.role.name]}return u},getJsonValue:function(v,t){var w,g,u,i=jv.getType(v);if(v&&v.id&&(i=="object")){g=!!v.cell;if(!g){u=true}}if(u&&(t in v)){return v[t]}if(g){return v.cell[l.getColModel(t)["indexOfBind"]]}if(i=="string"){w=v}else{w=l.getjTr(v).attr("id").slice(3)}if(!w){return null}return l.findRowData(l.data.rows,w).cell[l.getColModel(t)["indexOfBind"]]},getRowDetail:function(u){var i,g=l.getColModel(l.p.role.name);if(!g){a.each(l.cols,function(){if(!this.headDisplay){return}g=this;return false})}i=g.display;var t=l.getJsonValue(u,g.name);return{name:i,value:t,toString:function(){return this.name+" : "+this.value}}},getCellIndex:function(i){var g=l.getColModel(i);if(g){return g.indexOfCell}return -1},getName:function(g){if(a.isFunction(g)){return g()}else{return g}},toggleTree:function(v,g){v=a(v);if(v.length==0){return}var y=v.data("status");if(y!="open"&&y!="close"){return}var G=jv.getParentTag(v[0],"TABLE").rows,B=jv.getParentTag(v[0],"TD").cellIndex,F=jv.getParentTag(v[0],"TR"),D=F.rowIndex,w=a(F).data("rowLevel")||0,C=D,A="";for(var z=D+1,E=G.length;z<E;z++){var u=a(G[z]),x=u.data("rowLevel")||0;if(x>w){if(y=="open"){u.hide();if(g){if(u.data("hasChild")){u.find("span.addon").data("status","close").html("+")}}}else{if(y=="close"){if(g){u.show();if(u.data("hasChild")){u.find("span.addon").data("status","open").html("−")}}else{if(x-w==1){u.show();A=u.find("span.addon").data("status");continue}else{if(A=="open"){u.show();var t=u.find("span.addon").data("status");if(t){A=t}continue}}}}}}else{break}}if(y=="open"){v.data("status","close").html("+")}else{v.data("status","open").html("−")}},updateData:function(g,i){if(!l.data){l.data=g;l.updateCache(g);return}if(l.data.rows.Recursion){if(l.data.rows.Recursion(function(t,u,v){return v.rows},function(t,u,v){if(v.id==i){v.rows=g.rows;return false}})){}}l.updateCache(g)},getCellDim:function(t){var x=a(t),y=parseInt(x.height()),g=parseInt(x.parent().height()),v=parseInt(t.style.width),A=parseInt(x.parent().width()),w=t.offsetParent.offsetTop,i=t.offsetParent.offsetLeft,z=parseInt(x.css("paddingLeft")),u=parseInt(x.css("paddingTop"));return{ht:y,wt:v,top:w,left:i,pdl:z,pdt:u,pht:g,pwt:A}},addRowProp:function(){a("tbody tr",b).die("click.ori").live("click.ori",function(y){var z=this.parentNode;if(z.tagName!="TBODY"&&z.tagName!="TABLE"){return}if(z.parentNode!=s){var z=jv.getParentTag(z,"TR");if(z){a(z).trigger("click")}return false}var w=a(this);if(l.data&&(l.data.ErrorMsg||l.data.msg)){return}if(c.onSelect&&(c.onSelect(this,l)===false)){return false}var g=l.isSelected(w);if(r.decideBtnClick()){l.setSelectRow(this);r.setUpSelect(this);if(c.onSelected){c.onSelected(this,l)}return}if(!c.multiSelect){l.clearSelectRow();l.setSelectRow(w);g=true}else{if(g){l.setUnSelectRow(w)}else{l.setSelectRow(w)}g=!g}r.setUpSelect(this);r.setDownSelect(this);var v=w.index();if(c.multiSelect&&(y.shiftKey||y.altKey)&&(r.LastSelectedRowIndex===0||r.LastSelectedRowIndex)){var u=Math.min(r.LastSelectedRowIndex,v),x=Math.max(r.LastSelectedRowIndex,v);for(var t=u;t<x;t++){l.setSelectRow(a(">tbody>tr:eq("+t+")",b))}}r.updateHeaderChk();if(c.onSelected){c.onSelected(this,l)}r.LastSelectedRowIndex=v});if(c.dbclick){a("tbody tr",b).die("dblclick.ori").live("dblclick.ori",function(g){var i=this.parentNode;if(i.tagName!="TBODY"&&i.tagName!="TABLE"){return}if(i.parentNode!=s){var i=jv.getParentTag(i,"TR");if(i){a(i).trigger("click")}return false}c.dbclick(this)})}},getSelectIds:function(){return a.map(c.PageQuote,function(g){return g[c.role.id]})},addNewButton:function(u){if(!u.separator){var g=document.createElement("div"),t=a(g);g.className="fbutton";var v=l.getName(u.name);g.innerHTML="<div><span>"+v+"</span></div>";g.onpress=u.onpress;g.name=v;t.attr("value",v).attr("title",c.title||"");if(u.id){g.id=u.id}if(u.style){a(g).css(u.style)}if(u.onpress){t.bind("click",{btn:u},r.btnPress)}if(u.disabled){g.disabled=true;t.css("color","gray")}if(u.bclass){var i=a("span",g).addClass(u.bclass).css({paddingLeft:20})}return g}},createHeader:function(){var C=document.createElement("thead");C.className="hDiv";s.appendChild(C);var u=a(C);var D=document.createElement("tr");C.appendChild(D);D.className="row";for(z=0,colModelLen=l.keys.length;z<colModelLen;z++){var E=l.getColModel(l.keys[z]);var t=document.createElement("th");D.appendChild(t);var y=l.getName(E.name);var g=document.createElement("div");if(E.align){t.setAttribute("align",E.align);g.style.textAlign=E.align}if(!E.headDisplay){t.style.display="none"}else{if(E.width>0){g.style.width=E.width+"px"}if(E.maxWidth){g.style.maxWidth=E.maxWidth+"px"}if(E.minWidth){g.style.minWidth=E.minWidth+"px"}}if(E.sortable){a(t).click(function(i){l.changeSort(this,i.ctrlKey)}).hover(r.headerOver,r.headerOut);if(E.sortable&&y==c.sortname){g.className="sorted";t.className="s"+c.sortorder}}t.appendChild(g);g.innerHTML=E.display}if(c.moreCol&&C){a.each(c.moreCol(),function(){u.prepend(a(this).addClass("moreCol").addClass("row"))});c.showToggleBtn=false}var A=document.createElement("tr");A.className="nulRow";C.appendChild(A);for(var z=0,B=l.keys.length;z<B;z++){var v=l.cols[l.keys[z]];if(!v){continue}var x=document.createElement("th");A.appendChild(x);x.appendChild(document.createElement("hr"));var w=document.createElement("div");x.appendChild(w);if(!v.headDisplay){x.style.display="none"}else{if(v.width>0){x.style.width=v.width+"px"}if(v.maxWidth){x.style.maxWidth=v.maxWidth+"px"}if(v.minWidth){x.style.minWidth=v.minWidth+"px"}}}a(A).find("th div").each(function(){var i={};a(this).bindResize({down:function(G,H){var I=a(G);var F=a(l.bDiv).find(".hDiv").height();I.addClass("moving").css("left","0px").css("right","auto").css("top",(0-F)+"px").css("height",F+"px");i.x=H.clientX;i.width=I.width()},move:function(G,H){var F=i.width+H.clientX-i.x;a(G).width(F).html(F)},up:function(J,K){var L=a(J);var I=L.width();var G=L.prev(),H=G.parent();G.width(I);H.width(I);L.removeClass("moving");J.style.width="";J.style.right="";L.html("");var F=a(l.bDiv).find(".hDiv").height();L.parents(".nulRow:first").find("th div").css("left","").css("height",F+"px").css("top",(0-F)+"px")}})});l.updateColWidth();if(!c.showHeader){u.hide()}},updateColWidth:function(){return;var g=a(l.bDiv).find("tbody tr.nulRow")[0];a(l.bDiv).find("thead.hDiv tr.nulRow th").each(function(t){var v=jv.getNode(g,t);v.style.display=this.style.display;var w=a(this),u=w.width();v.style.width=u+"px"})},createContainer:function(){l.gDiv=document.createElement("div");var g=a(l.gDiv).addClass("flexigrid");if(c.FillHeight){g.addClass("FillHeight-")}if(a.browser.msie){g.addClass("ie")}g.attr("ofvh",b.attr("ofvh"));if(c.novstripe){g.addClass("novstripe")}g.width(c.width||"");b.before(l.gDiv);g.append(s)},getjTr:function(g){g=a(g);if(!g.length){return a(jv.getParentTag(jv.GetDoer(),"TR"))}var i=g[0];if(i.tagName=="TR"){return g}return a(jv.getParentTag(i,"TR"))},isSelected:function(g){return l.getjTr(g).hasClass("trSelected")},setSelectRow:function(g,i){if(i===false){return l.setUnSelectRow(g)}l.getjTr(g).each(function(t,u){var v=a(u);if(l.isSelected(v)){return}v.addClass("trSelected");r.setPageQuoteFromRow(v)})},setUnSelectRow:function(g){l.getjTr(g).each(function(t,u){var v=a(u);if(!l.isSelected(v)){return}v.removeClass("trSelected");r.setPageQuoteFromRow(v)})},clearSelectRow:function(g){a((g||l).bDiv).find(".trSelected").removeClass("trSelected");c.PageQuote=[]},createDivs:function(){l.bDiv=document.createElement("div");b.before(l.bDiv);if(c.resizable&&!c.FillHeight){l.vDiv=document.createElement("div");a(l.bDiv).after(l.vDiv)}l.rDiv=document.createElement("div");l.cDrag=document.createElement("div");l.block=document.createElement("div");l.nBtn=document.createElement("div");if(c.usepager){l.pDiv=document.createElement("div");a(l.bDiv).after(l.pDiv)}l.cDrag.className="cDrag";var g=a(l.bDiv);g.prepend(l.cDrag);if(c.FillHeight){g.addClass("FillHeight-")}g.addClass("bDiv").css({height:(c.height=="auto")?"auto":c.height+"px"}).append(s);if(c.height=="auto"){a("table:not(.fixedTableHeader)",l.bDiv).addClass("autoht")}},createButtons:function(){if(c._Ref_Type_){if(c._Ref_Type_=="radio"){c.buttons.push({name:"确 定",bclass:"return",title:"单选确定,返回单选选择的对象",onpress:r.btnRadioOkPress});c.buttons.push({name:"清 除",bclass:"minus",title:"清除所选数据",onpress:function(x,i,y){l.clearSelectRow(i)}});c.buttons.push({name:"返回空",bclass:"return_nul",title:"返回空值,双击返回数据!",onpress:function(x,i,y){var z=[{}];z.IsEmpty=true;jv.Hide(function(){c.RefCallback(c.role,z,l,{originalEvent:true,target:jv.GetDoer()})})}})}else{if(c._Ref_Type_=="check"){c.buttons.push({name:"确 定",bclass:"return",title:"确定返回当前面的改变数据,仅改变当前页!",onpress:r.btnCheckOkPress});c.buttons.push({name:"清 除",bclass:"minus",title:"清除所选数据",onpress:function(x,i,y){l.clearSelectRow()}});c.buttons.push({name:"返回空",bclass:"return_nul",title:"返回空值!",onpress:function(x,i,y){l.clearSelectRow();var z=[];z.IsEmpty=true;jv.Hide(function(){c.RefCallback(c.role,z,l,{originalEvent:true,target:jv.GetDoer()})})}})}}}if(c.buttons&&c.buttons.length){if(c.container){a.each(c.buttons,function(){c.newButton(this,l)})}else{l.tDiv=document.createElement("div");l.tDiv.className="tDiv";if(c.title){a(l.tDiv).append("<div class='ftitle'>"+c.title+"</div>")}var t=c.buttons.length||0,w=t;while(true){w--;if(w<0){break}var v=c.buttons[w];if(!v){continue}if(!v.separator){var g=l.addNewButton(v),u=a(g);a(l.tDiv).append(g);if(v.buttons){u.addClass("subBtn");u.bind("click",{btns:v.buttons},r.subMenuPress)}}else{a(l.tDiv).append(a("<div class='btnseparator'></div>").css(v.style||{}))}}a(l.gDiv).prepend(l.tDiv).css("borderTopWidth","0px")}}},createDragDiv:function(){return;var g=a(l.bDiv).height();a("thead tr:last th",b).each(function(t,v){var u=document.createElement("div");if(a(v).is(":visible")){a(u).css({left:a(v).offset().left+a(v).width()})}else{a(u).hide()}a(l.cDrag).append(u);if(!c.cgwidth){c.cgwidth=a(u).width()}a(u).css({height:g}).mousedown(function(i){l.dragStart("colresize",i,this)})});l.cdropleft=document.createElement("span");l.cdropleft.className="cdropleft";l.cdropright=document.createElement("span");l.cdropright.className="cdropright"},createResizeDiv:function(){if(!c.resizable){return}if(l.vDiv){l.vDiv.className="vGrip";a(l.vDiv).mousedown(function(g){l.dragStart("vresize",g)}).html("<span></span>")}if(!c.nohresize){l.rDiv.className="hGrip";a(l.rDiv).mousedown(function(g){l.dragStart("vresize",g,true)}).html("<span></span>").css("height",a(l.gDiv).height());a(l.gDiv).append(l.rDiv)}},createPager:function(){if(c.usepager){l.pDiv.className="pDiv";l.pDiv.innerHTML='<div class="pDiv2"></div>';var g="";if(c.take>0){var g=' <div class="pGroup"> <div class="pFirst pButton"><span></span></div><div class="pPrev pButton"><span></span></div> </div> <div class="btnseparator"></div> <div class="pGroup"><span class="pcontrol">第<input type="text" size="3" value="1" />页，共<span>1</span>页</span></div> <div class="btnseparator"></div> <div class="pGroup"> <div class="pNext pButton"><span></span></div><div class="pLast pButton"><span></span></div> </div> '}g+='<div class="btnseparator"></div> <div class="pGroup"> <div class="pReload pButton"><span></span></div> </div> <div class="btnseparator"></div> <div class="pGroup"><span class="pPageStat"></span></div>';a("div",l.pDiv).html(g);a(".pReload",l.pDiv).click(function(){l.populate()});a(".pFirst",l.pDiv).click(function(){l.changePage("first")});a(".pPrev",l.pDiv).click(function(){l.changePage("prev")});a(".pNext",l.pDiv).click(function(){l.changePage("next")});a(".pLast",l.pDiv).click(function(){l.changePage("last")});a(".pcontrol input",l.pDiv).keydown(function(t){if(t.keyCode==13){l.changePage("input");t.preventDefault();t.stopPropagation();return false}}).keypress(function(t){if(t.keyCode==13){t.preventDefault();t.stopPropagation();return false}}).keyup(function(t){if(t.keyCode==13){t.preventDefault();t.stopPropagation();return false}});if(c.take>0){var i=jv.Random();if(c.useTextHelper){a(".pDiv2",l.pDiv).prepend("<div class='pGroup'><input type='text' id='"+i+"' name='take' readonly='readonly' style='width:27px' value='"+c.take+"'/>条</div> <div class='btnseparator'></div>");if(!c.rpFixed){a("#"+i).TextHelper({data:c.rpOptions,change:function(t){c.take=parseInt(t);l.changePage("first");l.populate()}})}}else{a(".pDiv2",l.pDiv).prepend("<div class='pGroup'><select id='"+i+"' name='take'></select></div>");a.each(c.rpOptions,function(t,u){a("#"+i)[0].options.add(new Option(u,u))});a("#"+i).val(c.take).bind("change",function(){var t=this.value;c.take=parseInt(t);l.changePage("first");l.populate()})}a(".pDiv2",l.pDiv).prepend("<div class='pGroup' style='margin-left:10px;'>每页</div>")}}},createBlockDiv:function(){l.block.className="gBlock"},createDivEvents:function(){},fixBrower:function(){a(l.bDiv).each(function(){jv.fixIe7(this)});return;if(a.browser.msie&&a.browser.version<7){a(".bDiv,.mDiv,.pDiv,.vGrip,.tDiv, .sDiv",l.gDiv).css({width:"100%"});a(l.gDiv).addClass("ie6");if(c.width!="auto"){a(l.gDiv).addClass("ie6fullwidthbug")}}if(a.browser.msie&&a.browser.version<7){a("tr",l.nDiv).hover(function(){a(this).addClass("ndcolover")},function(){a(this).removeClass("ndcolover")})}},ToggleSelect:function(){if(c._Ref_Type_=="radio"){return}b.find("tbody tr").each(function(t,u){var g=a(u);if(!g.data("hasChild")){g.trigger("click")}})}};l.TableRowToData=l.getJson=l.getRowJson;l.newRow=l.addRow;var q=function(g,i){if(g=="after"){c.colModel=c.colModel.insertAt(c.colModel.length,i)}else{if(jv.getType(g)=="number"){if(g>=0){c.colModel=c.colModel.insertAt(g,i)}}else{if(g=="before"){c.colModel=c.colModel.insertAt(0,i)}else{i=a.extend(i,g);if(g.colIndex=="after"){c.colModel=c.colModel.insertAt(c.colModel.length,i)}else{if(jv.getType(g.colIndex)=="number"){c.colModel=c.colModel.insertAt(g.colIndex,i)}else{if(g.colIndex=="before"){c.colModel=c.colModel.insertAt(0,i)}}}}}}};if(c.useId){var k={display:c.IdName,toggle:false,bind:false,name:"__AutoID__",width:36,sortable:false,css:"pin",align:"left",format:function(g,i){return i+1}};if(!a.grep(c.colModel,function(t,g){return t&&t.name=="__AutoID__"}).length){q(c.useId,k)}}if(c.useSelect){var k={display:(c.multiSelect?c.checkSelectName:c.radioSelectName),toggle:false,bind:false,name:"__Select__",css:"tdSelect pin "+(c.multiSelect?"check":"radio"),sortable:false,align:"center",width:(c.multiSelect?45:35),format:function(t,v,g,u,i){return"<div>&nbsp</div>"}};if(!a.grep(c.colModel,function(t,g){return t&&t.name=="__Select__"}).length){q(c.useSelect,k)}}l.configKeys=function(){l.cols={};l.keys=[];l.bindKeys=[];var g=-1;a.each(c.colModel,function(v,i){if(!i){return}var w;if(i.bind!==false){++g;w=g}if(!i.align){i.align=""}if(i.hide){i.width=0}else{if(i.width==="auto"){i.headDisplay=true}else{if(i.width==="*"){i.headDisplay=true}else{if(jv.IsNull(i.width)){i.width="auto";i.headDisplay=true}else{i.width=parseInt(i.width);if(i.width>0){i.headDisplay=true}else{i.headDisplay=false}}}}}if(i.maxwidth){i.maxWidth=i.maxwidth}if(i.html){i.format=i.html}if(!i.name){return}var u=l.getName(i.name);var t=jv.JsonValuer(i,function(x,y){if((x=="format")||(x=="html")||(x=="onpress")){return false}return l},false);if((t.bind!==false)&&t.name){l.bindKeys.push(u)}t.indexOfCell=v;t.indexOfBind=w;l.keys.push(u);l.cols[u]=t})};l.getColModel=function(g){if(g in l.cols){return l.cols[g]}if(g==c.role.id){return{}}};l.configKeys();b.css("position","relative").attr({cellpadding:5,cellspacing:0,border:0}).show();l.createContainer();l.createDivs();l.createHeader();l.createButtons();l.createDragDiv();l.createResizeDiv();l.createPager();l.createBlockDiv();l.addRowProp();if(c.height=="auto"){var n=0;if(c.FillHeight){jv.fixHeight(l.bDiv)}}l.p=c;s.grid=l;if(c.url.length>0&&c.autoload){l.populate()}if(c.multiSelect&&c.useSelect){var m=l.getCellIndex("__Select__");if(m>=0){a(a(l.bDiv).find("table thead tr.row:last")[0].cells[m]).click(function(g){if(c.selectType=="all"){if(r.All_Selected){r.All_Selected=false}else{r.All_Selected=true}}var i=function(t,u){if(c.onSelect&&(c.onSelect(t,l,true)===false)){return}if(u){l.setSelectRow(t)}else{l.setUnSelectRow(t)}if(c.onSelected){c.onSelected(t,l,true)}};a(l.bDiv).find("table:not(.fixedTableHeader) tbody tr").each(function(){if(c.selectType=="all"){i(this,r.All_Selected)}else{i(this,!a(this).hasClass("trSelected"))}});r.updateHeaderChk()})}}return s};a.fn.getFlexiRowID=function(){return jv.getParentTag(this[0],"TR").id.slice(3)};a.fn.getFlexi=function(){var c=a(this).filter(".flexigrid").add(a(this).find(".flexigrid:first")).find(".bDiv>table:not(.fixedTableHeader)");if(c.length>0){return c[0].grid}else{var b=a(this).closest(".flexigrid").find(".bDiv>table:not(.fixedTableHeader)");if(b.length>0){return b[0].grid}else{return{p:{},populate:function(){}}}}};a.fn.flexigrid=function(b){this.grid=this.last().grid;return this.each(function(){a.addFlex(this,b)})};a.fn.noSelect=function(b){if(b==null){prevent=true}else{prevent=b}if(prevent){return this.each(function(){if(a.browser.msie||a.browser.safari){a(this).bind("selectstart",function(){return false})}else{if(a.browser.mozilla){a(this).css("MozUserSelect","none");a("body").trigger("focus")}else{if(a.browser.opera){a(this).bind("mousedown",function(){return false})}else{a(this).attr("unselectable","on")}}}})}else{return this.each(function(){if(a.browser.msie||a.browser.safari){a(this).unbind("selectstart")}else{if(a.browser.mozilla){a(this).css("MozUserSelect","inherit")}else{if(a.browser.opera){a(this).unbind("mousedown")}else{a(this).removeAttr("unselectable","on")}}}})}}})(jQuery);var hasTouch="ontouchstart" in document.documentElement,startEvent=hasTouch?"touchstart":"mousedown",moveEvent=hasTouch?"touchmove":"mousemove",endEvent=hasTouch?"touchend":"mouseup";jQuery.tableDnD={currentTable:null,dragObject:null,mouseOffset:null,oldY:0,build:function(a){this.each(function(){this.tableDnDConfig=jQuery.extend({onDragStyle:null,onDropStyle:null,onDragClass:"tDnD_whileDrag",onDrop:null,onDragStart:null,scrollAmount:5,serializeRegexp:/[^\-]*$/,serializeParamName:null,dragHandle:null},a||{});jQuery.tableDnD.makeDraggable(this)});return this},makeDraggable:function(c){var b=c.tableDnDConfig;if(b.dragHandle){var a=jQuery("td."+c.tableDnDConfig.dragHandle,c);a.each(function(){jQuery(this).bind(startEvent,function(f){jQuery.tableDnD.initialiseDrag(this.parentNode,c,this,f,b);return false})})}else{var e=jQuery("tr",c);e.each(function(){var f=jQuery(this);if(!f.hasClass("nodrag")){f.bind(startEvent,function(g){if(g.target.tagName=="TD"){jQuery.tableDnD.initialiseDrag(this,c,this,g,b);return false}}).css("cursor","move")}})}},initialiseDrag:function(c,b,e,f,a){jQuery.tableDnD.dragObject=c;jQuery.tableDnD.currentTable=b;jQuery.tableDnD.mouseOffset=jQuery.tableDnD.getMouseOffset(e,f);jQuery.tableDnD.originalOrder=jQuery.tableDnD.serialize();jQuery(document).bind(moveEvent,jQuery.tableDnD.mousemove).bind(endEvent,jQuery.tableDnD.mouseup);if(a.onDragStart){a.onDragStart(b,e)}},updateTables:function(){this.each(function(){if(this.tableDnDConfig){jQuery.tableDnD.makeDraggable(this)}})},mouseCoords:function(a){if(a.pageX||a.pageY){return{x:a.pageX,y:a.pageY}}return{x:a.clientX+document.body.scrollLeft-document.body.clientLeft,y:a.clientY+document.body.scrollTop-document.body.clientTop}},getMouseOffset:function(e,c){c=c||window.event;var b=this.getPosition(e);var a=this.mouseCoords(c);return{x:a.x-b.x,y:a.y-b.y}},getPosition:function(c){var b=0;var a=0;if(c.offsetHeight==0){c=c.firstChild}while(c.offsetParent){b+=c.offsetLeft;a+=c.offsetTop;c=c.offsetParent}b+=c.offsetLeft;a+=c.offsetTop;return{x:b,y:a}},mousemove:function(h){if(jQuery.tableDnD.dragObject==null){return}if(h.type=="touchmove"){event.preventDefault()}var e=jQuery(jQuery.tableDnD.dragObject);var b=jQuery.tableDnD.currentTable.tableDnDConfig;var k=jQuery.tableDnD.mouseCoords(h);var g=k.y-jQuery.tableDnD.mouseOffset.y;var c=window.pageYOffset;if(document.all){if(typeof document.compatMode!="undefined"&&document.compatMode!="BackCompat"){c=document.documentElement.scrollTop}else{if(typeof document.body!="undefined"){c=document.body.scrollTop}}}if(k.y-c<b.scrollAmount){window.scrollBy(0,-b.scrollAmount)}else{var a=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.clientHeight;if(a-(k.y-c)<b.scrollAmount){window.scrollBy(0,b.scrollAmount)}}if(g!=jQuery.tableDnD.oldY){var f=g>jQuery.tableDnD.oldY;jQuery.tableDnD.oldY=g;if(b.onDragClass){e.addClass(b.onDragClass)}else{e.css(b.onDragStyle)}var i=jQuery.tableDnD.findDropTargetRow(e,g);if(i){if(f&&jQuery.tableDnD.dragObject!=i){jQuery.tableDnD.dragObject.parentNode.insertBefore(jQuery.tableDnD.dragObject,i.nextSibling)}else{if(!f&&jQuery.tableDnD.dragObject!=i){jQuery.tableDnD.dragObject.parentNode.insertBefore(jQuery.tableDnD.dragObject,i)}}}}return false},findDropTargetRow:function(g,h){var l=jQuery.tableDnD.currentTable.rows;for(var f=0;f<l.length;f++){var k=l[f];var b=this.getPosition(k).y;var a=parseInt(k.offsetHeight)/2;if(k.offsetHeight==0){b=this.getPosition(k.firstChild).y;a=parseInt(k.firstChild.offsetHeight)/2}if((h>b-a)&&(h<(b+a))){if(k==g){return null}var c=jQuery.tableDnD.currentTable.tableDnDConfig;if(c.onAllowDrop){if(c.onAllowDrop(g,k)){return k}else{return null}}else{var e=jQuery(k).hasClass("nodrop");if(!e){return k}else{return null}}return k}}return null},mouseup:function(f){if(jQuery.tableDnD.currentTable&&jQuery.tableDnD.dragObject){jQuery(document).unbind(moveEvent,jQuery.tableDnD.mousemove).unbind(endEvent,jQuery.tableDnD.mouseup);var c=jQuery.tableDnD.dragObject;var b=jQuery.tableDnD.currentTable.tableDnDConfig;if(b.onDragClass){jQuery(c).removeClass(b.onDragClass)}else{jQuery(c).css(b.onDropStyle)}jQuery.tableDnD.dragObject=null;var a=jQuery.tableDnD.serialize();if(b.onDrop&&(jQuery.tableDnD.originalOrder!=a)){b.onDrop(jQuery.tableDnD.currentTable,c)}jQuery.tableDnD.currentTable=null}},serialize:function(){if(jQuery.tableDnD.currentTable){return jQuery.tableDnD.serializeTable(jQuery.tableDnD.currentTable)}else{return"Error: No Table id set, you need to set an id on your table and every row"}},serializeTable:function(e){var a="";var c=e.id;var f=e.rows;for(var b=0;b<f.length;b++){if(a.length>0){a+="&"}var g=f[b].id;if(g&&g&&e.tableDnDConfig&&e.tableDnDConfig.serializeRegexp){g=g.match(e.tableDnDConfig.serializeRegexp)[0]}a+=c+"[]="+g}return a},serializeTables:function(){var a="";this.each(function(){a+=jQuery.tableDnD.serializeTable(this)});return a}};jQuery.fn.extend({tableDnD:jQuery.tableDnD.build,tableDnDUpdate:jQuery.tableDnD.updateTables,tableDnDSerialize:jQuery.tableDnD.serializeTables});jv.FindNotTempDialogSrc=function(c){var b,a=jv.boxdy(c);if(a.length==1){return c}a.each(function(){var e=$(this);if(!e.data("boxy")){return true}if(e.data("boxy").options.tempDialog){b=e.data("srcForBoxy");return false}else{return false}});if(b){return b}else{return c}};function Boxy(b,a){this.boxy=jQuery(Boxy.WRAPPER);jQuery.data(this.boxy[0],"boxy",this);this.visible=false;this.options=jQuery.extend({},Boxy.DEFAULTS,a||{});this.options.unloadOnHide=true;if(this.options.modal){this.options=jQuery.extend(this.options,{center:true})}if(this.options.actuator){jQuery.data(this.options.actuator,"active.boxy",this)}if(a.width){this.boxy.find(".boxy-inner").width(a.width)}if(a.height){this.boxy.find(".boxy-inner").height(a.height)}this.setContent(b||"<div></div>");this._setupTitleBar();this.boxy.css("display","none").appendTo(document.body);this.options.tempDialog=true;this.boxy.addClass("jvRequest_waite").data("srcForBoxy",jv.FindNotTempDialogSrc(jv.GetDoer()));jv.AddRequest({boxy:this.boxy});this.toTop();this.center();if(this.options.show){this.show()}}Boxy.EF=function(){};jQuery.extend(Boxy,{WRAPPER:"<div class='boxy-wrapper'><div class='boxy-inner'></div></div>",DEFAULTS:{opacity:0.5,title:null,closeable:true,draggable:true,clone:false,actuator:null,center:true,hideAnimateTime:0,show:true,modal:false,fixed:true,closeText:"关闭",closeButton:false,unloadOnHide:true,clickToFront:false,behaviours:Boxy.EF,afterDrop:Boxy.EF,afterShow:Boxy.EF,beforeHide:Boxy.EF,afterHide:Boxy.EF,beforeUnload:Boxy.EF,afterUnload:Boxy.EF},DEFAULT_X:50,DEFAULT_Y:50,dragConfigured:false,resizeConfigured:false,dragging:null,load:function(){var e,c,b,h;if(arguments.length>1){e=arguments[0];c=arguments[1];b=arguments[2];h=arguments[3];c.url=e;c.LoadedCallBack=b;c.ReturnCallback=h}else{c=arguments[0];e=c.url;b=c.LoadedCallBack;h=c.ReturnCallback}c=c||{};c.unloadOnHide=true;c.url=e;c.ReturnCallback=h;if(!("width" in c)){c.width=701}var a=new Boxy($("<div><div class='loading'>加载中</div></div>"),$.extend({},c,{width:false,height:false}));if(!e){if(b){b(a)}return a}if(c.iframe){window._BoxyIframeLoad_=function(){b(a,a.boxy.find("iframe")[0].contentDocument)};var f=Boxy._viewport(c);a.moveToX(-3000).moveToY(-3000);a.setContent('<iframe src="'+e+'" style="padding:0px;margin:0px;border-width:0px;width:100%;height:99.9%;" onload="window._BoxyIframeLoad_();"/>',c);a.getContent().width(c.width||f.suitWidth).height(c.height||f.suitHeight).css("maxHeight",f.height+"px");a.center();return a}a.boxy.addClass("jvRequest_waite");var g={url:e,type:"GET",dataType:"html",cache:false,beforeSend:function(i){jv.CreateEventSource(i,a.boxy[0]);i.setRequestHeader("MyTitle","Json")},success:function(k){if(jv.HasValue(k)==false){a.options.loaderror=true;a.boxy.find(".boxy-content>div").html("<label style='color:red'>没有内容！</label>");return}else{if(k.charAt(0)=="{"){var i=null;try{i=$.parseJSON(k)}catch(n){}if(jv.IsNull(i)==false&&i.data=="power"){a.options.loaderror=true;var q="<div style='color:red'>"+i.msg+"</div><br /> 请联系管理员！";a.setContent($("<div style='padding:20px'>"+q+"</div>"),c);a.center();return}}}if(c.loading){c.loading(a)}a.options.tempDialog=false;k=$(k);var m=jv.myFilter(k,c.filter);var l=Boxy._viewport(c);a.moveToX(-3000).moveToY(-3000);a.setContent(m,c);a.getContent().width(l.suitWidth).height(l.suitHeight).css("maxHeight",l.height+"px");if(b){b(a)}jv.execHtml(k,null,a.boxy[0]);a.center();jv.page().boxy=a.boxy},error:function(i){a.options.loaderror=true;var l=jv.getErrorFromPage(i.responseText)||"服务器出现错误!";var k=l.indexOf("登录");if(k>=0){l=l.slice(0,k)+'<a class="Link" onclick="javascript:top.document.location='+(jv.url().root)+'Login.aspx"> 登录 </a>'+l.slice(k+2)}var l='<div><div class="question" style="color:red"><div class="icon error" /> <p class="Wrap">'+l+'</p></div><div class="answers">请检查数据正确性,或联系运维管理员.</div></div>';a.setContent(l,c);a.center()}};jQuery.each(["type","cache"],function(){if(this in c){g[this]=c[this];delete c[this]}});jQuery.ajax(g)},get:function(a){var b=jQuery(a);if(!b.hasClass("boxy-wrapper")){b=b.parents(".boxy-wrapper:first")}return b.length?jQuery.data(b[0],"boxy"):null},getOne:function(b){var e=0,c=null;if(!b){b=window}var a=$(".boxy-wrapper");a.each(function(){if(this.style.display=="none"){return}var f=$(this);if(f.css("zIndex")>e){if(f.hasClass("Ignore")){return true}e=f.css("zIndex");c=this}});if(c){return jQuery.data(c,"boxy")}else{if(b.parent&&b!=b.parent){return Boxy.getOne(b.parent)}}return null},linkedTo:function(a){return jQuery.data(a,"active.boxy")},alert:function(b,c,a){return Boxy.ask(b,["OK"],c,$.extend({title:"!"},a))},msg:function(c,b,f,a){var e=Boxy.ask(c,["OK"],f,a);if(parseInt(b)>0){setTimeout(function(){e.hide()},parseInt(b))}return e},confirm:function(b,c,a){return Boxy.ask(b,["OK","Cancel"],function(e){if(e=="OK"){c()}},a)},ask:function(a,c,e,b){return Boxy.html('<div class="question">'+a+"</div>",c,e,b)},html:function(b,f,k,l){l=jQuery.extend({modal:true,closeable:true,title:"?"},l||{},{show:true,unloadOnHide:true,center:true});var g="";if(jv.getType(b)=="string"){g=b}else{if(b instanceof jQuery){b.each(function(){g+=this.outerHTML})}else{g+=b.outerHTML}}var c="<div>"+g+"<div class='answers'>";if($.isArray(f)){var a={};$(f).each(function(m,n){a[n]=n});f=a}var h=[];for(var i in f){c+=" <input type='button' value='{0}' class='button' {1}/>".format(f[i],f[i]==i?"":"data='{0}'".format(i))}c+="</div></div>";var e=new Boxy(c,l);$("input[type=button]",e.boxy).each(function(m,n){$(n).bind("click",{bxy:e},function(r){var q=this;if(k){k(q.data||q.value,r.data.bxy,r)}r.data.bxy.hide()})});$("input[type=button]:first",e.boxy).focus();return e},isModalVisible:function(){return jQuery(".boxy-modal-blackout").length>0},_u:function(){for(var b=0,a=arguments.length;b<a;b++){if(typeof arguments[b]!="undefined"){return false}}return true},_handleDrag:function(a){var b;if(b=Boxy.dragging){b[0].boxy.css({left:a.pageX-b[1],top:a.pageY-b[2]})}},_nextZ:function(){if(!jv.zIndex){jv.zIndex=1337}return ++jv.zIndex},_viewport:function(b){var e=jv.getEyeSize();if(b){var a,c;e.width-=60;e.height-=80;if(b.width=="auto"||!b.width){a="auto"}else{if(b.width<0){a=Math.min(e.width+b.width*2,e.width)}else{a=Math.min(b.width,e.width)}}if(b.height=="auto"||!b.height){c="auto"}else{if(b.height<0){c=Math.min(e.height+b.height*2,e.height)}else{c=Math.min(b.height,e.height)}}e.suitWidth=a;e.suitHeight=c}return e}});Boxy.prototype={estimateSize:function(){this.boxy.css({visibility:"hidden",display:"block"});var a=this.getSize();this.boxy.css("display","none").css("visibility","visible");return a},getSize:function(){return[this.boxy.width(),this.boxy.height()]},getPosition:function(){var a=this.boxy[0];return[a.offsetLeft,a.offsetTop]},getCenter:function(){var b=this.getPosition(),a=this.getSize();return[Math.floor(b[0]+a[0]/2),Math.floor(b[1]+a[1]/2)]},getInner:function(){return jQuery(".boxy-inner",this.boxy)},getContent:function(){return jQuery(".boxy-content",this.boxy)},setContent:function(a){if(a.jquery&&a.html){a=a.html()}a=jQuery(a);if(this.options.clone){a=a.clone(true)}var b=this.getContent();if(b.length){b.empty().append(a)}else{this.getInner().append("<div class='boxy-content' style='display:block'></div>");this.getContent().append(a)}this._setupDefaultBehaviours(a);this.options.behaviours.call(this,a);return this},moveTo:function(a,b){this.moveToX(a).moveToY(b);return this},moveToX:function(a){if(typeof a=="number"){this.boxy.css({left:a})}else{this.centerX()}return this},moveToY:function(a){if(typeof a=="number"){this.boxy.css({top:a})}else{this.centerY()}return this},centerAt:function(a,c){var b=this[this.visible?"getSize":"estimateSize"]();if(typeof a=="number"){this.moveToX((a-b[0]/2-8<0)?0:(a-b[0]/2-8))}if(typeof c=="number"){this.moveToY((c-b[1]/2<0)?0:(c-b[1]/2))}return this},centerAtX:function(a){return this.centerAt(a,null)},centerAtY:function(a){return this.centerAt(null,a)},center:function(b){this.moveTo(0,0);if(this.options.center){var a=jv.getEyeSize();if(!b||b=="x"){this.centerAt(a.width/2,null)}if(!b||b=="y"){this.centerAt(null,a.height/2)}}else{this.moveTo(Boxy._u(this.options.x)?this.options.x:Boxy.DEFAULT_X,Boxy._u(this.options.y)?this.options.y:Boxy.DEFAULT_Y)}return this},centerX:function(){return this.center("x")},centerY:function(){return this.center("y")},resize:function(b,a,e){if(!this.visible){return}if(b>0){this.getContent().css("width",b)}var c=this._getBoundsForResize(b,a);this.boxy.css({left:c[0],top:c[1]||0});if(c[3]>0){this.getContent().css("height",c[3])}if(e){e(this)}return this},tween:function(c,a,f){if(!this.visible){return}var e=this._getBoundsForResize(c,a),b=this;this.boxy.stop().animate({left:e[0],top:e[1]});this.getContent().stop().animate({width:e[2],height:e[3]},function(){if(f){f(b)}});return this},isVisible:function(){return this.visible},show:function(){if(this.visible){return}if(this.options.modal){var a=this;this.modalBlackout=jQuery('<div class="boxy-modal-blackout"></div>').css({zIndex:Boxy._nextZ()}).appendTo(document.body);this.toTop();if(this.options.closeable){jQuery(document.body).bind("keypress.boxy",function(b){})}}this.boxy.stop().css({opacity:1}).css("filter","").show();this.visible=true;this._fire("afterShow");this.boxy.bind("resize",function(b){Boxy.get(this).center()});return this},hide:function(f){var b=$(document).data("oriPos");if(false&&top.document!=document&&b&&b.obj==this){$(window.frameElement).width(0).height(0).css("position",b.positon).offset({top:Math.ceil(b.offset.top),left:Math.ceil(b.offset.left)}).width(b.size.width).height(b.size.height);$(document).removeData("oriPos")}if(!this.visible){return}var a=this;if(a._fire("beforeHide")==false){return false}jv.UnloadRequest();var e={originalEvent:true,target:jv.boxdy().data("srcForBoxy")};var c=function(){a.boxy.css({display:"none"});a.visible=false;a._fire("afterHide");if(a.options.modal){jQuery(document.body).unbind("keypress.boxy");if(a.options.hideAnimateTime){a.modalBlackout.animate({opacity:0},a.options.hideAnimateTime,function(){jQuery(this).remove()})}else{jQuery(a.modalBlackout).remove()}}if(a.options&&a.options.unloadOnHide){a.unload()}if(a.options.ReturnCallback){var g=a.ReturnValue;if($.isFunction(g)){g=g()}a.options.ReturnCallback(g,e)}if(f){f(a,e)}};if(a.options.hideAnimateTime){this.boxy.stop().animate({opacity:0},a.options.hideAnimateTime,c)}else{c()}return this},toggle:function(){this[this.visible?"hide":"show"]();return this},hideAndUnload:function(a){this.options.unloadOnHide=true;this.hide(a);return this},unload:function(){this._fire("beforeUnload");var a=this.boxy.find(".boxy-inner .boxy-content");this.boxy.remove();if(this.options.actuator){jQuery.data(this.options.actuator,"active.boxy",false)}this._fire("afterUnload")},toTop:function(){this.boxy.css({zIndex:Boxy._nextZ()});return this},getTitle:function(){return jQuery("> .title-bar h2",this.getInner()).html()},setTitle:function(a){jQuery("> .title-bar h2",this.getInner()).html(a);return this},_getBoundsForResize:function(g,b){var a=b,c=this.getContent(),e=[c.width(),c.innerHeight()];if(!g){g=e[0]}if(!b){b=e[1]}var f=document.documentElement.clientHeight-80;if(b>f){a=b=f}var i=[g-e[0],b-e[1]],h=this.getPosition();return[Math.max(h[0]-i[0]/2,0),Math.max(h[1]-i[1]/2,0),g,a]},_setupTitleBar:function(){if(this.options.title!==false){var b=this,a=jQuery("<div class='title-bar'><span class='title'>"+this.options.title+"</span><span class='BoxyTool'></span></div>"),c=a.find(".BoxyTool");c.bind("mousedown",function(e){e.stopPropagation()});if(this.options.closeable){$('<div class="close button view"></div>').appendTo(a)}if(this.options.draggable){a[0].onselectstart=function(){return false};a[0].unselectable="on";a[0].style.MozUserSelect="none";if(!Boxy.dragConfigured){jQuery(document).mousemove(Boxy._handleDrag);Boxy.dragConfigured=true}a.mousedown(function(e){$(document).bind("selectstart.boxy",function(){return false});b.toTop();Boxy.dragging=[b,e.pageX-b.boxy[0].offsetLeft,e.pageY-b.boxy[0].offsetTop];jQuery(this).addClass("dragging")}).mouseup(function(){$(document).unbind("selectstart.boxy");jQuery(this).removeClass("dragging");Boxy.dragging=null;b._fire("afterDrop")})}this.getInner().prepend(a);this._setupDefaultBehaviours(a)}},_setupDefaultBehaviours:function(a){var b=this;if(this.options.clickToFront){a.click(function(){b.toTop()})}jQuery(".close",a).click(function(){if(b.options.closeButton){var c=b.options.closeButton;if($.isFunction(c)){var e=c(b.boxy);e.data("defBtned",true).trigger("click")}}b.hide();$(document.body).trigger("click");return}).mousedown(function(c){$(document).click();c.stopPropagation()})},_fire:function(a){return this.options[a].call(this)}};(function(a){jv.CssHasBorderRadius=(typeof(document.createElement("div").style.borderRadius)=="string");jv.CssHasBoxShadow=(typeof(document.createElement("div").style.boxShadow)=="string");a.fn.TextHelper=function(b){var f={beforeClickInput:false,callback:false,change:false,changeCallback:false,clear:"清除",checkByKey:true,checkByVal:false,click:false,clickCallback:false,confirm:"确定",data:{},display:false,hideCallback:false,loadData:true,post:"none",quote:"radio",postCallback:false,renderCallback:false,require:true,selectIndex:null,selectValue:null,triggerEvent:"mousedown",url:"",useSelect:(jv.csm?false:false),width:0},c=this;f=a.extend(f,b);if(f.callback&&!f.postCallback){f.postCallback=f.callback}if(f.change&&!f.changeCallback){f.changeCallback=f.change}if(f.click&&!f.clickCallback){f.clickCallback=f.click}if(!f.require){f.clear=false;f.confirm=false}f.post=f.post||"none";var g=function(t,s,k){if(!t){return t}if(t.tagName.toLowerCase()=="select"){return t}var v=a(t);var w=[];for(var u in v[0].attributes){var r=v[0].attributes[u];if(!r){continue}if(r.name=="type"){continue}else{if(r.name=="size"){continue}else{if(r.nodeValue===false){continue}else{if(r.nodeValue===null){continue}else{if(r.name=="readonly"){continue}else{if(a.isFunction(r.value)){continue}}}}}}if(r.name&&r.value){w.push(r.name+'="'+r.value+'"')}}var q=v.val();var l=v.hide().after("<select {0}></select>".format(w.join(" "))).next();v.remove();if(!k.require){l[0].options.add(new Option("",""))}if(k.changeCallback){l.bind("change",function(i){k.changeCallback(l.val(),l,i)})}if(k.clickCallback){l.bind("change",function(i){k.clickCallback(l.val(),l,i)})}if(k.data){for(var n=0;n<k.data.length;n++){var m=k.data[n];l[0].options.add(new Option(m.val,m.key));if(q&&(q==m.key||q==m.val)){l[0].selectedIndex=l[0].length-1}else{if(!q&&k.selectValue){if(m.key==k.selectValue){l[0].selectedIndex=l[0].length-1}}}}if(!q&&!jv.IsNull(k.selectIndex)){l[0].selectedIndex=k.selectIndex;l.trigger("change")}}if(k.url){var h=function(){a.ajax({url:a.isFunction(k.url)?k.url():k.url,data:{},type:"post",success:function(z){z=s.tidyData(z);k.data=z;if(k.postCallback){var x=k.postCallback(z);if(x===false){return false}else{if(jv.HasValue(x)){z=x}}}for(var y=0;y<k.data.length;y++){var A=k.data[y];l[0].options.add(new Option(A.val,A.key));if(q&&(q==A.key||q==A.val)){l[0].selectedIndex=l[0].length-1}else{if(!q&&k.selectValue){if(A.key==k.selectValue){l[0].selectedIndex=l[0].length-1}}}}if(!q&&!jv.IsNull(k.selectIndex)){l[0].selectedIndex=k.selectIndex;l.trigger("change")}if(k.renderCallback){k.renderCallback(l[0])}}})};if(k.loadData){h()}else{l.one("focus",h)}}return l};var e=a();this.UnTextHelper().addClass("TextHelperInput").each(function(r,h){var k=h.name||h.id,q={},i,n,s,m;if(!k){h.id=Math.random().toString(16).slice(2);k=h.id}var q={id:k,p:f,divId:k+"_Div_"+Math.random().toString(16).slice(2),init:function(){h.name="";i=a(h);n=i.next("input[type=hidden]");if(n.attr("name")!=k){n=a('<input type="hidden" name="{0}" />'.format(k))}if(f.selectValue&&!i.val()){i.val(f.selectValue)}n=n.val(i.val());i.after(n).attr("autocomplete","off");m=a("#"+q.divId,jv.boxdy());if(m.length){m.html("")}else{a('<div class="TextHelperWrap"><div id="'+q.divId+'"  class="TextHelper"></div></div>').appendTo(jv.boxdy(h,document.body))}if(!m.length){m=a("#"+q.divId,jv.boxdy())}s=m.parent().hide();s.add(i).click(function(u){u.stopPropagation()})},tidyData:function(w){var y=[];if(typeof(w)=="string"){var x=w.split(",");a(x).each(function(A,C){var B=C.split(":");y.push({key:B[0],val:B[1]||B[0]})});return y}if(a.isPlainObject(w)){for(var z in w){if(!z&&(z!=0)){continue}if(a.isFunction(w[z])){continue}y.push({key:z,val:w[z]})}}else{if(a.isArray(w)){for(var u=0,v=w.length;u<v;u++){if((w[u].key||(w[u].key==0))&&(w[u].val||(w[u].val==0))){y.push(w[u]);continue}y.push({key:w[u],val:w[u]})}}}return y},getSelectValues:function(){var u=[],v=[];m.find(">span.check").each(function(w,x){u.push(a(x).text());v.push(a(x).attr("val"))});return{txts:u,vals:v}},displayCheck:function(){var v=[],u=[];v=i.val().split(",");u=n.val().split(",");m.find(">span").each(function(z,A){var w=a(this).attr("val").trim(),y=a(this).text().trim();if(a(this).hasClass("check")){var x=true;if(f.checkByKey&&u.indexOf(w)<0){x=false}if(!x){if(f.checkByVal){if(v.indexOf(y)<0){x=false}else{x=true}}}if(!x){a(this).removeClass("check")}}else{if(a(this).html()){if(f.checkByKey&&u.indexOf(w)>=0){a(this).addClass("check");return}if(f.checkByVal&&v.indexOf(y)>=0){a(this).addClass("check");return}}}})},spanClick:function(w,x){var u=a(w);if(!u.html()){return false}if(f.beforeClickInput){if(f.beforeClickInput(i)==false){return false}}if(f.quote=="radio"){var v=u.attr("val");if(n.val()!=v){n.val(v);i.val(u.text());i.trigger("change");if(f.changeCallback){f.changeCallback(v,i,x)}n.trigger("change");q.displayCheck()}if(f.clickCallback&&f.clickCallback(v,i,x)){}else{if(f.hideCallback){f.hideCallback(i,x)}else{s.hide()}}}else{u.toggleClass("check");var y=q.getSelectValues();i.val(y.txts.join(","));n.val(y.vals.join(","));i.trigger("change");if(f.changeCallback){f.changeCallback(y.vals.join(","),i,x)}if(f.clickCallback){f.clickCallback(y.vals.join(","),i,x)}n.trigger("change")}},loadDataToDiv:function(){m.find("span").remove();m.find("button").remove();var x=[],u=n.val();for(var w=0;w<f.data.length;w++){var y=f.data[w];x.push(a('<span val="'+y.key+'">'+jv.encode(y.val)+"</span>")[0]);if(f.quote=="radio"&&(u==y.key||u==y.val)){n.val(y.key);i.val(y.val)}}i.data("data",f.data);if(!f.data.length){return}if(f.quote=="check"){var v=[];a(u.split(",")).each(function(z,A){if(!A){return true}a(f.data).filter(function(C,B){return A==B.key||A==B.val}).each(function(C,B){v.push(B.val)})});if(v.length){i.val(v.join(","))}}a(x).each(function(z,A){a(A).appendTo(m).click(function(B){q.spanClick(A,B)})});if(f.quote=="check"&&f.confirm){a("<button></button").html(f.confirm).appendTo(m).bind("click",function(z){var A=q.getSelectValues();i.val(A.txts.join(","));n.val(A.vals.join(","));if(f.hideCallback){f.hideCallback(i,z)}else{s.hide()}q.displayCheck()})}else{if(f.quote=="radio"&&f.clear){a("<button></button").html(f.clear).appendTo(m).bind("click",function(z){if(n.val()){i.val("");n.val("");i.trigger("change");n.trigger("change");q.displayCheck()}if(f.changeCallback){f.changeCallback("",i,z)}if(f.hideCallback){f.hideCallback(i,z)}else{s.hide()}q.displayCheck()})}}q.displayCheck()},getValueFromInput:function(){var u=[],v=i.val();if(f.quote=="radio"){if(f.checkByKey){u=a(f.data).filter(function(w,x){return x.key==v}).each(function(w,x){return x.val}).toArray()}if(u.length){return u}else{return[v]}if(f.checkByVal){u=a(f.data).filter(function(w,x){return x.val==v}).each(function(w,x){return x.val}).toArray()}if(u.length){return u}else{return[v]}}else{v=v.split(",");if(f.checkByKey){a.merge(u,a(f.data).filter(function(w,x){return v.indexOf(x.key)>=0}).each(function(w,x){return x.val}).toArray())}if(f.checkByVal){a.merge(u,a(f.data).filter(function(w,x){return v.indexOf(x.key)>=0}).each(function(w,x){return x.val}).toArray())}return u}},txtClick:function(u,v){if(s.length==0){return}i.addClass("TextHelper_Loading");if(f.hideCallback){f.hideCallback(i,v)}else{s.hide()}if((f.post=="change"||f.post=="click")&&(s.find("span").length==0)){q.post(u?null:q.showMe)}else{if(!u){q.showMe()}}},bindDivClick:function(){i.keyup(function(u){var v=u.witch||u.keyCode;if(v==27){a(document).trigger("click");return}i.addClass("TextHelper_Loading");if(f.hideCallback){f.hideCallback(i,u)}else{s.hide()}q.displayCheck();var w=q.getValueFromInput().join(",");n.val(w);if(f.changeCallback){f.changeCallback(w,i,u)}if(f.post=="change"||(f.post=="click")){jv.RestartTimer("TextHelper",function(){if(this.die){return false}q.post(function(){q.showMe()})})}else{q.showMe();return}});i.bind(f.triggerEvent,function(u){q.txtClick(false,u)})},post:function(u){var v=jv.JsonValuer(f.paras||{});v.query=i.val();a.ajax({url:a.isFunction(f.url)?f.url():f.url,data:v,type:"post",success:function(x){i.removeClass("Error").removeClass("TextHelper_Loading");x=q.tidyData(x);f.data=x;if(f.postCallback){var w=f.postCallback(x);if(w===false){return false}else{if(jv.HasValue(w)){x=w}}}if(x){f.data=x;q.loadDataToDiv();if(u){u()}}if(!jv.IsNull(f.selectIndex)&&!i.val()){m.find(">span:eq("+f.selectIndex+")").trigger("click");f.selectIndex=null}if(f.renderCallback){f.renderCallback(h,m[0],f)}},error:function(w){i.removeClass("TextHelper_Loading");i.addClass("Error")}})},showMe:function(){if(i.attr("disabled")){return}if(f.hideCallback){f.hideCallback(i)}else{a(document).trigger("click")}q.displayCheck();i.smartPosition(s,f.width);i.removeClass("TextHelper_Loading");a(document).one("click",function(){s.hide()});return}};if(f.data){f.data=q.tidyData(f.data)}if(f.useSelect){e=e.add(g(h,q,f));return true}else{e=e.add(h)}q.init();q.loadDataToDiv();q.bindDivClick();f.display=f.display||a("#"+k,jv.boxdy()).attr("display");if(f.display){a("#"+k,jv.boxdy()).val(f.display)}if(!jv.IsNull(f.selectIndex)&&!i.val()){m.find(">span:eq("+f.selectIndex+")").trigger("click")}else{var t=m.find("span.check");var l=t.attr("val");if(l){if(f.changeCallback){f.changeCallback(l,i,{originalEvent:true,eventTarget:t[0]})}}}jv.RegisteUnload("TextHelper",function(){s.hide()});a("#"+k,jv.boxdy()).data("TextHelper",q);if(f.url&&f.loadData){q.txtClick(true,null)}});return e};a.fn.UnTextHelper=function(){var b=a();this.each(function(h,c){if(c.tagName.toLowerCase()=="select"){var q=a(c);var r=[];for(var n in q[0].attributes){var k=q[0].attributes[n];if(!k){continue}if(k.name=="type"){continue}else{if(k.nodeValue===false){continue}else{if(k.nodeValue===null){continue}else{if(k.name=="readonly"){continue}}}}if(k.name&&k.value){r.push(k.name+'="'+k.value+'"')}}var g=q.val();var m=q.after("<input {0} />".format(r.join(" "))).next();m.val(g);q.remove();b=b.add(m);return true}b=b.add(c);var f=a(c).data("TextHelper");if(!f){return true}var l=a("input[name="+f.id+"]",jv.boxdy());var g=l.val();l.remove();a("#"+f.divId,jv.boxdy()).remove();c.name=f.id;var e=a(c);e.val(g);e.unbind().data("TextHelper",false).removeAttr("display")});return b};a.fn.ClearTextHelperData=function(){this.each(function(e,b){var c=a(b).data("TextHelper");if(!c||!c.divId){return true}a("#"+c.divId).find("span").remove()});return this}})(jQuery);(function(f){var a=[],e=/^url\(["']?([^"'\)]*)["']?\);?$/i,c=/\.png$/i,b=f.browser.msie&&f.browser.version==6;function g(){f.each(a,function(){this.refresh(true)})}f(window).resize(g);f.Poshytip=function(i,h){this.$elm=f(i);this.opts=f.extend({},f.fn.poshytip.defaults,h);this.$tip=f(['<div class="',this.opts.className,'">','<div class="tip-inner tip-bg-image"></div>','<div class="tip-arrow tip-arrow-top tip-arrow-right tip-arrow-bottom tip-arrow-left"></div>',"</div>"].join(""));this.$arrow=this.$tip.find("div.tip-arrow");this.$inner=this.$tip.find("div.tip-inner");this.disabled=false;this.init()};f.Poshytip.prototype={init:function(){a.push(this);this.$elm.data("title.poshytip",this.$elm.attr("title")||"").data("poshytip",this);switch(this.opts.showOn){case"hover":this.$elm.bind({"mouseenter.poshytip":f.proxy(this.mouseenter,this),"mouseleave.poshytip":f.proxy(this.mouseleave,this)});if(this.opts.alignTo=="cursor"){this.$elm.bind("mousemove.poshytip",f.proxy(this.mousemove,this))}if(this.opts.allowTipHover){this.$tip.hover(f.proxy(this.clearTimeouts,this),f.proxy(this.hide,this))}break;case"focus":this.$elm.bind({"focus.poshytip":f.proxy(this.show,this),"blur.poshytip":f.proxy(this.hide,this)});break}},mouseenter:function(h){if(this.disabled){return true}this.clearTimeouts();this.$elm.attr("title","");this.showTimeout=setTimeout(f.proxy(this.show,this),this.opts.showTimeout)},mouseleave:function(){if(this.disabled){return true}this.clearTimeouts();this.$elm.attr("title",this.$elm.data("title.poshytip"));this.hideTimeout=setTimeout(f.proxy(this.hide,this),this.opts.hideTimeout)},mousemove:function(h){if(this.disabled){return true}this.eventX=h.pageX;this.eventY=h.pageY;if(this.opts.followCursor&&this.$tip.data("active")){this.calcPos();this.$tip.css({left:this.pos.l,top:this.pos.t});if(this.pos.arrow){this.$arrow[0].className="tip-arrow tip-arrow-"+this.pos.arrow}}},show:function(){if(this.disabled||this.$tip.data("active")){return}this.reset();this.update();this.display()},hide:function(){if(this.disabled||!this.$tip.data("active")){return}this.display(true)},reset:function(){this.$tip.queue([]).detach().css("visibility","hidden").data("active",false);this.$inner.find("*").poshytip("hide");if(this.opts.fade){this.$tip.css("opacity",this.opacity)}this.$arrow[0].className="tip-arrow tip-arrow-top tip-arrow-right tip-arrow-bottom tip-arrow-left"},update:function(k){if(this.disabled){return}var i=k!==undefined;if(i){if(!this.$tip.data("active")){return}}else{k=this.opts.content}this.$inner.contents().detach();var h=this;this.$inner.append(typeof k=="function"?k.call(this.$elm[0],function(l){h.update(l)}):k=="[title]"?this.$elm.data("title.poshytip"):k);this.refresh(i)},refresh:function(i){if(this.disabled){return}if(i){if(!this.$tip.data("active")){return}var m={left:this.$tip.css("left"),top:this.$tip.css("top")}}this.$tip.css({left:0,top:0}).appendTo(document.body);if(this.opacity===undefined){this.opacity=this.$tip.css("opacity")}var n=this.$tip.css("background-image").match(e),q=this.$arrow.css("background-image").match(e);if(n){var k=c.test(n[1]);if(b&&k){this.$tip.css("background-image","none");this.$inner.css({margin:0,border:0,padding:0});n=k=false}else{this.$tip.prepend('<table border="0" cellpadding="0" cellspacing="0"><tr><td class="tip-top tip-bg-image" colspan="2"><span></span></td><td class="tip-right tip-bg-image" rowspan="2"><span></span></td></tr><tr><td class="tip-left tip-bg-image" rowspan="2"><span></span></td><td></td></tr><tr><td class="tip-bottom tip-bg-image" colspan="2"><span></span></td></tr></table>').css({border:0,padding:0,"background-image":"none","background-color":"transparent"}).find(".tip-bg-image").css("background-image",'url("'+n[1]+'")').end().find("td").eq(3).append(this.$inner)}if(k&&!f.support.opacity){this.opts.fade=false}}if(q&&!f.support.opacity){if(b&&c.test(q[1])){q=false;this.$arrow.css("background-image","none")}this.opts.fade=false}var s=this.$tip.find("table");if(b){this.$tip[0].style.width="";s.width("auto").find("td").eq(3).width("auto");var r=this.$tip.width(),l=parseInt(this.$tip.css("min-width")),h=parseInt(this.$tip.css("max-width"));if(!isNaN(l)&&r<l){r=l}else{if(!isNaN(h)&&r>h){r=h}}this.$tip.add(s).width(r).eq(0).find("td").eq(3).width("100%")}else{if(s[0]){s.width("auto").find("td").eq(3).width("auto").end().end().width(this.$tip.width()).find("td").eq(3).width("100%")}}this.tipOuterW=this.$tip.outerWidth();this.tipOuterH=this.$tip.outerHeight();this.calcPos();if(q&&this.pos.arrow){this.$arrow[0].className="tip-arrow tip-arrow-"+this.pos.arrow;this.$arrow.css("visibility","inherit");if(this.opts.arrow=="-right"){this.$arrow.css("left","auto").css("right",this.$arrow.css("marginLeft"))}}if(i){this.$tip.css(m).animate({left:this.pos.l,top:this.pos.t},200)}else{this.$tip.css({left:this.pos.l,top:this.pos.t})}},display:function(i){var k=this.$tip.data("active");if(k&&!i||!k&&i){return}this.$tip.stop();if((this.opts.slide&&this.pos.arrow||this.opts.fade)&&(i&&this.opts.hideAniDuration||!i&&this.opts.showAniDuration)){var q={},n={};if(this.opts.slide&&this.pos.arrow){var m,h;if(this.pos.arrow=="bottom"||this.pos.arrow=="top"){m="top";h="bottom"}else{m="left";h="right"}var l=parseInt(this.$tip.css(m));q[m]=l+(i?0:this.opts.slideOffset*(this.pos.arrow==h?-1:1));n[m]=l+(i?this.opts.slideOffset*(this.pos.arrow==h?1:-1):0)}if(this.opts.fade){q.opacity=i?this.$tip.css("opacity"):0;n.opacity=i?0:this.opacity}this.$tip.css(q).animate(n,this.opts[i?"hideAniDuration":"showAniDuration"])}i?this.$tip.queue(f.proxy(this.reset,this)):this.$tip.css("visibility","inherit");this.$tip.data("active",!k)},disable:function(){this.reset();this.disabled=true},enable:function(){this.disabled=false},destroy:function(){this.reset();this.$tip=f();this.$elm.unbind("poshytip").removeData("title.poshytip").removeData("poshytip");a.splice(f.inArray(this,a),1);this.$elm=f();this.disabled=true},clearTimeouts:function(){if(this.showTimeout){clearTimeout(this.showTimeout);this.showTimeout=0}if(this.hideTimeout){clearTimeout(this.hideTimeout);this.hideTimeout=0}},calcPos:function(){var r={l:0,t:0,arrow:""},i=f(window),m={l:i.scrollLeft(),t:i.scrollTop(),w:i.width(),h:i.height()},t,l,q,k,u,h;if(this.opts.alignTo=="cursor"){t=l=q=this.eventX;k=u=h=this.eventY}else{var s=this.$elm.offset(),n={l:s.left,t:s.top,w:this.$elm.outerWidth(),h:this.$elm.outerHeight()};t=n.l+(this.opts.alignX!="inner-right"?0:n.w);l=t+Math.floor(n.w/2);q=t+(this.opts.alignX!="inner-left"?n.w:0);k=n.t+(this.opts.alignY!="inner-bottom"?0:n.h);u=k+Math.floor(n.h/2);h=k+(this.opts.alignY!="inner-top"?n.h:0)}switch(this.opts.alignX){case"right":case"inner-left":r.l=q+this.opts.offsetX;if(r.l+this.tipOuterW>m.l+m.w){r.l=m.l+m.w-this.tipOuterW}if(this.opts.alignX=="right"||this.opts.alignY=="center"){r.arrow="left"}break;case"center":r.l=l-Math.floor(this.tipOuterW/2);if(r.l+this.tipOuterW>m.l+m.w){r.l=m.l+m.w-this.tipOuterW}else{if(r.l<m.l){r.l=m.l}}break;default:r.l=t-this.tipOuterW-this.opts.offsetX;if(r.l<m.l){r.l=m.l}if(this.opts.alignX=="left"||this.opts.alignY=="center"){r.arrow="right"}}switch(this.opts.alignY){case"bottom":case"inner-top":r.t=h+this.opts.offsetY;if(!r.arrow||this.opts.alignTo=="cursor"){r.arrow="top"}if(r.t+this.tipOuterH>m.t+m.h){r.t=k-this.tipOuterH-this.opts.offsetY;if(r.arrow=="top"){r.arrow="bottom"}}break;case"center":r.t=u-Math.floor(this.tipOuterH/2);if(r.t+this.tipOuterH>m.t+m.h){r.t=m.t+m.h-this.tipOuterH}else{if(r.t<m.t){r.t=m.t}}break;default:r.t=k-this.tipOuterH-this.opts.offsetY;if(!r.arrow||this.opts.alignTo=="cursor"){r.arrow="bottom"}if(r.t<m.t){r.t=h+this.opts.offsetY;if(r.arrow=="bottom"){r.arrow="top"}}}this.pos=r}};f.fn.poshytip=function(h){if(typeof h=="string"){return this.each(function(){var k=f(this).data("poshytip");if(k&&k[h]){k[h]()}})}var i=f.extend({},f.fn.poshytip.defaults,h);if(!f("#poshytip-css-"+i.className)[0]){f(['<style id="poshytip-css-',i.className,'" type="text/css">',"div.",i.className,"{visibility:hidden;position:absolute;top:0;left:0;}","div.",i.className," table, div.",i.className," td{margin:0;font-family:inherit;font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;}","div.",i.className," td.tip-bg-image span{display:block;font:1px/1px sans-serif;height:",i.bgImageFrameSize,"px;width:",i.bgImageFrameSize,"px;overflow:hidden;}","div.",i.className," td.tip-right{background-position:100% 0;}","div.",i.className," td.tip-bottom{background-position:100% 100%;}","div.",i.className," td.tip-left{background-position:0 100%;}","div.",i.className," div.tip-inner{background-position:-",i.bgImageFrameSize,"px -",i.bgImageFrameSize,"px;}","div.",i.className," div.tip-arrow{visibility:hidden;position:absolute;overflow:hidden;font:1px/1px sans-serif;}","</style>"].join("")).appendTo("head")}return this.each(function(){new f.Poshytip(this,i)})};f.fn.poshytip.defaults={content:"[title]",className:"tipWrap",bgImageFrameSize:10,showTimeout:100,hideTimeout:500,showOn:"hover",alignTo:"cursor",alignX:"right",alignY:"top",offsetX:-22,offsetY:18,allowTipHover:true,followCursor:false,fade:true,slide:true,slideOffset:8,showAniDuration:300,hideAniDuration:300}})(jQuery);jv.chk_one=function(setting){var Alert=function(alertOption){var p={con:false,msg:false};p=$.extend(p,alertOption);if($.fn.mytip){var con=$(p.con);if(con.css("textAlign")=="right"){con.mytip(p.msg,{alignX:"inner-right",arrow:"-right"})}else{con.mytip(p.msg)}}else{alert(p.msg)}};var UnAlert=function(obj){$(obj).poshytip("destroy")};if(!setting){setting={}}var chkCon=setting.con||jv.GetDoer(),jchkCon=$(chkCon);if(chkCon.disabled||(chkCon.type=="hidden")||!jchkCon.is(":visible")){return true}var option={con:chkCon,callback:false,chk:(jchkCon.attr("chk")||"").trim(),chkval:(jchkCon.attr("chkval")||"").trim(),chkmsg:(jchkCon.attr("chkmsg")||"").trim(),boxdy:false};option=$.extend(option,setting);var regFunc=function(regOptions){var p={expchk:false,val:false,msg:false,con:false};p=$.extend(p,regOptions);var regLastTemp=p.expchk.slice(3).trim();var expSignEqual=regLastTemp.slice(0,2)=="==";var expval=regLastTemp.slice(2).trim();var reg=new RegExp(expval);if(reg.test(p.val)==expSignEqual){Alert(p);return false}else{UnAlert(p.con)}return true};var funcFunc=function(funcOptions){var p={expchk:false,val:false,msg:false,con:false};p=$.extend(p,funcOptions);var expval=p.expchk;var res=eval("eval ("+expval+")")(p.val,p.msg,{originalEvent:true,target:p.con});if(res===true||jv.IsNull(res)){UnAlert(p.con)}else{if(res===false){return false}else{if(res.length>0){Alert({con:p.con,msg:res});return false}}}return true};var expLimit=function(expOptions){var p={dataType:false,expchk:false,val:false,msg:false,con:false};p=$.extend(p,expOptions);if(!p.expchk){return true}var getBetween=function(partStr,valProc){var ranges=partStr.split(",");var from=valProc?valProc(ranges[0]):(ranges[0]||"");var to=valProc?valProc(ranges[1]):(ranges[1]||"");if(from.length&&to.length){if(from>to){var temp=from;from=to;to=temp}}return{from:from,to:to}};var procLength=function(chkExp){if(/\{.+\}/g.test(chkExp)){var part=chkExp.match(/[^\{^\}]+/g)[0];var between=getBetween(part,parseInt),from=between.from,to=between.to,fromValue=parseInt(from),toValue=parseInt(to);var valLen=p.val.length;if(valLen<fromValue||(valLen>toValue)){Alert({con:p.con,msg:p.msg||"长度限定在: "+chkExp+" 之间!"});return false}else{if(valLen<fromValue){Alert({con:p.con,msg:p.msg||"长度限定必须 ≥ "+from+"!"});return false}else{if(valLen>toValue){Alert({con:p.con,msg:p.msg||"长度限定必须 ≤ "+to+"!"});return false}}}}return true};var procRange=function(chkExp){if(/\(.+\)/g.test(chkExp)){var part=chkExp.match(/[^\(^\)]+/g)[0];var between=getBetween(part,jv.typeIsNumberType(p.dataType)?parseFloat:null),from=between.from,to=between.to;if(p.dataType=="datetime"||p.dataType=="date"){from=from.getDate();to=to.getDate();p.val=p.val.getDate()}else{if(p.dataType=="time"){from=("2000-1-1 "+from).getDate();to=("2000-1-1 "+to).getDate();p.val=("2000-1-1 "+p.val).val.getDate()}else{if(p.dataType=="int"||p.dataType=="Int32"||p.dataType=="UInt32"){if(p.val.toString().length>12){Alert({con:p.con,msg:p.msg||"超出数字类型("+p.dataType+")的范围!"});return false}from=parseInt(from);to=parseInt(to);p.val=parseInt(p.val)}else{if(p.dataType=="Int16"||p.dataType=="UInt16"){if(p.val.toString().length>6){Alert({con:p.con,msg:p.msg||"超出数字类型("+p.dataType+")的范围!"});return false}from=parseInt(from);to=parseInt(to);p.val=parseInt(p.val)}else{if(p.dataType=="number"||p.dataType=="Single"){proc=function(v){return parseFloat(v)}}else{if(p.dataType=="Byte"||p.dataType=="SByte"){if(p.val.toString().length>3){Alert({con:p.con,msg:p.msg||"超出数字类型("+p.dataType+")的范围!"});return false}proc=function(v){return parseInt(v)}}else{if(p.dataType=="Int64"||p.dataType=="Decimal"||p.dataType=="Double"||p.dataType=="UInt64"||p.dataType=="VarNumeric"||p.dataType=="Currency"||p.dataType=="Binary"||p.dataType=="Decimal"||p.dataType=="Guid"||p.dataType=="Object"||p.dataType=="Xml"||p.dataType=="Boolean"){return true}}}}}}}if(p.val<from||p.val>to){Alert({con:p.con,msg:p.msg||"范围限定在: "+chkExp+" 之间!"});return false}}return true};var sects=p.expchk.match(/\(|\)|\{|\}/g),retVal=true;$.each(sects,function(i,d){if(i%2==0){return}if(d=="}"){retVal&=procLength(p.expchk.match(/\{.+\}/g)[0])}else{if(d==")"){retVal&=procRange(p.expchk.match(/\(.+\)/g)[0])}}if(!retVal){return retVal}});return retVal};var expFunc=function(expOptions){var p={expchk:false,val:false,msg:false,con:false};p=$.extend(p,expOptions);var expDateTimeType=p.expchk.slice(0,8).trim().toLowerCase();var exp6Type=expDateTimeType.slice(0,6);var exp4Type=exp6Type.slice(0,4);var exp3Type=exp4Type.slice(0,3);var expval4=p.expchk.slice(4).trim();if(expDateTimeType=="datetime"){var res=regFunc({expchk:"reg!=^\\d{1,4}(\\-|\\/|\\.|年)\\d{1,2}(\\-|\\/|\\.|月)\\d{1,2}日? \\d{1,2}:\\d{1,2}:\\d{1,2}$",val:p.val,msg:p.msg||"不正确的日期时间格式!",con:p.con});if(res==false){return false}return expLimit({dataType:expDateTimeType,expchk:p.expchk.slice(8).trim(),val:p.val,con:p.con,msg:p.msg})}else{if(exp6Type=="number"){var res=regFunc({expchk:"reg!=^[+-]?\\d*(\\.$|\\d*$|(\\.?\\d*$))",val:p.val,msg:p.msg||"不正确的数字格式!",con:p.con});if(res==false){return false}return expLimit({dataType:exp6Type,expchk:p.expchk.slice(6).trim(),val:p.val,con:p.con,msg:p.msg})}else{if(exp4Type=="email"){var res=regFunc({expchk:"reg!=^\\w+((-\\w+)|(\\.\\w+))*\\@[A-Za-z0-9]+((\\.|-)[A-Za-z0-9]+)*\\.[A-Za-z0-9]+$",val:p.val,msg:p.msg||"不正确的电子邮件格式!",con:p.con});if(res==false){return false}return expLimit({dataType:exp4Type,expchk:expval4,val:val,con:con,msg:p.msg})}else{if(exp4Type=="date"){var res=regFunc({expchk:"reg!=^\\d{1,4}(\\-|\\/|\\.|年)\\d{1,2}(\\-|\\/|\\.|月)\\d{1,2}日?$",val:p.val,msg:p.msg||"不正确的日期格式!",con:p.con});if(res==false){return false}return expLimit({dataType:exp4Type,expchk:expval4,val:p.val,con:p.con,msg:p.msg})}else{if(exp4Type=="time"){var res=regFunc({expchk:"reg!=\\d{1,2}:\\d{1,2}:\\d{1,2}$",val:p.val,msg:p.msg||"不正确的时间格式!",con:p.con});if(res==false){return false}return expLimit({dataType:exp4Type,expchk:expval4,val:p.val,con:p.con,msg:p.msg})}else{if(exp4Type=="enum"){var expContent=p.expchk.split(new RegExp("[()]"))[1].split(",");if(expContent.indexOf(p.val)<0){Alert({con:p.con,msg:p.msg||"不在枚举范围内: "+p.expchk+" 之间!"});return false}}else{if(exp3Type=="int"){var res=regFunc({expchk:"reg!=^[+-]?\\d+$",val:p.val,msg:p.msg||"需要整数!",con:p.con});if(res==false){return false}return expLimit({dataType:exp3Type,expchk:p.expchk.slice(3).trim(),val:p.val,con:p.con,msg:p.msg})}else{return expLimit({expchk:p.expchk,val:p.val,con:p.con,msg:p.msg})}}}}}}}};var dbChk=function(expOptions){var p={expchk:false,val:false,msg:false,con:false};p=$.extend(p,expOptions);var dbType=p.con.getAttribute("dbtype");var maxLen=parseInt(p.con.getAttribute("dblen"));if(dbType=="Int32"){var res=regFunc({expchk:"reg!=^[+-]?\\d+$",val:p.val,msg:p.msg||"需要32位整数!",con:p.con});if(res==false){return false}if(expLimit({dataType:"int",expchk:"(-2147483648,2147483647)",val:p.val,con:p.con,msg:p.msg})==false){return false}}else{if(dbType=="Int16"){var res=regFunc({expchk:"reg!=^[+-]?\\d+$",val:p.val,msg:p.msg||"需要16位整数!",con:p.con});if(res==false){return false}if(expLimit({dataType:"int",expchk:"(-32768,32767)",val:p.val,con:p.con,msg:p.msg})==false){return false}}else{if(dbType=="Byte"){var res=regFunc({expchk:"reg!=^[+]?\\d+$",val:p.val,msg:p.msg||"需要8位整数!",con:p.con});if(res==false){return false}if(expLimit({dataType:"int",expchk:"(0,255)",val:p.val,con:p.con,msg:p.msg})==false){return false}}else{if(dbType=="SByte"){var res=regFunc({expchk:"reg!=^[+-]?\\d+$",val:p.val,msg:p.msg||"需要8位整数!",con:p.con});if(res==false){return false}if(expLimit({dataType:"int",expchk:"(-128,127)",val:p.val,con:p.con,msg:p.msg})==false){return false}}else{if(dbType=="UInt16"){var res=regFunc({expchk:"reg!=^[+]?\\d+$",val:p.val,msg:p.msg||"需要16位整数!",con:p.con});if(res==false){return false}if(expLimit({dataType:"int",expchk:"(-32768,32767)",val:p.val,con:p.con,msg:p.msg})==false){return false}}else{if(dbType=="UInt32"){var res=regFunc({expchk:"reg!=^[+]?\\d+$",val:p.val,msg:p.msg||"需要32位整数!",con:p.con});if(res==false){return false}if(expLimit({dataType:"int",expchk:"(0,4294967295)",val:p.val,con:p.con,msg:p.msg})==false){return false}}else{if(dbType=="Date"){var res=regFunc({expchk:"reg!=^\\d{1,4}(\\-|\\/|\\.|年)\\d{1,2}(\\-|\\/|\\.|月)\\d{1,2}日?$",val:p.val,msg:p.msg||"不正确的日期格式!",con:p.con});if(res==false){return false}}else{if(dbType=="DateTime"||dbType=="DateTime2"||dbType=="DateTimeOffset"){var res=regFunc({expchk:"reg!=^\\d{1,4}(\\-|\\/|\\.|年)\\d{1,2}(\\-|\\/|\\.|月)\\d{1,2}日? \\d{1,2}:\\d{1,2}:\\d{1,2}$",val:p.val,msg:p.msg||"不正确的日期时间格式!",con:p.con});if(res==false){return false}}else{if(dbType=="Time"){var res=regFunc({expchk:"reg!=\\d{1,2}:\\d{1,2}:\\d{1,2}$",val:p.val,msg:p.msg||"不正确的时间格式!",con:p.con});if(res==false){return false}}else{if(dbType=="AnsiString"||dbType=="AnsiStringFixedLength"){if(p.val.byteLen()>maxLen){p.msg=p.msg||"超出了最大数据长度.";Alert(p);return false}}else{if(dbType=="String"||dbType=="StringFixedLength"){if(p.val.length>maxLen){p.msg=p.msg||"超出了最大数据长度.";Alert(p);return false}}}}}}}}}}}}p.expchk=p.expchk.slice(1);if(p.expchk&&jv.chk_one(p)==false){return false}UnAlert(p.con);return true};var functionType=option.chk.slice(0,8).toLowerCase();var regType=functionType.slice(0,3).toLowerCase();var shortFunctionType=regType.slice(0,1);var chkval;if(option.chkval){if(option.chkval.slice(0,8)=="function"){chkval=eval("eval ("+option.chkval+")")()}else{if(option.chkval.slice(0,1)==":"){chkval=eval("eval (function(){"+option.chkval.slice(1)+"})")()}else{var chk_val_con=$(option.chkval,jv.boxdy());if(!chk_val_con.length){chk_val_con=$(option.chkval,jv.boxdy())}chkval=chk_val_con.val()}}}else{chkval=$(chkCon,jv.boxdy()).val()}chkval=chkval.trim();if(shortFunctionType==":"){option.chk="function(val,msg){"+option.chk.slice(1)+"}"}if((functionType=="function")||(shortFunctionType==":")){if(funcFunc({expchk:option.chk,val:chkval,msg:option.chkmsg,con:chkCon})==false){return false}}else{if(regType=="reg"){if(regFunc({expchk:option.chk,val:chkval,msg:option.chkmsg,con:chkCon})==false){return false}}else{if(shortFunctionType=="$"){if(dbChk({expchk:option.chk,val:chkval,msg:option.chkmsg,con:chkCon})==false){return false}}else{if(expFunc({expchk:option.chk,val:chkval,msg:option.chkmsg,con:chkCon})==false){return false}}}}if(option.callback){var ret=option.callback(option);if(ret){Alert({con:option.con,msg:ret});return false}}return true};jv.chk=function(c){if(!c){c={}}var a=c.boxdy||jv.boxdy();var i=true;var b=function(l){var m=$.extend({con:false,chkval:false},l);if(!jv.SenseWord){return false}var e="";$(jv.SenseWord).each(function(n,q){if(m.chkval.indexOf(q)>=0){e=q;return false}});if(e){return"包含关键词:"+e}else{return false}};var h=function(e){var l=jv.chk_one({con:e,callback:b});if(l){$(e).poshytip("destroy")}return l};var g;var k=$(a);k.filter("[chk]").add(k.find("[chk]")).each(function(l,m){i&=h(m);if(!g&&!i){var e=$(m);if(e.attr("disabled")||(e.attr("type")=="hidden")||!e.is(":visible")){return}g=m}}).each(function(e,l){$($(l).attr("chkval")||l).unbind("change.jvchk").bind("change.jvchk",function(m){h(l)})});if(g){try{g.focus()}catch(f){}}if(!i){jv.UnOneClick()}jv.RegisteUnload("chk",function(){jv.boxdy().find("[chk]").each(function(e,l){$(l).poshytip("destroy")})});return i};jQuery.ui||(function(c){var k=c.fn.remove,e=c.browser.mozilla&&(parseFloat(c.browser.version)<1.9);c.ui={version:"1.7.3",plugin:{add:function(m,n,r){var q=c.ui[m].prototype;for(var l in r){q.plugins[l]=q.plugins[l]||[];q.plugins[l].push([n,r[l]])}},call:function(l,n,m){var r=l.plugins[n];if(!r||!l.element[0].parentNode){return}for(var q=0;q<r.length;q++){if(l.options[r[q][0]]){r[q][1].apply(l.element,m)}}}},contains:function(m,l){return document.compareDocumentPosition?m.compareDocumentPosition(l)&16:m!==l&&m.contains(l)},hasScroll:function(q,m){if(c(q).css("overflow")=="hidden"){return false}var l=(m&&m=="left")?"scrollLeft":"scrollTop",n=false;if(q[l]>0){return true}q[l]=1;n=(q[l]>0);q[l]=0;return n},isOverAxis:function(m,l,n){return(m>l)&&(m<(l+n))},isOver:function(s,m,r,q,l,n){return c.ui.isOverAxis(s,r,l)&&c.ui.isOverAxis(m,q,n)},keyCode:{BACKSPACE:8,CAPS_LOCK:20,COMMA:188,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38}};if(e){var g=c.attr,f=c.fn.removeAttr,i="http://www.w3.org/2005/07/aaa",a=/^aria-/,b=/^wairole:/;c.attr=function(m,l,n){var q=n!==undefined;return(l=="role"?(q?g.call(this,m,l,"wairole:"+n):(g.apply(this,arguments)||"").replace(b,"")):(a.test(l)?(q?m.setAttributeNS(i,l.replace(a,"aaa:"),n):g.call(this,m,l.replace(a,"aaa:"))):g.apply(this,arguments)))};c.fn.removeAttr=function(l){return(a.test(l)?this.each(function(){this.removeAttributeNS(i,l.replace(a,""))}):f.call(this,l))}}c.extend(c.expr[":"],{data:function(n,m,l){return !!c.data(n,l[3])},focusable:function(m){var n=m.nodeName.toLowerCase(),l=c.attr(m,"tabindex");return(/input|select|textarea|button|object/.test(n)?!m.disabled:"a"==n||"area"==n?m.href||!isNaN(l):!isNaN(l))&&!c(m)["area"==n?"parents":"closest"](":hidden").length},tabbable:function(m){var l=c.attr(m,"tabindex");return(isNaN(l)||l>=0)&&c(m).is(":focusable")}});function h(q,r,s,n){function m(u){var t=c[q][r][u]||[];return(typeof t=="string"?t.split(/,?\s+/):t)}var l=m("getter");if(n.length==1&&typeof n[0]=="string"){l=l.concat(m("getterSetter"))}return(c.inArray(s,l)!=-1)}c.widget=function(m,l){var n=m.split(".")[0];m=m.split(".")[1];c.fn[m]=function(t){var r=(typeof t=="string"),s=Array.prototype.slice.call(arguments,1);if(r&&t.substring(0,1)=="_"){return this}if(r&&h(n,m,t,s)){var q=c.data(this[0],m);return(q?q[t].apply(q,s):undefined)}return this.each(function(){var u=c.data(this,m);(!u&&!r&&c.data(this,m,new c[n][m](this,t))._init());(u&&r&&c.isFunction(u[t])&&u[t].apply(u,s))})};c[n]=c[n]||{};c[n][m]=function(s,r){var q=this;this.namespace=n;this.widgetName=m;this.widgetEventPrefix=c[n][m].eventPrefix||m;this.widgetBaseClass=n+"-"+m;this.options=c.extend({},c.widget.defaults,c[n][m].defaults,c.metadata&&c.metadata.get(s)[m],r);this.element=c(s).bind("setData."+m,function(u,t,v){if(u.target==s){return q._setData(t,v)}}).bind("getData."+m,function(u,t){if(u.target==s){return q._getData(t)}}).bind("remove",function(){return q.destroy()})};c[n][m].prototype=c.extend({},c.widget.prototype,l);c[n][m].getterSetter="option"};c.widget.prototype={_init:function(){},destroy:function(){this.element.removeData(this.widgetName).removeClass(this.widgetBaseClass+"-disabled "+this.namespace+"-state-disabled").removeAttr("aria-disabled")},option:function(n,q){var m=n,l=this;if(typeof n=="string"){if(q===undefined){return this._getData(n)}m={};m[n]=q}c.each(m,function(r,s){l._setData(r,s)})},_getData:function(l){return this.options[l]},_setData:function(l,m){this.options[l]=m;if(l=="disabled"){this.element[m?"addClass":"removeClass"](this.widgetBaseClass+"-disabled "+this.namespace+"-state-disabled").attr("aria-disabled",m)}},enable:function(){this._setData("disabled",false)},disable:function(){this._setData("disabled",true)},_trigger:function(n,q,r){var t=this.options[n],l=(n==this.widgetEventPrefix?n:this.widgetEventPrefix+n);q=c.Event(q);q.type=l;if(q.originalEvent){for(var m=c.event.props.length,s;m;){s=c.event.props[--m];q[s]=q.originalEvent[s]}}this.element.trigger(q,r);return !(c.isFunction(t)&&t.call(this.element[0],q,r)===false||q.isDefaultPrevented())}};c.widget.defaults={disabled:false};c.ui.mouse={_mouseInit:function(){var l=this;this.element.bind("mousedown."+this.widgetName,function(m){return l._mouseDown(m)}).bind("click."+this.widgetName,function(m){if(l._preventClickEvent){l._preventClickEvent=false;m.stopImmediatePropagation();return false}});if(c.browser.msie){this._mouseUnselectable=this.element.attr("unselectable");this.element.attr("unselectable","on")}this.started=false},_mouseDestroy:function(){this.element.unbind("."+this.widgetName);(c.browser.msie&&this.element.attr("unselectable",this._mouseUnselectable))},_mouseDown:function(n){n.originalEvent=n.originalEvent||{};if(n.originalEvent.mouseHandled){return}(this._mouseStarted&&this._mouseUp(n));this._mouseDownEvent=n;var m=this,q=(n.which==1),l=(typeof this.options.cancel=="string"?c(n.target).parents().add(n.target).filter(this.options.cancel).length:false);if(!q||l||!this._mouseCapture(n)){return true}this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){m.mouseDelayMet=true},this.options.delay)}if(this._mouseDistanceMet(n)&&this._mouseDelayMet(n)){this._mouseStarted=(this._mouseStart(n)!==false);if(!this._mouseStarted){n.preventDefault();return true}}this._mouseMoveDelegate=function(r){return m._mouseMove(r)};this._mouseUpDelegate=function(r){return m._mouseUp(r)};c(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);(c.browser.safari||n.preventDefault());n.originalEvent.mouseHandled=true;return true},_mouseMove:function(l){if(c.browser.msie&&!l.button){return this._mouseUp(l)}if(this._mouseStarted){this._mouseDrag(l);return l.preventDefault()}if(this._mouseDistanceMet(l)&&this._mouseDelayMet(l)){this._mouseStarted=(this._mouseStart(this._mouseDownEvent,l)!==false);(this._mouseStarted?this._mouseDrag(l):this._mouseUp(l))}return !this._mouseStarted},_mouseUp:function(l){c(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;this._preventClickEvent=(l.target==this._mouseDownEvent.target);this._mouseStop(l)}return false},_mouseDistanceMet:function(l){return(Math.max(Math.abs(this._mouseDownEvent.pageX-l.pageX),Math.abs(this._mouseDownEvent.pageY-l.pageY))>=this.options.distance)},_mouseDelayMet:function(l){return this.mouseDelayMet},_mouseStart:function(l){},_mouseDrag:function(l){},_mouseStop:function(l){},_mouseCapture:function(l){return true}};c.ui.mouse.defaults={cancel:null,distance:1,delay:0}})(jQuery);(function($){$.extend($.ui,{datepicker:{version:"1.7.3"}});var PROP_NAME="datepicker";function Datepicker(){this.debug=false;this._curInst=null;this._keyEvent=false;this._disabledInputs=[];this._datepickerShowing=false;this._inDialog=false;this._mainDivId="ui-datepicker-div";this._inlineClass="ui-datepicker-inline";this._appendClass="ui-datepicker-append";this._triggerClass="ui-datepicker-trigger";this._dialogClass="ui-datepicker-dialog";this._disableClass="ui-datepicker-disabled";this._unselectableClass="ui-datepicker-unselectable";this._currentClass="ui-datepicker-current-day";this._dayOverClass="ui-datepicker-days-cell-over";this.regional=[];this.regional[""]={clearText:"Clear",closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],dateFormat:"mm/dd/yy",firstDay:0,isRTL:false};this._defaults={showOn:"focus",showAnim:"show",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:false,hideIfNoPrevNext:false,navigationAsDateFormat:false,gotoCurrent:false,changeMonth:false,changeYear:false,showMonthAfterYear:false,yearRange:"-10:+10",showOtherMonths:false,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"normal",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:true,showClearButton:true,showButtonPanel:false};$.extend(this._defaults,this.regional[""]);this.dpDiv=$('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all ui-helper-hidden-accessible"></div>')}$.extend(Datepicker.prototype,{markerClassName:"hasDatepicker",log:function(){if(this.debug){console.log.apply("",arguments)}},setDefaults:function(settings){extendRemove(this._defaults,settings||{});return this},_attachDatepicker:function(target,settings){var inlineSettings=null;for(var attrName in this._defaults){var attrValue=target.getAttribute("date:"+attrName);if(attrValue){inlineSettings=inlineSettings||{};try{inlineSettings[attrName]=eval(attrValue)}catch(err){inlineSettings[attrName]=attrValue}}}var nodeName=target.nodeName.toLowerCase();var inline=(nodeName=="div"||nodeName=="span");if(!target.id){target.id="dp"+(++this.uuid)}var inst=this._newInst($(target),inline);inst.settings=$.extend({},settings||{},inlineSettings||{});if(nodeName=="input"){this._connectDatepicker(target,inst)}else{if(inline){this._inlineDatepicker(target,inst)}}},_newInst:function(target,inline){var id=target[0].id.replace(/([:\[\]\.])/g,"\\\\$1");return{id:id,input:target,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:inline,dpDiv:(!inline?this.dpDiv:$('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))}},_connectDatepicker:function(target,inst){var input=$(target);inst.append=$([]);inst.trigger=$([]);if(input.hasClass(this.markerClassName)){return}var appendText=this._get(inst,"appendText");var isRTL=this._get(inst,"isRTL");if(appendText){inst.append=$('<span class="'+this._appendClass+'">'+appendText+"</span>");input[isRTL?"before":"after"](inst.append)}var showOn=this._get(inst,"showOn");if(showOn=="focus"||showOn=="both"){input.focus(this._showDatepicker)}if(showOn=="button"||showOn=="both"){var buttonText=this._get(inst,"buttonText");var buttonImage=this._get(inst,"buttonImage");inst.trigger=$(this._get(inst,"buttonImageOnly")?$("<img/>").addClass(this._triggerClass).attr({src:buttonImage,alt:buttonText,title:buttonText}):$('<button type="button"></button>').addClass(this._triggerClass).html(buttonImage==""?buttonText:$("<img/>").attr({src:buttonImage,alt:buttonText,title:buttonText})));input[isRTL?"before":"after"](inst.trigger);inst.trigger.click(function(){if($.datepicker._datepickerShowing&&$.datepicker._lastInput==target){$.datepicker._hideDatepicker()}else{$.datepicker._showDatepicker(target)}return false})}input.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).bind("setData.datepicker",function(event,key,value){inst.settings[key]=value}).bind("getData.datepicker",function(event,key){return this._get(inst,key)});$.data(target,PROP_NAME,inst)},_inlineDatepicker:function(target,inst){var divSpan=$(target);if(divSpan.hasClass(this.markerClassName)){return}divSpan.addClass(this.markerClassName).append(inst.dpDiv).bind("setData.datepicker",function(event,key,value){inst.settings[key]=value}).bind("getData.datepicker",function(event,key){return this._get(inst,key)});$.data(target,PROP_NAME,inst);this._setDate(inst,this._getDefaultDate(inst));this._updateDatepicker(inst);this._updateAlternate(inst)},_dialogDatepicker:function(input,dateText,onSelect,settings,pos){var inst=this._dialogInst;if(!inst){var id="dp"+(++this.uuid);this._dialogInput=$('<input type="text" id="'+id+'" size="1" style="position: absolute; top: -100px;"/>');this._dialogInput.keydown(this._doKeyDown);$("body").append(this._dialogInput);inst=this._dialogInst=this._newInst(this._dialogInput,false);inst.settings={};$.data(this._dialogInput[0],PROP_NAME,inst)}extendRemove(inst.settings,settings||{});this._dialogInput.val(dateText);this._pos=(pos?(pos.length?pos:[pos.pageX,pos.pageY]):null);if(!this._pos){var browserWidth=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;var browserHeight=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;var scrollX=document.documentElement.scrollLeft||document.body.scrollLeft;var scrollY=document.documentElement.scrollTop||document.body.scrollTop;this._pos=[(browserWidth/2)-100+scrollX,(browserHeight/2)-150+scrollY]}this._dialogInput.css("left",this._pos[0]+"px").css("top",this._pos[1]+"px");inst.settings.onSelect=onSelect;this._inDialog=true;this.dpDiv.addClass(this._dialogClass);this._showDatepicker(this._dialogInput[0]);if($.blockUI){$.blockUI(this.dpDiv)}$.data(this._dialogInput[0],PROP_NAME,inst);return this},_destroyDatepicker:function(target){var $target=$(target);var inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return}var nodeName=target.nodeName.toLowerCase();$.removeData(target,PROP_NAME);if(nodeName=="input"){inst.append.remove();inst.trigger.remove();$target.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress)}else{if(nodeName=="div"||nodeName=="span"){$target.removeClass(this.markerClassName).empty()}}},_enableDatepicker:function(target){var $target=$(target);var inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return}var nodeName=target.nodeName.toLowerCase();if(nodeName=="input"){target.disabled=false;inst.trigger.filter("button").each(function(){this.disabled=false}).end().filter("img").css({opacity:"1.0",cursor:""})}else{if(nodeName=="div"||nodeName=="span"){var inline=$target.children("."+this._inlineClass);inline.children().removeClass("ui-state-disabled")}}this._disabledInputs=$.map(this._disabledInputs,function(value){return(value==target?null:value)})},_disableDatepicker:function(target){var $target=$(target);var inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return}var nodeName=target.nodeName.toLowerCase();if(nodeName=="input"){target.disabled=true;inst.trigger.filter("button").each(function(){this.disabled=true}).end().filter("img").css({opacity:"0.5",cursor:"default"})}else{if(nodeName=="div"||nodeName=="span"){var inline=$target.children("."+this._inlineClass);inline.children().addClass("ui-state-disabled")}}this._disabledInputs=$.map(this._disabledInputs,function(value){return(value==target?null:value)});this._disabledInputs[this._disabledInputs.length]=target},_isDisabledDatepicker:function(target){if(!target){return false}for(var i=0;i<this._disabledInputs.length;i++){if(this._disabledInputs[i]==target){return true}}return false},_getInst:function(target){try{return $.data(target,PROP_NAME)}catch(err){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(target,name,value){var inst=this._getInst(target);if(arguments.length==2&&typeof name=="string"){return(name=="defaults"?$.extend({},$.datepicker._defaults):(inst?(name=="all"?$.extend({},inst.settings):this._get(inst,name)):null))}var settings=name||{};if(typeof name=="string"){settings={};settings[name]=value}if(inst){if(this._curInst==inst){this._hideDatepicker(null)}var date=this._getDateDatepicker(target);extendRemove(inst.settings,settings);this._setDateDatepicker(target,date);this._updateDatepicker(inst)}},_changeDatepicker:function(target,name,value){this._optionDatepicker(target,name,value)},_refreshDatepicker:function(target){var inst=this._getInst(target);if(inst){this._updateDatepicker(inst)}},_setDateDatepicker:function(target,date,endDate){var inst=this._getInst(target);if(inst){this._setDate(inst,date,endDate);this._updateDatepicker(inst);this._updateAlternate(inst)}},_getDateDatepicker:function(target){var inst=this._getInst(target);if(inst&&!inst.inline){this._setDateFromField(inst)}return(inst?this._getDate(inst):null)},_doKeyDown:function(event){var inst=$.datepicker._getInst(event.target);var handled=true;var isRTL=inst.dpDiv.is(".ui-datepicker-rtl");inst._keyEvent=true;if($.datepicker._datepickerShowing){switch(event.keyCode){case 9:$.datepicker._hideDatepicker(null,"");break;case 13:var sel=$("td."+$.datepicker._dayOverClass+", td."+$.datepicker._currentClass,inst.dpDiv);if(sel[0]){$.datepicker._selectDay(event.target,inst.selectedMonth,inst.selectedYear,sel[0])}else{$.datepicker._hideDatepicker(null,$.datepicker._get(inst,"duration"))}return false;break;case 27:$.datepicker._hideDatepicker(null,$.datepicker._get(inst,"duration"));break;case 33:$.datepicker._adjustDate(event.target,(event.ctrlKey?-$.datepicker._get(inst,"stepBigMonths"):-$.datepicker._get(inst,"stepMonths")),"M");break;case 34:$.datepicker._adjustDate(event.target,(event.ctrlKey?+$.datepicker._get(inst,"stepBigMonths"):+$.datepicker._get(inst,"stepMonths")),"M");break;case 35:if(event.ctrlKey||event.metaKey){$.datepicker._clearDate(event.target)}handled=event.ctrlKey||event.metaKey;break;case 36:if(event.ctrlKey||event.metaKey){$.datepicker._gotoToday(event.target)}handled=event.ctrlKey||event.metaKey;break;case 37:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,(isRTL?+1:-1),"D")}handled=event.ctrlKey||event.metaKey;if(event.originalEvent.altKey){$.datepicker._adjustDate(event.target,(event.ctrlKey?-$.datepicker._get(inst,"stepBigMonths"):-$.datepicker._get(inst,"stepMonths")),"M")}break;case 38:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,-7,"D")}handled=event.ctrlKey||event.metaKey;break;case 39:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,(isRTL?-1:+1),"D")}handled=event.ctrlKey||event.metaKey;if(event.originalEvent.altKey){$.datepicker._adjustDate(event.target,(event.ctrlKey?+$.datepicker._get(inst,"stepBigMonths"):+$.datepicker._get(inst,"stepMonths")),"M")}break;case 40:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,+7,"D")}handled=event.ctrlKey||event.metaKey;break;default:handled=false}}else{if(event.keyCode==36&&event.ctrlKey){$.datepicker._showDatepicker(this)}else{handled=false}}if(handled){event.preventDefault();event.stopPropagation()}},_doKeyPress:function(event){var inst=$.datepicker._getInst(event.target);if($.datepicker._get(inst,"constrainInput")){var chars=$.datepicker._possibleChars($.datepicker._get(inst,"dateFormat"));var chr=String.fromCharCode(event.charCode==undefined?event.keyCode:event.charCode);return event.ctrlKey||(chr<" "||!chars||chars.indexOf(chr)>-1)}},_showDatepicker:function(input){input=input.target||input;if(input.nodeName.toLowerCase()!="input"){input=$("input",input.parentNode)[0]}if($.datepicker._isDisabledDatepicker(input)||$.datepicker._lastInput==input){return}var inst=$.datepicker._getInst(input);var beforeShow=$.datepicker._get(inst,"beforeShow");extendRemove(inst.settings,(beforeShow?beforeShow.apply(input,[input,inst]):{}));$.datepicker._hideDatepicker(null,"");$.datepicker._lastInput=input;$.datepicker._setDateFromField(inst);if($.datepicker._inDialog){input.value=""}if(!$.datepicker._pos){$.datepicker._pos=$.datepicker._findPos(input);$.datepicker._pos[1]+=input.offsetHeight}var isFixed=false;$(input).parents().each(function(){isFixed|=$(this).css("position")=="fixed";return !isFixed});if(isFixed&&$.browser.opera){$.datepicker._pos[0]-=document.documentElement.scrollLeft;$.datepicker._pos[1]-=document.documentElement.scrollTop}var offset={left:$.datepicker._pos[0],top:$.datepicker._pos[1]};$.datepicker._pos=null;inst.rangeStart=null;inst.dpDiv.css({position:"absolute",display:"block",top:"-1000px"});$.datepicker._updateDatepicker(inst);offset=$.datepicker._checkOffset(inst,offset,isFixed);inst.dpDiv.css({position:($.datepicker._inDialog&&$.blockUI?"static":(isFixed?"fixed":"absolute")),display:"none",left:offset.left+"px",top:offset.top+"px"});if(!inst.inline){var showAnim=$.datepicker._get(inst,"showAnim")||"show";var duration=$.datepicker._get(inst,"duration");var postProcess=function(){$.datepicker._datepickerShowing=true;if($.browser.msie&&parseInt($.browser.version,10)<7){$("iframe.ui-datepicker-cover").css({width:inst.dpDiv.width()+4,height:inst.dpDiv.height()+4})}};if($.effects&&$.effects[showAnim]){inst.dpDiv.show(showAnim,$.datepicker._get(inst,"showOptions"),duration,postProcess)}else{inst.dpDiv[showAnim](duration,postProcess)}if(duration==""){postProcess()}if(inst.input[0].type!="hidden"){inst.input[0].focus()}$.datepicker._curInst=inst}},_updateDatepicker:function(inst){var dims={width:inst.dpDiv.width()+4,height:inst.dpDiv.height()+4};var self=this;inst.dpDiv.empty().append(this._generateHTML(inst)).find("iframe.ui-datepicker-cover").css({width:dims.width,height:dims.height}).end().find("button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a").bind("mouseout",function(){$(this).removeClass("ui-state-hover");if(this.className.indexOf("ui-datepicker-prev")!=-1){$(this).removeClass("ui-datepicker-prev-hover")}if(this.className.indexOf("ui-datepicker-next")!=-1){$(this).removeClass("ui-datepicker-next-hover")}}).bind("mouseover",function(){if(!self._isDisabledDatepicker(inst.inline?inst.dpDiv.parent()[0]:inst.input[0])){$(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover");$(this).addClass("ui-state-hover");if(this.className.indexOf("ui-datepicker-prev")!=-1){$(this).addClass("ui-datepicker-prev-hover")}if(this.className.indexOf("ui-datepicker-next")!=-1){$(this).addClass("ui-datepicker-next-hover")}}}).end().find("."+this._dayOverClass+" a").trigger("mouseover").end();var numMonths=this._getNumberOfMonths(inst);var cols=numMonths[1];var width=17;if(cols>1){inst.dpDiv.addClass("ui-datepicker-multi-"+cols).css("width",(width*cols)+"em")}else{inst.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width("")}inst.dpDiv[(numMonths[0]!=1||numMonths[1]!=1?"add":"remove")+"Class"]("ui-datepicker-multi");inst.dpDiv[(this._get(inst,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl");if(inst.input&&inst.input[0].type!="hidden"&&inst==$.datepicker._curInst){$(inst.input[0]).focus()}},_checkOffset:function(inst,offset,isFixed){var dpWidth=inst.dpDiv.outerWidth();var dpHeight=inst.dpDiv.outerHeight();var inputWidth=inst.input?inst.input.outerWidth():0;var inputHeight=inst.input?inst.input.outerHeight():0;var viewWidth=(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)+$(document).scrollLeft();var viewHeight=(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)+$(document).scrollTop();offset.left-=(this._get(inst,"isRTL")?(dpWidth-inputWidth):0);offset.left-=(isFixed&&offset.left==inst.input.offset().left)?$(document).scrollLeft():0;offset.top-=(isFixed&&offset.top==(inst.input.offset().top+inputHeight))?$(document).scrollTop():0;offset.left-=(offset.left+dpWidth>viewWidth&&viewWidth>dpWidth)?Math.abs(offset.left+dpWidth-viewWidth):0;offset.top-=(offset.top+dpHeight>viewHeight&&viewHeight>dpHeight)?Math.abs(offset.top+dpHeight+inputHeight*2-viewHeight):0;return offset},_findPos:function(obj){while(obj&&(obj.type=="hidden"||obj.nodeType!=1)){obj=obj.nextSibling}var position=$(obj).offset();return[position.left,position.top]},_hideDatepicker:function(input,duration){var inst=this._curInst;if(!inst||(input&&inst!=$.data(input,PROP_NAME))){return}if(inst.stayOpen){this._selectDate("#"+inst.id,this._formatDate(inst,inst.currentDay,inst.currentMonth,inst.currentYear))}inst.stayOpen=false;if(this._datepickerShowing){duration=(duration!=null?duration:this._get(inst,"duration"));var showAnim=this._get(inst,"showAnim");var postProcess=function(){$.datepicker._tidyDialog(inst)};if(duration!=""&&$.effects&&$.effects[showAnim]){inst.dpDiv.hide(showAnim,$.datepicker._get(inst,"showOptions"),duration,postProcess)}else{inst.dpDiv[(duration==""?"hide":(showAnim=="slideDown"?"slideUp":(showAnim=="fadeIn"?"fadeOut":"hide")))](duration,postProcess)}if(duration==""){this._tidyDialog(inst)}var onClose=this._get(inst,"onClose");if(onClose){onClose.apply((inst.input?inst.input[0]:null),[(inst.input?inst.input.val():""),inst])}this._datepickerShowing=false;this._lastInput=null;if(this._inDialog){this._dialogInput.css({position:"absolute",left:"0",top:"-100px"});if($.blockUI){$.unblockUI();$("body").append(this.dpDiv)}}this._inDialog=false}this._curInst=null},_tidyDialog:function(inst){inst.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(event){if(!$.datepicker._curInst){return}var $target=$(event.target);if(($target.parents("#"+$.datepicker._mainDivId).length==0)&&!$target.hasClass($.datepicker.markerClassName)&&!$target.hasClass($.datepicker._triggerClass)&&$.datepicker._datepickerShowing&&!($.datepicker._inDialog&&$.blockUI)){$.datepicker._hideDatepicker(null,"")}},_adjustDate:function(id,offset,period){var target=$(id);var inst=this._getInst(target[0]);if(this._isDisabledDatepicker(target[0])){return}this._adjustInstDate(inst,offset+(period=="M"?this._get(inst,"showCurrentAtPos"):0),period);this._updateDatepicker(inst)},_gotoToday:function(id){var target=$(id);var inst=this._getInst(target[0]);if(this._get(inst,"gotoCurrent")&&inst.currentDay){inst.selectedDay=inst.currentDay;inst.drawMonth=inst.selectedMonth=inst.currentMonth;inst.drawYear=inst.selectedYear=inst.currentYear}else{var date=new Date();inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear()}this._notifyChange(inst);this._adjustDate(target)},_selectMonthYear:function(id,select,period){var target=$(id);var inst=this._getInst(target[0]);inst._selectingMonthYear=false;inst["selected"+(period=="M"?"Month":"Year")]=inst["draw"+(period=="M"?"Month":"Year")]=parseInt(select.options[select.selectedIndex].value,10);this._notifyChange(inst);this._adjustDate(target)},_clickMonthYear:function(id){var target=$(id);var inst=this._getInst(target[0]);if(inst.input&&inst._selectingMonthYear&&!$.browser.msie){inst.input[0].focus()}inst._selectingMonthYear=!inst._selectingMonthYear},_selectDay:function(id,month,year,td){var target=$(id);if($(td).hasClass(this._unselectableClass)||this._isDisabledDatepicker(target[0])){return}var inst=this._getInst(target[0]);inst.selectedDay=inst.currentDay=$("a",td).html();inst.selectedMonth=inst.currentMonth=month;inst.selectedYear=inst.currentYear=year;if(inst.stayOpen){inst.endDay=inst.endMonth=inst.endYear=null}this._selectDate(id,this._formatDate(inst,inst.currentDay,inst.currentMonth,inst.currentYear));if(inst.stayOpen){inst.rangeStart=this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay));this._updateDatepicker(inst)}},_clearDate:function(id){var target=$(id);var inst=this._getInst(target[0]);inst.stayOpen=false;inst.endDay=inst.endMonth=inst.endYear=inst.rangeStart=null;this._selectDate(target,"")},_selectDate:function(id,dateStr){var target=$(id);var inst=this._getInst(target[0]);dateStr=(dateStr!=null?dateStr:this._formatDate(inst));if(inst.input){inst.input.val(dateStr)}this._updateAlternate(inst);var onSelect=this._get(inst,"onSelect");if(onSelect){onSelect.apply((inst.input?inst.input[0]:null),[dateStr,inst])}else{if(inst.input){inst.input.trigger("change")}}if(inst.inline){this._updateDatepicker(inst)}else{if(!inst.stayOpen){this._hideDatepicker(null,this._get(inst,"duration"));this._lastInput=inst.input[0];if(typeof(inst.input[0])!="object"){inst.input[0].focus()}this._lastInput=null}}},_updateAlternate:function(inst){var altField=this._get(inst,"altField");if(altField){var altFormat=this._get(inst,"altFormat")||this._get(inst,"dateFormat");var date=this._getDate(inst);dateStr=this.formatDate(altFormat,date,this._getFormatConfig(inst));$(altField).each(function(){$(this).val(dateStr)})}},noWeekends:function(date){var day=date.getDay();return[(day>0&&day<6),""]},iso8601Week:function(date){var checkDate=new Date(date.getFullYear(),date.getMonth(),date.getDate());var firstMon=new Date(checkDate.getFullYear(),1-1,4);var firstDay=firstMon.getDay()||7;firstMon.setDate(firstMon.getDate()+1-firstDay);if(firstDay<4&&checkDate<firstMon){checkDate.setDate(checkDate.getDate()-3);return $.datepicker.iso8601Week(checkDate)}else{if(checkDate>new Date(checkDate.getFullYear(),12-1,28)){firstDay=new Date(checkDate.getFullYear()+1,1-1,4).getDay()||7;if(firstDay>4&&(checkDate.getDay()||7)<firstDay-3){return 1}}}return Math.floor(((checkDate-firstMon)/86400000)/7)+1},parseDate:function(format,value,settings){if(format==null||value==null){throw"Invalid arguments"}value=(typeof value=="object"?value.toString():value+"");if(value==""){return null}var shortYearCutoff=(settings?settings.shortYearCutoff:null)||this._defaults.shortYearCutoff;var dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort;var dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames;var monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort;var monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames;var year=-1;var month=-1;var day=-1;var doy=-1;var literal=false;var lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)==match);if(matches){iFormat++}return matches};var getNumber=function(match){lookAhead(match);var origSize=(match=="@"?14:(match=="y"?4:(match=="o"?3:2)));var size=origSize;var num=0;while(size>0&&iValue<value.length&&value.charAt(iValue)>="0"&&value.charAt(iValue)<="9"){num=num*10+parseInt(value.charAt(iValue++),10);size--}if(size==origSize){throw"Missing number at position "+iValue}return num};var getName=function(match,shortNames,longNames){var names=(lookAhead(match)?longNames:shortNames);var size=0;for(var j=0;j<names.length;j++){size=Math.max(size,names[j].length)}var name="";var iInit=iValue;while(size>0&&iValue<value.length){name+=value.charAt(iValue++);for(var i=0;i<names.length;i++){if(name==names[i]){return i+1}}size--}throw"Unknown name at position "+iInit};var checkLiteral=function(){if(value.charAt(iValue)!=format.charAt(iFormat)){throw"Unexpected literal at position "+iValue}iValue++};var iValue=0;for(var iFormat=0;iFormat<format.length;iFormat++){if(literal){if(format.charAt(iFormat)=="'"&&!lookAhead("'")){literal=false}else{checkLiteral()}}else{switch(format.charAt(iFormat)){case"d":day=getNumber("d");break;case"D":getName("D",dayNamesShort,dayNames);break;case"o":doy=getNumber("o");break;case"m":month=getNumber("m");break;case"M":month=getName("M",monthNamesShort,monthNames);break;case"y":year=getNumber("y");break;case"@":var date=new Date(getNumber("@"));year=date.getFullYear();month=date.getMonth()+1;day=date.getDate();break;case"'":if(lookAhead("'")){checkLiteral()}else{literal=true}break;default:checkLiteral()}}}if(year==-1){year=new Date().getFullYear()}else{if(year<100){year+=new Date().getFullYear()-new Date().getFullYear()%100+(year<=shortYearCutoff?0:-100)}}if(doy>-1){month=1;day=doy;do{var dim=this._getDaysInMonth(year,month-1);if(day<=dim){break}month++;day-=dim}while(true)}var date=this._daylightSavingAdjust(new Date(year,month-1,day));if(date.getFullYear()!=year||date.getMonth()+1!=month||date.getDate()!=day){throw"Invalid date"}return date},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TIMESTAMP:"@",W3C:"yy-mm-dd",formatDate:function(format,date,settings){if(!date){return""}var dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort;var dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames;var monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort;var monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames;var lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)==match);if(matches){iFormat++}return matches};var formatNumber=function(match,value,len){var num=""+value;if(lookAhead(match)){while(num.length<len){num="0"+num}}return num};var formatName=function(match,value,shortNames,longNames){return(lookAhead(match)?longNames[value]:shortNames[value])};var output="";var literal=false;if(date){for(var iFormat=0;iFormat<format.length;iFormat++){if(literal){if(format.charAt(iFormat)=="'"&&!lookAhead("'")){literal=false}else{output+=format.charAt(iFormat)}}else{switch(format.charAt(iFormat)){case"d":output+=formatNumber("d",date.getDate(),2);break;case"D":output+=formatName("D",date.getDay(),dayNamesShort,dayNames);break;case"o":var doy=date.getDate();for(var m=date.getMonth()-1;m>=0;m--){doy+=this._getDaysInMonth(date.getFullYear(),m)}output+=formatNumber("o",doy,3);break;case"m":output+=formatNumber("m",date.getMonth()+1,2);break;case"M":output+=formatName("M",date.getMonth(),monthNamesShort,monthNames);break;case"y":output+=(lookAhead("y")?date.getFullYear():(date.getYear()%100<10?"0":"")+date.getYear()%100);break;case"@":output+=date.getTime();break;case"'":if(lookAhead("'")){output+="'"}else{literal=true}break;default:output+=format.charAt(iFormat)}}}}return output},_possibleChars:function(format){var chars="";var literal=false;for(var iFormat=0;iFormat<format.length;iFormat++){if(literal){if(format.charAt(iFormat)=="'"&&!lookAhead("'")){literal=false}else{chars+=format.charAt(iFormat)}}else{switch(format.charAt(iFormat)){case"d":case"m":case"y":case"@":chars+="0123456789";break;case"D":case"M":return null;case"'":if(lookAhead("'")){chars+="'"}else{literal=true}break;default:chars+=format.charAt(iFormat)}}}return chars},_get:function(inst,name){return inst.settings[name]!==undefined?inst.settings[name]:this._defaults[name]},_setDateFromField:function(inst){var dateFormat=this._get(inst,"dateFormat");var dates=inst.input?inst.input.val():null;inst.endDay=inst.endMonth=inst.endYear=null;var date=defaultDate=this._getDefaultDate(inst);var settings=this._getFormatConfig(inst);try{date=this.parseDate(dateFormat,dates,settings)||defaultDate}catch(event){this.log(event);date=defaultDate}inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();inst.currentDay=(dates?date.getDate():0);inst.currentMonth=(dates?date.getMonth():0);inst.currentYear=(dates?date.getFullYear():0);this._adjustInstDate(inst)},_getDefaultDate:function(inst){var date=this._determineDate(this._get(inst,"defaultDate"),new Date());var minDate=this._getMinMaxDate(inst,"min",true);var maxDate=this._getMinMaxDate(inst,"max");date=(minDate&&date<minDate?minDate:date);date=(maxDate&&date>maxDate?maxDate:date);return date},_determineDate:function(date,defaultDate){var offsetNumeric=function(offset){var date=new Date();date.setDate(date.getDate()+offset);return date};var offsetString=function(offset,getDaysInMonth){var date=new Date();var year=date.getFullYear();var month=date.getMonth();var day=date.getDate();var pattern=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g;var matches=pattern.exec(offset);while(matches){switch(matches[2]||"d"){case"d":case"D":day+=parseInt(matches[1],10);break;case"w":case"W":day+=parseInt(matches[1],10)*7;break;case"m":case"M":month+=parseInt(matches[1],10);day=Math.min(day,getDaysInMonth(year,month));break;case"y":case"Y":year+=parseInt(matches[1],10);day=Math.min(day,getDaysInMonth(year,month));break}matches=pattern.exec(offset)}return new Date(year,month,day)};date=(date==null?defaultDate:(typeof date=="string"?offsetString(date,this._getDaysInMonth):(typeof date=="number"?(isNaN(date)?defaultDate:offsetNumeric(date)):date)));date=(date&&date.toString()=="Invalid Date"?defaultDate:date);if(date){date.setHours(0);date.setMinutes(0);date.setSeconds(0);date.setMilliseconds(0)}return this._daylightSavingAdjust(date)},_daylightSavingAdjust:function(date){if(!date){return null}date.setHours(date.getHours()>12?date.getHours()+2:0);return date},_setDate:function(inst,date,endDate){var clear=!(date);var origMonth=inst.selectedMonth;var origYear=inst.selectedYear;date=this._determineDate(date,new Date());inst.selectedDay=inst.currentDay=date.getDate();inst.drawMonth=inst.selectedMonth=inst.currentMonth=date.getMonth();inst.drawYear=inst.selectedYear=inst.currentYear=date.getFullYear();if(origMonth!=inst.selectedMonth||origYear!=inst.selectedYear){this._notifyChange(inst)}this._adjustInstDate(inst);if(inst.input){inst.input.val(clear?"":this._formatDate(inst))}},_getDate:function(inst){var startDate=(!inst.currentYear||(inst.input&&inst.input.val()=="")?null:this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));return startDate},_generateHTML:function(inst){var today=new Date();today=this._daylightSavingAdjust(new Date(today.getFullYear(),today.getMonth(),today.getDate()));var isRTL=this._get(inst,"isRTL");var showButtonPanel=this._get(inst,"showButtonPanel");var hideIfNoPrevNext=this._get(inst,"hideIfNoPrevNext");var navigationAsDateFormat=this._get(inst,"navigationAsDateFormat");var numMonths=this._getNumberOfMonths(inst);var showCurrentAtPos=this._get(inst,"showCurrentAtPos");var stepMonths=this._get(inst,"stepMonths");var stepBigMonths=this._get(inst,"stepBigMonths");var isMultiMonth=(numMonths[0]!=1||numMonths[1]!=1);var currentDate=this._daylightSavingAdjust((!inst.currentDay?new Date(9999,9,9):new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));var minDate=this._getMinMaxDate(inst,"min",true);var maxDate=this._getMinMaxDate(inst,"max");var drawMonth=inst.drawMonth-showCurrentAtPos;var drawYear=inst.drawYear;if(drawMonth<0){drawMonth+=12;drawYear--}if(maxDate){var maxDraw=this._daylightSavingAdjust(new Date(maxDate.getFullYear(),maxDate.getMonth()-numMonths[1]+1,maxDate.getDate()));maxDraw=(minDate&&maxDraw<minDate?minDate:maxDraw);while(this._daylightSavingAdjust(new Date(drawYear,drawMonth,1))>maxDraw){drawMonth--;if(drawMonth<0){drawMonth=11;drawYear--}}}inst.drawMonth=drawMonth;inst.drawYear=drawYear;var prevText=this._get(inst,"prevText");prevText=(!navigationAsDateFormat?prevText:this.formatDate(prevText,this._daylightSavingAdjust(new Date(drawYear,drawMonth-stepMonths,1)),this._getFormatConfig(inst)));var prev=(this._canAdjustMonth(inst,-1,drawYear,drawMonth)?'<a class="ui-datepicker-prev ui-corner-all" onclick="DP_jQuery.datepicker._adjustDate(\'#'+inst.id+"', -"+stepMonths+", 'M');\" title=\""+prevText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?"e":"w")+'">'+prevText+"</span></a>":(hideIfNoPrevNext?"":'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+prevText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?"e":"w")+'">'+prevText+"</span></a>"));var nextText=this._get(inst,"nextText");nextText=(!navigationAsDateFormat?nextText:this.formatDate(nextText,this._daylightSavingAdjust(new Date(drawYear,drawMonth+stepMonths,1)),this._getFormatConfig(inst)));var next=(this._canAdjustMonth(inst,+1,drawYear,drawMonth)?'<a class="ui-datepicker-next ui-corner-all" onclick="DP_jQuery.datepicker._adjustDate(\'#'+inst.id+"', +"+stepMonths+", 'M');\" title=\""+nextText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?"w":"e")+'">'+nextText+"</span></a>":(hideIfNoPrevNext?"":'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+nextText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?"w":"e")+'">'+nextText+"</span></a>"));var currentText=this._get(inst,"currentText");var gotoDate=(this._get(inst,"gotoCurrent")&&inst.currentDay?currentDate:today);currentText=(!navigationAsDateFormat?currentText:this.formatDate(currentText,gotoDate,this._getFormatConfig(inst)));var controls=(!inst.inline?'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" onclick="DP_jQuery.datepicker._hideDatepicker();">'+this._get(inst,"closeText")+"</button>":"");var clearControl='<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" onclick="DP_jQuery.datepicker._clearDate(\'#'+inst.id+"');\">"+this._get(inst,"clearText")+"</button>";var buttonPanel=(showButtonPanel)?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(isRTL?controls:"")+(this._isInRange(inst,gotoDate)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" onclick="DP_jQuery.datepicker._gotoToday(\'#'+inst.id+"');\">"+currentText+"</button>":"")+(isRTL?"":controls)+(this._get(inst,"showClearButton")?clearControl:"")+"</div>":"";var firstDay=parseInt(this._get(inst,"firstDay"),10);firstDay=(isNaN(firstDay)?0:firstDay);var dayNames=this._get(inst,"dayNames");var dayNamesShort=this._get(inst,"dayNamesShort");var dayNamesMin=this._get(inst,"dayNamesMin");var monthNames=this._get(inst,"monthNames");var monthNamesShort=this._get(inst,"monthNamesShort");var beforeShowDay=this._get(inst,"beforeShowDay");var showOtherMonths=this._get(inst,"showOtherMonths");var calculateWeek=this._get(inst,"calculateWeek")||this.iso8601Week;var endDate=inst.endDay?this._daylightSavingAdjust(new Date(inst.endYear,inst.endMonth,inst.endDay)):currentDate;var defaultDate=this._getDefaultDate(inst);var html="";for(var row=0;row<numMonths[0];row++){var group="";for(var col=0;col<numMonths[1];col++){var selectedDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,inst.selectedDay));var cornerClass=" ui-corner-all";var calender="";if(isMultiMonth){calender+='<div class="ui-datepicker-group ui-datepicker-group-';switch(col){case 0:calender+="first";cornerClass=" ui-corner-"+(isRTL?"right":"left");break;case numMonths[1]-1:calender+="last";cornerClass=" ui-corner-"+(isRTL?"left":"right");break;default:calender+="middle";cornerClass="";break}calender+='">'}calender+='<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+cornerClass+'">'+(/all|left/.test(cornerClass)&&row==0?(isRTL?next:prev):"")+(/all|right/.test(cornerClass)&&row==0?(isRTL?prev:next):"")+this._generateMonthYearHeader(inst,drawMonth,drawYear,minDate,maxDate,selectedDate,row>0||col>0,monthNames,monthNamesShort)+'</div><table class="ui-datepicker-calendar"><thead><tr>';var thead="";for(var dow=0;dow<7;dow++){var day=(dow+firstDay)%7;thead+="<th"+((dow+firstDay+6)%7>=5?' class="ui-datepicker-week-end"':"")+'><span title="'+dayNames[day]+'">'+dayNamesMin[day]+"</span></th>"}calender+=thead+"</tr></thead><tbody>";var daysInMonth=this._getDaysInMonth(drawYear,drawMonth);if(drawYear==inst.selectedYear&&drawMonth==inst.selectedMonth){inst.selectedDay=Math.min(inst.selectedDay,daysInMonth)}var leadDays=(this._getFirstDayOfMonth(drawYear,drawMonth)-firstDay+7)%7;var numRows=(isMultiMonth?6:Math.ceil((leadDays+daysInMonth)/7));var printDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,1-leadDays));for(var dRow=0;dRow<numRows;dRow++){calender+="<tr>";var tbody="";for(var dow=0;dow<7;dow++){var daySettings=(beforeShowDay?beforeShowDay.apply((inst.input?inst.input[0]:null),[printDate]):[true,""]);var otherMonth=(printDate.getMonth()!=drawMonth);var unselectable=otherMonth||!daySettings[0]||(minDate&&printDate<minDate)||(maxDate&&printDate>maxDate);tbody+='<td class="'+((dow+firstDay+6)%7>=5?" ui-datepicker-week-end":"")+(otherMonth?" ui-datepicker-other-month":"")+((printDate.getTime()==selectedDate.getTime()&&drawMonth==inst.selectedMonth&&inst._keyEvent)||(defaultDate.getTime()==printDate.getTime()&&defaultDate.getTime()==selectedDate.getTime())?" "+this._dayOverClass:"")+(unselectable?" "+this._unselectableClass+" ui-state-disabled":"")+(otherMonth&&!showOtherMonths?"":" "+daySettings[1]+(printDate.getTime()>=currentDate.getTime()&&printDate.getTime()<=endDate.getTime()?" "+this._currentClass:"")+(printDate.getTime()==today.getTime()?" ui-datepicker-today":""))+'"'+((!otherMonth||showOtherMonths)&&daySettings[2]?' title="'+daySettings[2]+'"':"")+(unselectable?"":" onclick=\"DP_jQuery.datepicker._selectDay('#"+inst.id+"',"+drawMonth+","+drawYear+', this);return false;"')+">"+(otherMonth?(showOtherMonths?printDate.getDate():"&#xa0;"):(unselectable?'<span class="ui-state-default">'+printDate.getDate()+"</span>":'<a class="ui-state-default'+(printDate.getTime()==today.getTime()?" ui-state-highlight":"")+(printDate.getTime()>=currentDate.getTime()&&printDate.getTime()<=endDate.getTime()?" ui-state-active":"")+'" href="#">'+printDate.getDate()+"</a>"))+"</td>";printDate.setDate(printDate.getDate()+1);printDate=this._daylightSavingAdjust(printDate)}calender+=tbody+"</tr>"}drawMonth++;if(drawMonth>11){drawMonth=0;drawYear++}calender+="</tbody></table>"+(isMultiMonth?"</div>"+((numMonths[0]>0&&col==numMonths[1]-1)?'<div class="ui-datepicker-row-break"></div>':""):"");group+=calender}html+=group}html+=buttonPanel+($.browser.msie&&parseInt($.browser.version,10)<7&&!inst.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':"");inst._keyEvent=false;return html},_generateMonthYearHeader:function(inst,drawMonth,drawYear,minDate,maxDate,selectedDate,secondary,monthNames,monthNamesShort){minDate=(inst.rangeStart&&minDate&&selectedDate<minDate?selectedDate:minDate);var changeMonth=this._get(inst,"changeMonth");var changeYear=this._get(inst,"changeYear");var showMonthAfterYear=this._get(inst,"showMonthAfterYear");var html='<div class="ui-datepicker-title">';var monthHtml="";if(secondary||!changeMonth){monthHtml+='<span class="ui-datepicker-month">'+monthNames[drawMonth]+"</span> "}else{var inMinYear=(minDate&&minDate.getFullYear()==drawYear);var inMaxYear=(maxDate&&maxDate.getFullYear()==drawYear);monthHtml+='<select class="ui-datepicker-month" onchange="DP_jQuery.datepicker._selectMonthYear(\'#'+inst.id+"', this, 'M');\" onclick=\"DP_jQuery.datepicker._clickMonthYear('#"+inst.id+"');\">";for(var month=0;month<12;month++){if((!inMinYear||month>=minDate.getMonth())&&(!inMaxYear||month<=maxDate.getMonth())){monthHtml+='<option value="'+month+'"'+(month==drawMonth?' selected="selected"':"")+">"+monthNamesShort[month]+"</option>"}}monthHtml+="</select>"}if(!showMonthAfterYear){html+=monthHtml+((secondary||changeMonth||changeYear)&&(!(changeMonth&&changeYear))?"&#xa0;":"")}if(secondary||!changeYear){html+='<span class="ui-datepicker-year">'+drawYear+"</span>"}else{var years=this._get(inst,"yearRange").split(":");var year=0;var endYear=0;if(years.length!=2){year=drawYear-10;endYear=drawYear+10}else{if(years[0].charAt(0)=="+"||years[0].charAt(0)=="-"){year=drawYear+parseInt(years[0],10);endYear=drawYear+parseInt(years[1],10)}else{year=parseInt(years[0],10);endYear=parseInt(years[1],10)}}year=(minDate?Math.max(year,minDate.getFullYear()):year);endYear=(maxDate?Math.min(endYear,maxDate.getFullYear()):endYear);html+='<select class="ui-datepicker-year" onchange="DP_jQuery.datepicker._selectMonthYear(\'#'+inst.id+"', this, 'Y');\" onclick=\"DP_jQuery.datepicker._clickMonthYear('#"+inst.id+"');\">";for(;year<=endYear;year++){html+='<option value="'+year+'"'+(year==drawYear?' selected="selected"':"")+">"+year+"</option>"}html+="</select>"}if(showMonthAfterYear){html+=(secondary||changeMonth||changeYear?"&#xa0;":"")+monthHtml}html+="</div>";return html},_adjustInstDate:function(inst,offset,period){var year=inst.drawYear+(period=="Y"?offset:0);var month=inst.drawMonth+(period=="M"?offset:0);var day=Math.min(inst.selectedDay,this._getDaysInMonth(year,month))+(period=="D"?offset:0);var date=this._daylightSavingAdjust(new Date(year,month,day));var minDate=this._getMinMaxDate(inst,"min",true);var maxDate=this._getMinMaxDate(inst,"max");date=(minDate&&date<minDate?minDate:date);date=(maxDate&&date>maxDate?maxDate:date);inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();if(period=="M"||period=="Y"){this._notifyChange(inst)}},_notifyChange:function(inst){var onChange=this._get(inst,"onChangeMonthYear");if(onChange){onChange.apply((inst.input?inst.input[0]:null),[inst.selectedYear,inst.selectedMonth+1,inst])}},_getNumberOfMonths:function(inst){var numMonths=this._get(inst,"numberOfMonths");return(numMonths==null?[1,1]:(typeof numMonths=="number"?[1,numMonths]:numMonths))},_getMinMaxDate:function(inst,minMax,checkRange){var date=this._determineDate(this._get(inst,minMax+"Date"),null);return(!checkRange||!inst.rangeStart?date:(!date||inst.rangeStart>date?inst.rangeStart:date))},_getDaysInMonth:function(year,month){return 32-new Date(year,month,32).getDate()},_getFirstDayOfMonth:function(year,month){return new Date(year,month,1).getDay()},_canAdjustMonth:function(inst,offset,curYear,curMonth){var numMonths=this._getNumberOfMonths(inst);var date=this._daylightSavingAdjust(new Date(curYear,curMonth+(offset<0?offset:numMonths[1]),1));if(offset<0){date.setDate(this._getDaysInMonth(date.getFullYear(),date.getMonth()))}return this._isInRange(inst,date)},_isInRange:function(inst,date){var newMinDate=(!inst.rangeStart?null:this._daylightSavingAdjust(new Date(inst.selectedYear,inst.selectedMonth,inst.selectedDay)));newMinDate=(newMinDate&&inst.rangeStart<newMinDate?inst.rangeStart:newMinDate);var minDate=newMinDate||this._getMinMaxDate(inst,"min");var maxDate=this._getMinMaxDate(inst,"max");return((!minDate||date>=minDate)&&(!maxDate||date<=maxDate))},_getFormatConfig:function(inst){var shortYearCutoff=this._get(inst,"shortYearCutoff");shortYearCutoff=(typeof shortYearCutoff!="string"?shortYearCutoff:new Date().getFullYear()%100+parseInt(shortYearCutoff,10));return{shortYearCutoff:shortYearCutoff,dayNamesShort:this._get(inst,"dayNamesShort"),dayNames:this._get(inst,"dayNames"),monthNamesShort:this._get(inst,"monthNamesShort"),monthNames:this._get(inst,"monthNames")}},_formatDate:function(inst,day,month,year){if(!day){inst.currentDay=inst.selectedDay;inst.currentMonth=inst.selectedMonth;inst.currentYear=inst.selectedYear}var date=(day?(typeof day=="object"?day:this._daylightSavingAdjust(new Date(year,month,day))):this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));return this.formatDate(this._get(inst,"dateFormat"),date,this._getFormatConfig(inst))}});function extendRemove(target,props){$.extend(target,props);for(var name in props){if(props[name]==null||props[name]==undefined){target[name]=props[name]}}return target}function isArray(a){return(a&&(($.browser.safari&&typeof a=="object"&&a.length)||(a.constructor&&a.constructor.toString().match(/\Array\(\)/))))}$.fn.datepicker=function(options){if(!$.datepicker.initialized){$(document).mousedown($.datepicker._checkExternalClick).find("body").append($.datepicker.dpDiv);$.datepicker.initialized=true}var otherArgs=Array.prototype.slice.call(arguments,1);if(typeof options=="string"&&(options=="isDisabled"||options=="getDate")){return $.datepicker["_"+options+"Datepicker"].apply($.datepicker,[this[0]].concat(otherArgs))}if(options=="option"&&arguments.length==2&&typeof arguments[1]=="string"){return $.datepicker["_"+options+"Datepicker"].apply($.datepicker,[this[0]].concat(otherArgs))}return this.each(function(){typeof options=="string"?$.datepicker["_"+options+"Datepicker"].apply($.datepicker,[this].concat(otherArgs)):$.datepicker._attachDatepicker(this,options)})};$.datepicker=new Datepicker();$.datepicker.initialized=false;$.datepicker.uuid=new Date().getTime();$.datepicker.version="1.7.3";window.DP_jQuery=$})(jQuery);(function(a){a.widget("ui.slider",a.extend({},a.ui.mouse,{_init:function(){var b=this,c=this.options;this._keySliding=false;this._handleIndex=null;this._detectOrientation();this._mouseInit();this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all");this.range=a([]);if(c.range){if(c.range===true){this.range=a("<div></div>");if(!c.values){c.values=[this._valueMin(),this._valueMin()]}if(c.values.length&&c.values.length!=2){c.values=[c.values[0],c.values[0]]}}else{this.range=a("<div></div>")}this.range.appendTo(this.element).addClass("ui-slider-range");if(c.range=="min"||c.range=="max"){this.range.addClass("ui-slider-range-"+c.range)}this.range.addClass("ui-widget-header")}if(a(".ui-slider-handle",this.element).length==0){a('<a href="#"></a>').appendTo(this.element).addClass("ui-slider-handle")}if(c.values&&c.values.length){while(a(".ui-slider-handle",this.element).length<c.values.length){a('<a href="#"></a>').appendTo(this.element).addClass("ui-slider-handle")}}this.handles=a(".ui-slider-handle",this.element).addClass("ui-state-default ui-corner-all");this.handle=this.handles.eq(0);this.handles.add(this.range).filter("a").click(function(e){e.preventDefault()}).hover(function(){if(!c.disabled){a(this).addClass("ui-state-hover")}},function(){a(this).removeClass("ui-state-hover")}).focus(function(){if(!c.disabled){a(".ui-slider .ui-state-focus").removeClass("ui-state-focus");a(this).addClass("ui-state-focus")}else{a(this).blur()}}).blur(function(){a(this).removeClass("ui-state-focus")});this.handles.each(function(e){a(this).data("index.ui-slider-handle",e)});this.handles.keydown(function(k){var g=true;var f=a(this).data("index.ui-slider-handle");if(b.options.disabled){return}switch(k.keyCode){case a.ui.keyCode.HOME:case a.ui.keyCode.END:case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:g=false;if(!b._keySliding){b._keySliding=true;a(this).addClass("ui-state-active");b._start(k,f)}break}var h,e,i=b._step();if(b.options.values&&b.options.values.length){h=e=b.values(f)}else{h=e=b.value()}switch(k.keyCode){case a.ui.keyCode.HOME:e=b._valueMin();break;case a.ui.keyCode.END:e=b._valueMax();break;case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:if(h==b._valueMax()){return}e=h+i;break;case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:if(h==b._valueMin()){return}e=h-i;break}b._slide(k,f,e);return g}).keyup(function(f){var e=a(this).data("index.ui-slider-handle");if(b._keySliding){b._stop(f,e);b._change(f,e);b._keySliding=false;a(this).removeClass("ui-state-active")}});this._refreshValue()},destroy:function(){this.handles.remove();this.range.remove();this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all").removeData("slider").unbind(".slider");this._mouseDestroy()},_mouseCapture:function(e){var f=this.options;if(f.disabled){return false}this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()};this.elementOffset=this.element.offset();var i={x:e.pageX,y:e.pageY};var l=this._normValueFromMouse(i);var c=this._valueMax()-this._valueMin()+1,g;var m=this,k;this.handles.each(function(n){var q=Math.abs(l-m.values(n));if(c>q){c=q;g=a(this);k=n}});if(f.range==true&&this.values(1)==f.min){g=a(this.handles[++k])}this._start(e,k);m._handleIndex=k;g.addClass("ui-state-active").focus();var h=g.offset();var b=!a(e.target).parents().andSelf().is(".ui-slider-handle");this._clickOffset=b?{left:0,top:0}:{left:e.pageX-h.left-(g.width()/2),top:e.pageY-h.top-(g.height()/2)-(parseInt(g.css("borderTopWidth"),10)||0)-(parseInt(g.css("borderBottomWidth"),10)||0)+(parseInt(g.css("marginTop"),10)||0)};l=this._normValueFromMouse(i);this._slide(e,k,l);return true},_mouseStart:function(b){return true},_mouseDrag:function(e){var b={x:e.pageX,y:e.pageY};var c=this._normValueFromMouse(b);this._slide(e,this._handleIndex,c);return false},_mouseStop:function(b){this.handles.removeClass("ui-state-active");this._stop(b,this._handleIndex);this._change(b,this._handleIndex);this._handleIndex=null;this._clickOffset=null;return false},_detectOrientation:function(){this.orientation=this.options.orientation=="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(e){var c,i;if("horizontal"==this.orientation){c=this.elementSize.width;i=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)}else{c=this.elementSize.height;i=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)}var g=(i/c);if(g>1){g=1}if(g<0){g=0}if("vertical"==this.orientation){g=1-g}var f=this._valueMax()-this._valueMin(),k=g*f,b=k%this.options.step,h=this._valueMin()+k-b;if(b>(this.options.step/2)){h+=this.options.step}return parseFloat(h.toFixed(5))},_start:function(e,c){var b={handle:this.handles[c],value:this.value()};if(this.options.values&&this.options.values.length){b.value=this.values(c);b.values=this.values()}this._trigger("start",e,b)},_slide:function(g,f,e){var h=this.handles[f];if(this.options.values&&this.options.values.length){var b=this.values(f?0:1);if((this.options.values.length==2&&this.options.range===true)&&((f==0&&e>b)||(f==1&&e<b))){e=b}if(e!=this.values(f)){var c=this.values();c[f]=e;var i=this._trigger("slide",g,{handle:this.handles[f],value:e,values:c});var b=this.values(f?0:1);if(i!==false){this.values(f,e,(g.type=="mousedown"&&this.options.animate),true)}}}else{if(e!=this.value()){var i=this._trigger("slide",g,{handle:this.handles[f],value:e});if(i!==false){this._setData("value",e,(g.type=="mousedown"&&this.options.animate))}}}},_stop:function(e,c){var b={handle:this.handles[c],value:this.value()};if(this.options.values&&this.options.values.length){b.value=this.values(c);b.values=this.values()}this._trigger("stop",e,b)},_change:function(e,c){var b={handle:this.handles[c],value:this.value()};if(this.options.values&&this.options.values.length){b.value=this.values(c);b.values=this.values()}this._trigger("change",e,b)},value:function(b){if(arguments.length){this._setData("value",b);this._change(null,0)}return this._value()},values:function(b,f,c,e){if(arguments.length>1){this.options.values[b]=f;this._refreshValue(c);if(!e){this._change(null,b)}}if(arguments.length){if(this.options.values&&this.options.values.length){return this._values(b)}else{return this.value()}}else{return this._values()}},_setData:function(b,e,c){a.widget.prototype._setData.apply(this,arguments);switch(b){case"disabled":if(e){this.handles.filter(".ui-state-focus").blur();this.handles.removeClass("ui-state-hover");this.handles.attr("disabled","disabled")}else{this.handles.removeAttr("disabled")}case"orientation":this._detectOrientation();this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation);this._refreshValue(c);break;case"value":this._refreshValue(c);break}},_step:function(){var b=this.options.step;return b},_value:function(){var b=this.options.value;if(b<this._valueMin()){b=this._valueMin()}if(b>this._valueMax()){b=this._valueMax()}return b},_values:function(b){if(arguments.length){var c=this.options.values[b];if(c<this._valueMin()){c=this._valueMin()}if(c>this._valueMax()){c=this._valueMax()}return c}else{return this.options.values}},_valueMin:function(){var b=this.options.min;return b},_valueMax:function(){var b=this.options.max;return b},_refreshValue:function(c){var g=this.options.range,e=this.options,n=this;if(this.options.values&&this.options.values.length){var k,i;this.handles.each(function(t,r){var s=(n.values(t)-n._valueMin())/(n._valueMax()-n._valueMin())*100;var q={};q[n.orientation=="horizontal"?"left":"bottom"]=s+"%";a(this).stop(1,1)[c?"animate":"css"](q,e.animate);if(n.options.range===true){if(n.orientation=="horizontal"){(t==0)&&n.range.stop(1,1)[c?"animate":"css"]({left:s+"%"},e.animate);(t==1)&&n.range[c?"animate":"css"]({width:(s-lastValPercent)+"%"},{queue:false,duration:e.animate})}else{(t==0)&&n.range.stop(1,1)[c?"animate":"css"]({bottom:(s)+"%"},e.animate);(t==1)&&n.range[c?"animate":"css"]({height:(s-lastValPercent)+"%"},{queue:false,duration:e.animate})}}lastValPercent=s})}else{var l=this.value(),h=this._valueMin(),m=this._valueMax(),f=m!=h?(l-h)/(m-h)*100:0;var b={};b[n.orientation=="horizontal"?"left":"bottom"]=f+"%";this.handle.stop(1,1)[c?"animate":"css"](b,e.animate);(g=="min")&&(this.orientation=="horizontal")&&this.range.stop(1,1)[c?"animate":"css"]({width:f+"%"},e.animate);(g=="max")&&(this.orientation=="horizontal")&&this.range[c?"animate":"css"]({width:(100-f)+"%"},{queue:false,duration:e.animate});(g=="min")&&(this.orientation=="vertical")&&this.range.stop(1,1)[c?"animate":"css"]({height:f+"%"},e.animate);(g=="max")&&(this.orientation=="vertical")&&this.range[c?"animate":"css"]({height:(100-f)+"%"},{queue:false,duration:e.animate})}}}));a.extend(a.ui.slider,{getter:"value values",version:"1.7.3",eventPrefix:"slide",defaults:{animate:false,delay:0,distance:0,max:100,min:0,orientation:"horizontal",range:false,step:1,value:0,values:null}})})(jQuery);(function($){$.extend($.ui,{timepicker:{version:"0.9.9"}});function Timepicker(){this.regional=[];this.regional[""]={currentText:"Now",closeText:"Done",ampm:false,amNames:["AM","A"],pmNames:["PM","P"],timeFormat:"hh:mm tt",timeSuffix:"",timeOnlyTitle:"Choose Time",timeText:"Time",hourText:"Hour",minuteText:"Minute",secondText:"Second",millisecText:"Millisecond",timezoneText:"Time Zone"};this._defaults={showButtonPanel:true,timeOnly:false,showHour:true,showMinute:true,showSecond:false,showMillisec:false,showTimezone:false,showTime:true,stepHour:1,stepMinute:1,stepSecond:1,stepMillisec:1,hour:0,minute:0,second:0,millisec:0,timezone:"+0000",hourMin:0,minuteMin:0,secondMin:0,millisecMin:0,hourMax:23,minuteMax:59,secondMax:59,millisecMax:999,minDateTime:null,maxDateTime:null,onSelect:null,hourGrid:0,minuteGrid:0,secondGrid:0,millisecGrid:0,alwaysSetTime:true,separator:" ",altFieldTimeOnly:true,showTimepicker:true,timezoneIso8609:false,timezoneList:null,addSliderAccess:false,sliderAccessArgs:null};$.extend(this._defaults,this.regional[""])}$.extend(Timepicker.prototype,{$input:null,$altInput:null,$timeObj:null,inst:null,hour_slider:null,minute_slider:null,second_slider:null,millisec_slider:null,timezone_select:null,hour:0,minute:0,second:0,millisec:0,timezone:"+0000",hourMinOriginal:null,minuteMinOriginal:null,secondMinOriginal:null,millisecMinOriginal:null,hourMaxOriginal:null,minuteMaxOriginal:null,secondMaxOriginal:null,millisecMaxOriginal:null,ampm:"",formattedDate:"",formattedTime:"",formattedDateTime:"",timezoneList:null,setDefaults:function(settings){extendRemove(this._defaults,settings||{});return this},_newInst:function($input,o){var tp_inst=new Timepicker(),inlineSettings={};for(var attrName in this._defaults){var attrValue=$input.attr("time:"+attrName);if(attrValue){try{inlineSettings[attrName]=eval(attrValue)}catch(err){inlineSettings[attrName]=attrValue}}}tp_inst._defaults=$.extend({},this._defaults,inlineSettings,o,{beforeShow:function(input,dp_inst){if($.isFunction(o.beforeShow)){return o.beforeShow(input,dp_inst,tp_inst)}},onChangeMonthYear:function(year,month,dp_inst){tp_inst._updateDateTime(dp_inst);if($.isFunction(o.onChangeMonthYear)){o.onChangeMonthYear.call($input[0],year,month,dp_inst,tp_inst)}},onClose:function(dateText,dp_inst){if(tp_inst.timeDefined===true&&$input.val()!=""){tp_inst._updateDateTime(dp_inst)}if($.isFunction(o.onClose)){o.onClose.call($input[0],dateText,dp_inst,tp_inst)}},timepicker:tp_inst});tp_inst.amNames=$.map(tp_inst._defaults.amNames,function(val){return val.toUpperCase()});tp_inst.pmNames=$.map(tp_inst._defaults.pmNames,function(val){return val.toUpperCase()});if(tp_inst._defaults.timezoneList===null){var timezoneList=[];for(var i=-11;i<=12;i++){timezoneList.push((i>=0?"+":"-")+("0"+Math.abs(i).toString()).slice(-2)+"00")}if(tp_inst._defaults.timezoneIso8609){timezoneList=$.map(timezoneList,function(val){return val=="+0000"?"Z":(val.substring(0,3)+":"+val.substring(3))})}tp_inst._defaults.timezoneList=timezoneList}tp_inst.hour=tp_inst._defaults.hour;tp_inst.minute=tp_inst._defaults.minute;tp_inst.second=tp_inst._defaults.second;tp_inst.millisec=tp_inst._defaults.millisec;tp_inst.ampm="";tp_inst.$input=$input;if(o.altField){tp_inst.$altInput=$(o.altField).css({cursor:"pointer"}).focus(function(){$input.trigger("focus")})}if(tp_inst._defaults.minDate==0||tp_inst._defaults.minDateTime==0){tp_inst._defaults.minDate=new Date()}if(tp_inst._defaults.maxDate==0||tp_inst._defaults.maxDateTime==0){tp_inst._defaults.maxDate=new Date()}if(tp_inst._defaults.minDate!==undefined&&tp_inst._defaults.minDate instanceof Date){tp_inst._defaults.minDateTime=new Date(tp_inst._defaults.minDate.getTime())}if(tp_inst._defaults.minDateTime!==undefined&&tp_inst._defaults.minDateTime instanceof Date){tp_inst._defaults.minDate=new Date(tp_inst._defaults.minDateTime.getTime())}if(tp_inst._defaults.maxDate!==undefined&&tp_inst._defaults.maxDate instanceof Date){tp_inst._defaults.maxDateTime=new Date(tp_inst._defaults.maxDate.getTime())}if(tp_inst._defaults.maxDateTime!==undefined&&tp_inst._defaults.maxDateTime instanceof Date){tp_inst._defaults.maxDate=new Date(tp_inst._defaults.maxDateTime.getTime())}return tp_inst},_addTimePicker:function(dp_inst){var currDT=(this.$altInput&&this._defaults.altFieldTimeOnly)?this.$input.val()+" "+this.$altInput.val():this.$input.val();this.timeDefined=this._parseTime(currDT);this._limitMinMaxDateTime(dp_inst,false);this._injectTimePicker()},_parseTime:function(timeString,withDate){var regstr=this._defaults.timeFormat.toString().replace(/h{1,2}/ig,"(\\d?\\d)").replace(/m{1,2}/ig,"(\\d?\\d)").replace(/s{1,2}/ig,"(\\d?\\d)").replace(/l{1}/ig,"(\\d?\\d?\\d)").replace(/t{1,2}/ig,this._getPatternAmpm()).replace(/z{1}/ig,"(z|[-+]\\d\\d:?\\d\\d)?").replace(/\s/g,"\\s?")+this._defaults.timeSuffix+"$",order=this._getFormatPositions(),ampm="",treg;if(!this.inst){this.inst=$.datepicker._getInst(this.$input[0])}if(withDate||!this._defaults.timeOnly){var dp_dateFormat=$.datepicker._get(this.inst,"dateFormat");var specials=new RegExp("[.*+?|()\\[\\]{}\\\\]","g");regstr="^.{"+dp_dateFormat.length+",}?"+this._defaults.separator.replace(specials,"\\$&")+regstr}treg=timeString.match(new RegExp(regstr,"i"));if(treg){if(order.t!==-1){if(treg[order.t]===undefined||treg[order.t].length===0){ampm="";this.ampm=""}else{ampm=$.inArray(treg[order.t].toUpperCase(),this.amNames)!==-1?"AM":"PM";this.ampm=this._defaults[ampm=="AM"?"amNames":"pmNames"][0]}}if(order.h!==-1){if(ampm=="AM"&&treg[order.h]=="12"){this.hour=0}else{if(ampm=="PM"&&treg[order.h]!="12"){this.hour=(parseFloat(treg[order.h])+12).toFixed(0)}else{this.hour=Number(treg[order.h])}}}if(order.m!==-1){this.minute=Number(treg[order.m])}if(order.s!==-1){this.second=Number(treg[order.s])}if(order.l!==-1){this.millisec=Number(treg[order.l])}if(order.z!==-1&&treg[order.z]!==undefined){var tz=treg[order.z].toUpperCase();switch(tz.length){case 1:tz=this._defaults.timezoneIso8609?"Z":"+0000";break;case 5:if(this._defaults.timezoneIso8609){tz=tz.substring(1)=="0000"?"Z":tz.substring(0,3)+":"+tz.substring(3)}break;case 6:if(!this._defaults.timezoneIso8609){tz=tz=="Z"||tz.substring(1)=="00:00"?"+0000":tz.replace(/:/,"")}else{if(tz.substring(1)=="00:00"){tz="Z"}}break}this.timezone=tz}return true}return false},_getPatternAmpm:function(){var markers=[];o=this._defaults;if(o.amNames){$.merge(markers,o.amNames)}if(o.pmNames){$.merge(markers,o.pmNames)}markers=$.map(markers,function(val){return val.replace(/[.*+?|()\[\]{}\\]/g,"\\$&")});return"("+markers.join("|")+")?"},_getFormatPositions:function(){var finds=this._defaults.timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|t{1,2}|z)/g),orders={h:-1,m:-1,s:-1,l:-1,t:-1,z:-1};if(finds){for(var i=0;i<finds.length;i++){if(orders[finds[i].toString().charAt(0)]==-1){orders[finds[i].toString().charAt(0)]=i+1}}}return orders},_injectTimePicker:function(){var $dp=this.inst.dpDiv,o=this._defaults,tp_inst=this,hourMax=parseInt((o.hourMax-((o.hourMax-o.hourMin)%o.stepHour)),10),minMax=parseInt((o.minuteMax-((o.minuteMax-o.minuteMin)%o.stepMinute)),10),secMax=parseInt((o.secondMax-((o.secondMax-o.secondMin)%o.stepSecond)),10),millisecMax=parseInt((o.millisecMax-((o.millisecMax-o.millisecMin)%o.stepMillisec)),10),dp_id=this.inst.id.toString().replace(/([^A-Za-z0-9_])/g,"");if($dp.find("div#ui-timepicker-div-"+dp_id).length===0&&o.showTimepicker){var noDisplay=' style="display:none;"',html='<div class="ui-timepicker-div" id="ui-timepicker-div-'+dp_id+'"><dl><dt class="ui_tpicker_time_label" id="ui_tpicker_time_label_'+dp_id+'"'+((o.showTime)?"":noDisplay)+">"+o.timeText+'</dt><dd class="ui_tpicker_time" id="ui_tpicker_time_'+dp_id+'"'+((o.showTime)?"":noDisplay)+'></dd><dt class="ui_tpicker_hour_label" id="ui_tpicker_hour_label_'+dp_id+'"'+((o.showHour)?"":noDisplay)+">"+o.hourText+"</dt>",hourGridSize=0,minuteGridSize=0,secondGridSize=0,millisecGridSize=0,size;html+='<dd class="ui_tpicker_hour"><div id="ui_tpicker_hour_'+dp_id+'"'+((o.showHour)?"":noDisplay)+"></div>";if(o.showHour&&o.hourGrid>0){html+='<div style="padding-left: 1px"><table class="ui-tpicker-grid-label"><tr>';for(var h=o.hourMin;h<=hourMax;h+=parseInt(o.hourGrid,10)){hourGridSize++;var tmph=(o.ampm&&h>12)?h-12:h;if(tmph<10){tmph="0"+tmph}if(o.ampm){if(h==0){tmph=12+"a"}else{if(h<12){tmph+="a"}else{tmph+="p"}}}html+="<td>"+tmph+"</td>"}html+="</tr></table></div>"}html+="</dd>";html+='<dt class="ui_tpicker_minute_label" id="ui_tpicker_minute_label_'+dp_id+'"'+((o.showMinute)?"":noDisplay)+">"+o.minuteText+'</dt><dd class="ui_tpicker_minute"><div id="ui_tpicker_minute_'+dp_id+'"'+((o.showMinute)?"":noDisplay)+"></div>";if(o.showMinute&&o.minuteGrid>0){html+='<div style="padding-left: 1px"><table class="ui-tpicker-grid-label"><tr>';for(var m=o.minuteMin;m<=minMax;m+=parseInt(o.minuteGrid,10)){minuteGridSize++;html+="<td>"+((m<10)?"0":"")+m+"</td>"}html+="</tr></table></div>"}html+="</dd>";html+='<dt class="ui_tpicker_second_label" id="ui_tpicker_second_label_'+dp_id+'"'+((o.showSecond)?"":noDisplay)+">"+o.secondText+'</dt><dd class="ui_tpicker_second"><div id="ui_tpicker_second_'+dp_id+'"'+((o.showSecond)?"":noDisplay)+"></div>";if(o.showSecond&&o.secondGrid>0){html+='<div style="padding-left: 1px"><table><tr>';for(var s=o.secondMin;s<=secMax;s+=parseInt(o.secondGrid,10)){secondGridSize++;html+="<td>"+((s<10)?"0":"")+s+"</td>"}html+="</tr></table></div>"}html+="</dd>";html+='<dt class="ui_tpicker_millisec_label" id="ui_tpicker_millisec_label_'+dp_id+'"'+((o.showMillisec)?"":noDisplay)+">"+o.millisecText+'</dt><dd class="ui_tpicker_millisec"><div id="ui_tpicker_millisec_'+dp_id+'"'+((o.showMillisec)?"":noDisplay)+"></div>";if(o.showMillisec&&o.millisecGrid>0){html+='<div style="padding-left: 1px"><table><tr>';for(var l=o.millisecMin;l<=millisecMax;l+=parseInt(o.millisecGrid,10)){millisecGridSize++;html+="<td>"+((l<10)?"0":"")+l+"</td>"}html+="</tr></table></div>"}html+="</dd>";html+='<dt class="ui_tpicker_timezone_label" id="ui_tpicker_timezone_label_'+dp_id+'"'+((o.showTimezone)?"":noDisplay)+">"+o.timezoneText+"</dt>";html+='<dd class="ui_tpicker_timezone" id="ui_tpicker_timezone_'+dp_id+'"'+((o.showTimezone)?"":noDisplay)+"></dd>";html+="</dl></div>";$tp=$(html);if(o.timeOnly===true){$tp.prepend('<div class="ui-widget-header ui-helper-clearfix ui-corner-all"><div class="ui-datepicker-title">'+o.timeOnlyTitle+"</div></div>");$dp.find(".ui-datepicker-header, .ui-datepicker-calendar").hide()}this.hour_slider=$tp.find("#ui_tpicker_hour_"+dp_id).slider({orientation:"horizontal",value:this.hour,min:o.hourMin,max:hourMax,step:o.stepHour,slide:function(event,ui){tp_inst.hour_slider.slider("option","value",ui.value);tp_inst._onTimeChange()}});this.minute_slider=$tp.find("#ui_tpicker_minute_"+dp_id).slider({orientation:"horizontal",value:this.minute,min:o.minuteMin,max:minMax,step:o.stepMinute,slide:function(event,ui){tp_inst.minute_slider.slider("option","value",ui.value);tp_inst._onTimeChange()}});this.second_slider=$tp.find("#ui_tpicker_second_"+dp_id).slider({orientation:"horizontal",value:this.second,min:o.secondMin,max:secMax,step:o.stepSecond,slide:function(event,ui){tp_inst.second_slider.slider("option","value",ui.value);tp_inst._onTimeChange()}});this.millisec_slider=$tp.find("#ui_tpicker_millisec_"+dp_id).slider({orientation:"horizontal",value:this.millisec,min:o.millisecMin,max:millisecMax,step:o.stepMillisec,slide:function(event,ui){tp_inst.millisec_slider.slider("option","value",ui.value);tp_inst._onTimeChange()}});this.timezone_select=$tp.find("#ui_tpicker_timezone_"+dp_id).append("<select></select>").find("select");$.fn.append.apply(this.timezone_select,$.map(o.timezoneList,function(val,idx){return $("<option />").val(typeof val=="object"?val.value:val).text(typeof val=="object"?val.label:val)}));this.timezone_select.val((typeof this.timezone!="undefined"&&this.timezone!=null&&this.timezone!="")?this.timezone:o.timezone);this.timezone_select.change(function(){tp_inst._onTimeChange()});if(o.showHour&&o.hourGrid>0){size=100*hourGridSize*o.hourGrid/(hourMax-o.hourMin);$tp.find(".ui_tpicker_hour table").css({width:size+"%",marginLeft:(size/(-2*hourGridSize))+"%",borderCollapse:"collapse"}).find("td").each(function(index){$(this).click(function(){var h=$(this).html();if(o.ampm){var ap=h.substring(2).toLowerCase(),aph=parseInt(h.substring(0,2),10);if(ap=="a"){if(aph==12){h=0}else{h=aph}}else{if(aph==12){h=12}else{h=aph+12}}}tp_inst.hour_slider.slider("option","value",h);tp_inst._onTimeChange();tp_inst._onSelectHandler()}).css({cursor:"pointer",width:(100/hourGridSize)+"%",textAlign:"center",overflow:"hidden"})})}if(o.showMinute&&o.minuteGrid>0){size=100*minuteGridSize*o.minuteGrid/(minMax-o.minuteMin);$tp.find(".ui_tpicker_minute table").css({width:size+"%",marginLeft:(size/(-2*minuteGridSize))+"%",borderCollapse:"collapse"}).find("td").each(function(index){$(this).click(function(){tp_inst.minute_slider.slider("option","value",$(this).html());tp_inst._onTimeChange();tp_inst._onSelectHandler()}).css({cursor:"pointer",width:(100/minuteGridSize)+"%",textAlign:"center",overflow:"hidden"})})}if(o.showSecond&&o.secondGrid>0){$tp.find(".ui_tpicker_second table").css({width:size+"%",marginLeft:(size/(-2*secondGridSize))+"%",borderCollapse:"collapse"}).find("td").each(function(index){$(this).click(function(){tp_inst.second_slider.slider("option","value",$(this).html());tp_inst._onTimeChange();tp_inst._onSelectHandler()}).css({cursor:"pointer",width:(100/secondGridSize)+"%",textAlign:"center",overflow:"hidden"})})}if(o.showMillisec&&o.millisecGrid>0){$tp.find(".ui_tpicker_millisec table").css({width:size+"%",marginLeft:(size/(-2*millisecGridSize))+"%",borderCollapse:"collapse"}).find("td").each(function(index){$(this).click(function(){tp_inst.millisec_slider.slider("option","value",$(this).html());tp_inst._onTimeChange();tp_inst._onSelectHandler()}).css({cursor:"pointer",width:(100/millisecGridSize)+"%",textAlign:"center",overflow:"hidden"})})}var $buttonPanel=$dp.find(".ui-datepicker-buttonpane");if($buttonPanel.length){$buttonPanel.before($tp)}else{$dp.append($tp)}this.$timeObj=$tp.find("#ui_tpicker_time_"+dp_id);if(this.inst!==null){var timeDefined=this.timeDefined;this._onTimeChange();this.timeDefined=timeDefined}var onSelectDelegate=function(){tp_inst._onSelectHandler()};this.hour_slider.bind("slidestop",onSelectDelegate);this.minute_slider.bind("slidestop",onSelectDelegate);this.second_slider.bind("slidestop",onSelectDelegate);this.millisec_slider.bind("slidestop",onSelectDelegate);if(this._defaults.addSliderAccess){var sliderAccessArgs=this._defaults.sliderAccessArgs;setTimeout(function(){if($tp.find(".ui-slider-access").length==0){$tp.find(".ui-slider:visible").sliderAccess(sliderAccessArgs);var sliderAccessWidth=$tp.find(".ui-slider-access:eq(0)").outerWidth(true);if(sliderAccessWidth){$tp.find("table:visible").each(function(){var $g=$(this),oldWidth=$g.outerWidth(),oldMarginLeft=$g.css("marginLeft").toString().replace("%",""),newWidth=oldWidth-sliderAccessWidth,newMarginLeft=((oldMarginLeft*newWidth)/oldWidth)+"%";$g.css({width:newWidth,marginLeft:newMarginLeft})})}}},0)}}},_limitMinMaxDateTime:function(dp_inst,adjustSliders){var o=this._defaults,dp_date=new Date(dp_inst.selectedYear,dp_inst.selectedMonth,dp_inst.selectedDay);if(!this._defaults.showTimepicker){return}if($.datepicker._get(dp_inst,"minDateTime")!==null&&$.datepicker._get(dp_inst,"minDateTime")!==undefined&&dp_date){var minDateTime=$.datepicker._get(dp_inst,"minDateTime"),minDateTimeDate=new Date(minDateTime.getFullYear(),minDateTime.getMonth(),minDateTime.getDate(),0,0,0,0);if(this.hourMinOriginal===null||this.minuteMinOriginal===null||this.secondMinOriginal===null||this.millisecMinOriginal===null){this.hourMinOriginal=o.hourMin;this.minuteMinOriginal=o.minuteMin;this.secondMinOriginal=o.secondMin;this.millisecMinOriginal=o.millisecMin}if(dp_inst.settings.timeOnly||minDateTimeDate.getTime()==dp_date.getTime()){this._defaults.hourMin=minDateTime.getHours();if(this.hour<=this._defaults.hourMin){this.hour=this._defaults.hourMin;this._defaults.minuteMin=minDateTime.getMinutes();if(this.minute<=this._defaults.minuteMin){this.minute=this._defaults.minuteMin;this._defaults.secondMin=minDateTime.getSeconds()}else{if(this.second<=this._defaults.secondMin){this.second=this._defaults.secondMin;this._defaults.millisecMin=minDateTime.getMilliseconds()}else{if(this.millisec<this._defaults.millisecMin){this.millisec=this._defaults.millisecMin}this._defaults.millisecMin=this.millisecMinOriginal}}}else{this._defaults.minuteMin=this.minuteMinOriginal;this._defaults.secondMin=this.secondMinOriginal;this._defaults.millisecMin=this.millisecMinOriginal}}else{this._defaults.hourMin=this.hourMinOriginal;this._defaults.minuteMin=this.minuteMinOriginal;this._defaults.secondMin=this.secondMinOriginal;this._defaults.millisecMin=this.millisecMinOriginal}}if($.datepicker._get(dp_inst,"maxDateTime")!==null&&$.datepicker._get(dp_inst,"maxDateTime")!==undefined&&dp_date){var maxDateTime=$.datepicker._get(dp_inst,"maxDateTime"),maxDateTimeDate=new Date(maxDateTime.getFullYear(),maxDateTime.getMonth(),maxDateTime.getDate(),0,0,0,0);if(this.hourMaxOriginal===null||this.minuteMaxOriginal===null||this.secondMaxOriginal===null){this.hourMaxOriginal=o.hourMax;this.minuteMaxOriginal=o.minuteMax;this.secondMaxOriginal=o.secondMax;this.millisecMaxOriginal=o.millisecMax}if(dp_inst.settings.timeOnly||maxDateTimeDate.getTime()==dp_date.getTime()){this._defaults.hourMax=maxDateTime.getHours();if(this.hour>=this._defaults.hourMax){this.hour=this._defaults.hourMax;this._defaults.minuteMax=maxDateTime.getMinutes();if(this.minute>=this._defaults.minuteMax){this.minute=this._defaults.minuteMax;this._defaults.secondMax=maxDateTime.getSeconds()}else{if(this.second>=this._defaults.secondMax){this.second=this._defaults.secondMax;this._defaults.millisecMax=maxDateTime.getMilliseconds()}else{if(this.millisec>this._defaults.millisecMax){this.millisec=this._defaults.millisecMax}this._defaults.millisecMax=this.millisecMaxOriginal}}}else{this._defaults.minuteMax=this.minuteMaxOriginal;this._defaults.secondMax=this.secondMaxOriginal;this._defaults.millisecMax=this.millisecMaxOriginal}}else{this._defaults.hourMax=this.hourMaxOriginal;this._defaults.minuteMax=this.minuteMaxOriginal;this._defaults.secondMax=this.secondMaxOriginal;this._defaults.millisecMax=this.millisecMaxOriginal}}if(adjustSliders!==undefined&&adjustSliders===true){var hourMax=parseInt((this._defaults.hourMax-((this._defaults.hourMax-this._defaults.hourMin)%this._defaults.stepHour)),10),minMax=parseInt((this._defaults.minuteMax-((this._defaults.minuteMax-this._defaults.minuteMin)%this._defaults.stepMinute)),10),secMax=parseInt((this._defaults.secondMax-((this._defaults.secondMax-this._defaults.secondMin)%this._defaults.stepSecond)),10),millisecMax=parseInt((this._defaults.millisecMax-((this._defaults.millisecMax-this._defaults.millisecMin)%this._defaults.stepMillisec)),10);if(this.hour_slider){this.hour_slider.slider("option",{min:this._defaults.hourMin,max:hourMax}).slider("value",this.hour)}if(this.minute_slider){this.minute_slider.slider("option",{min:this._defaults.minuteMin,max:minMax}).slider("value",this.minute)}if(this.second_slider){this.second_slider.slider("option",{min:this._defaults.secondMin,max:secMax}).slider("value",this.second)}if(this.millisec_slider){this.millisec_slider.slider("option",{min:this._defaults.millisecMin,max:millisecMax}).slider("value",this.millisec)}}},_onTimeChange:function(){var hour=(this.hour_slider)?this.hour_slider.slider("value"):false,minute=(this.minute_slider)?this.minute_slider.slider("value"):false,second=(this.second_slider)?this.second_slider.slider("value"):false,millisec=(this.millisec_slider)?this.millisec_slider.slider("value"):false,timezone=(this.timezone_select)?this.timezone_select.val():false,o=this._defaults;if(typeof(hour)=="object"){hour=false}if(typeof(minute)=="object"){minute=false}if(typeof(second)=="object"){second=false}if(typeof(millisec)=="object"){millisec=false}if(typeof(timezone)=="object"){timezone=false}if(hour!==false){hour=parseInt(hour,10)}if(minute!==false){minute=parseInt(minute,10)}if(second!==false){second=parseInt(second,10)}if(millisec!==false){millisec=parseInt(millisec,10)}var ampm=o[hour<12?"amNames":"pmNames"][0];var hasChanged=(hour!=this.hour||minute!=this.minute||second!=this.second||millisec!=this.millisec||(this.ampm.length>0&&(hour<12)!=($.inArray(this.ampm.toUpperCase(),this.amNames)!==-1))||timezone!=this.timezone);if(hasChanged){if(hour!==false){this.hour=hour}if(minute!==false){this.minute=minute}if(second!==false){this.second=second}if(millisec!==false){this.millisec=millisec}if(timezone!==false){this.timezone=timezone}if(!this.inst){this.inst=$.datepicker._getInst(this.$input[0])}this._limitMinMaxDateTime(this.inst,true)}if(o.ampm){this.ampm=ampm}this.formattedTime=$.datepicker.formatTime(this._defaults.timeFormat,this,this._defaults);if(this.$timeObj){this.$timeObj.text(this.formattedTime+o.timeSuffix)}this.timeDefined=true;if(hasChanged){this._updateDateTime()}},_onSelectHandler:function(){var onSelect=this._defaults.onSelect;var inputEl=this.$input?this.$input[0]:null;if(onSelect&&inputEl){onSelect.apply(inputEl,[this.formattedDateTime,this])}},_formatTime:function(time,format){time=time||{hour:this.hour,minute:this.minute,second:this.second,millisec:this.millisec,ampm:this.ampm,timezone:this.timezone};var tmptime=(format||this._defaults.timeFormat).toString();tmptime=$.datepicker.formatTime(tmptime,time,this._defaults);if(arguments.length){return tmptime}else{this.formattedTime=tmptime}},_updateDateTime:function(dp_inst){dp_inst=this.inst||dp_inst;var dt=$.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear,dp_inst.selectedMonth,dp_inst.selectedDay)),dateFmt=$.datepicker._get(dp_inst,"dateFormat"),formatCfg=$.datepicker._getFormatConfig(dp_inst),timeAvailable=dt!==null&&this.timeDefined;this.formattedDate=$.datepicker.formatDate(dateFmt,(dt===null?new Date():dt),formatCfg);var formattedDateTime=this.formattedDate;if(dp_inst.lastVal!==undefined&&(dp_inst.lastVal.length>0&&this.$input.val().length===0)){return}if(this._defaults.timeOnly===true){formattedDateTime=this.formattedTime}else{if(this._defaults.timeOnly!==true&&(this._defaults.alwaysSetTime||timeAvailable)){formattedDateTime+=this._defaults.separator+this.formattedTime+this._defaults.timeSuffix}}this.formattedDateTime=formattedDateTime;if(!this._defaults.showTimepicker){this.$input.val(this.formattedDate)}else{if(this.$altInput&&this._defaults.altFieldTimeOnly===true){this.$altInput.val(this.formattedTime);this.$input.val(this.formattedDate)}else{if(this.$altInput){this.$altInput.val(formattedDateTime);this.$input.val(formattedDateTime)}else{this.$input.val(formattedDateTime)}}}this.$input.trigger("change")}});$.fn.extend({timepicker:function(o){o=o||{};var tmp_args=arguments;if(typeof o=="object"){tmp_args[0]=$.extend(o,{timeOnly:true})}return $(this).each(function(){$.fn.datetimepicker.apply($(this),tmp_args)})},datetimepicker:function(o){o=o||{};var $input=this,tmp_args=arguments;if(typeof(o)=="string"){if(o=="getDate"){return $.fn.datepicker.apply($(this[0]),tmp_args)}else{return this.each(function(){var $t=$(this);$t.datepicker.apply($t,tmp_args)})}}else{return this.each(function(){var $t=$(this);$t.datepicker($.timepicker._newInst($t,o)._defaults)})}}});$.datepicker.formatTime=function(format,time,options){options=options||{};options=$.extend($.timepicker._defaults,options);time=$.extend({hour:0,minute:0,second:0,millisec:0,timezone:"+0000"},time);var tmptime=format;var ampmName=options.amNames[0];var hour=parseInt(time.hour,10);if(options.ampm){if(hour>11){ampmName=options.pmNames[0];if(hour>12){hour=hour%12}}if(hour===0){hour=12}}tmptime=tmptime.replace(/(?:hh?|mm?|ss?|[tT]{1,2}|[lz])/g,function(match){switch(match.toLowerCase()){case"hh":return("0"+hour).slice(-2);case"h":return hour;case"mm":return("0"+time.minute).slice(-2);case"m":return time.minute;case"ss":return("0"+time.second).slice(-2);case"s":return time.second;case"l":return("00"+time.millisec).slice(-3);case"z":return time.timezone;case"t":case"tt":if(options.ampm){if(match.length==1){ampmName=ampmName.charAt(0)}return match.charAt(0)=="T"?ampmName.toUpperCase():ampmName.toLowerCase()}return""}});tmptime=$.trim(tmptime);return tmptime};$.datepicker._base_selectDate=$.datepicker._selectDate;$.datepicker._selectDate=function(id,dateStr){var inst=this._getInst($(id)[0]),tp_inst=this._get(inst,"timepicker");if(tp_inst){tp_inst._limitMinMaxDateTime(inst,true);inst.inline=inst.stay_open=true;this._base_selectDate(id,dateStr);inst.inline=inst.stay_open=false;this._notifyChange(inst);this._updateDatepicker(inst)}else{this._base_selectDate(id,dateStr)}};$.datepicker._base_updateDatepicker=$.datepicker._updateDatepicker;$.datepicker._updateDatepicker=function(inst){var input=inst.input[0];if($.datepicker._curInst&&$.datepicker._curInst!=inst&&$.datepicker._datepickerShowing&&$.datepicker._lastInput!=input){return}if(typeof(inst.stay_open)!=="boolean"||inst.stay_open===false){this._base_updateDatepicker(inst);var tp_inst=this._get(inst,"timepicker");if(tp_inst){tp_inst._addTimePicker(inst)}}};$.datepicker._base_doKeyPress=$.datepicker._doKeyPress;$.datepicker._doKeyPress=function(event){var inst=$.datepicker._getInst(event.target),tp_inst=$.datepicker._get(inst,"timepicker");if(tp_inst){if($.datepicker._get(inst,"constrainInput")){var ampm=tp_inst._defaults.ampm,dateChars=$.datepicker._possibleChars($.datepicker._get(inst,"dateFormat")),datetimeChars=tp_inst._defaults.timeFormat.toString().replace(/[hms]/g,"").replace(/TT/g,ampm?"APM":"").replace(/Tt/g,ampm?"AaPpMm":"").replace(/tT/g,ampm?"AaPpMm":"").replace(/T/g,ampm?"AP":"").replace(/tt/g,ampm?"apm":"").replace(/t/g,ampm?"ap":"")+" "+tp_inst._defaults.separator+tp_inst._defaults.timeSuffix+(tp_inst._defaults.showTimezone?tp_inst._defaults.timezoneList.join(""):"")+(tp_inst._defaults.amNames.join(""))+(tp_inst._defaults.pmNames.join(""))+dateChars,chr=String.fromCharCode(event.charCode===undefined?event.keyCode:event.charCode);return event.ctrlKey||(chr<" "||!dateChars||datetimeChars.indexOf(chr)>-1)}}return $.datepicker._base_doKeyPress(event)};$.datepicker._base_doKeyUp=$.datepicker._doKeyUp;$.datepicker._doKeyUp=function(event){var inst=$.datepicker._getInst(event.target),tp_inst=$.datepicker._get(inst,"timepicker");if(tp_inst){if(tp_inst._defaults.timeOnly&&(inst.input.val()!=inst.lastVal)){try{$.datepicker._updateDatepicker(inst)}catch(err){$.datepicker.log(err)}}}return $.datepicker._base_doKeyUp(event)};$.datepicker._base_gotoToday=$.datepicker._gotoToday;$.datepicker._gotoToday=function(id){var inst=this._getInst($(id)[0]),$dp=inst.dpDiv;this._base_gotoToday(id);var now=new Date();var tp_inst=this._get(inst,"timepicker");if(tp_inst&&tp_inst._defaults.showTimezone&&tp_inst.timezone_select){var tzoffset=now.getTimezoneOffset();var tzsign=tzoffset>0?"-":"+";tzoffset=Math.abs(tzoffset);var tzmin=tzoffset%60;tzoffset=tzsign+("0"+(tzoffset-tzmin)/60).slice(-2)+("0"+tzmin).slice(-2);if(tp_inst._defaults.timezoneIso8609){tzoffset=tzoffset.substring(0,3)+":"+tzoffset.substring(3)}tp_inst.timezone_select.val(tzoffset)}this._setTime(inst,now);$(".ui-datepicker-today",$dp).click()};$.datepicker._disableTimepickerDatepicker=function(target,date,withDate){var inst=this._getInst(target),tp_inst=this._get(inst,"timepicker");$(target).datepicker("getDate");if(tp_inst){tp_inst._defaults.showTimepicker=false;tp_inst._updateDateTime(inst)}};$.datepicker._enableTimepickerDatepicker=function(target,date,withDate){var inst=this._getInst(target),tp_inst=this._get(inst,"timepicker");$(target).datepicker("getDate");if(tp_inst){tp_inst._defaults.showTimepicker=true;tp_inst._addTimePicker(inst);tp_inst._updateDateTime(inst)}};$.datepicker._setTime=function(inst,date){var tp_inst=this._get(inst,"timepicker");if(tp_inst){var defaults=tp_inst._defaults,hour=date?date.getHours():defaults.hour,minute=date?date.getMinutes():defaults.minute,second=date?date.getSeconds():defaults.second,millisec=date?date.getMilliseconds():defaults.millisec;if((hour<defaults.hourMin||hour>defaults.hourMax)||(minute<defaults.minuteMin||minute>defaults.minuteMax)||(second<defaults.secondMin||second>defaults.secondMax)||(millisec<defaults.millisecMin||millisec>defaults.millisecMax)){hour=defaults.hourMin;minute=defaults.minuteMin;second=defaults.secondMin;millisec=defaults.millisecMin}tp_inst.hour=hour;tp_inst.minute=minute;tp_inst.second=second;tp_inst.millisec=millisec;if(tp_inst.hour_slider){tp_inst.hour_slider.slider("value",hour)}if(tp_inst.minute_slider){tp_inst.minute_slider.slider("value",minute)}if(tp_inst.second_slider){tp_inst.second_slider.slider("value",second)}if(tp_inst.millisec_slider){tp_inst.millisec_slider.slider("value",millisec)}tp_inst._onTimeChange();tp_inst._updateDateTime(inst)}};$.datepicker._setTimeDatepicker=function(target,date,withDate){var inst=this._getInst(target),tp_inst=this._get(inst,"timepicker");if(tp_inst){this._setDateFromField(inst);var tp_date;if(date){if(typeof date=="string"){tp_inst._parseTime(date,withDate);tp_date=new Date();tp_date.setHours(tp_inst.hour,tp_inst.minute,tp_inst.second,tp_inst.millisec)}else{tp_date=new Date(date.getTime())}if(tp_date.toString()=="Invalid Date"){tp_date=undefined}this._setTime(inst,tp_date)}}};$.datepicker._base_setDateDatepicker=$.datepicker._setDateDatepicker;$.datepicker._setDateDatepicker=function(target,date){var inst=this._getInst(target),tp_date=(date instanceof Date)?new Date(date.getTime()):date;this._updateDatepicker(inst);this._base_setDateDatepicker.apply(this,arguments);this._setTimeDatepicker(target,tp_date,true)};$.datepicker._base_getDateDatepicker=$.datepicker._getDateDatepicker;$.datepicker._getDateDatepicker=function(target,noDefault){var inst=this._getInst(target),tp_inst=this._get(inst,"timepicker");if(tp_inst){this._setDateFromField(inst,noDefault);var date=this._getDate(inst);if(date&&tp_inst._parseTime($(target).val(),tp_inst.timeOnly)){date.setHours(tp_inst.hour,tp_inst.minute,tp_inst.second,tp_inst.millisec)}return date}return this._base_getDateDatepicker(target,noDefault)};$.datepicker._base_parseDate=$.datepicker.parseDate;$.datepicker.parseDate=function(format,value,settings){var date;try{date=this._base_parseDate(format,value,settings)}catch(err){if(err.indexOf(":")>=0){date=this._base_parseDate(format,value.substring(0,value.length-(err.length-err.indexOf(":")-2)),settings)}else{throw err}}return date};$.datepicker._base_formatDate=$.datepicker._formatDate;$.datepicker._formatDate=function(inst,day,month,year){var tp_inst=this._get(inst,"timepicker");if(tp_inst){if(day){var b=this._base_formatDate(inst,day,month,year)}tp_inst._updateDateTime(inst);return tp_inst.$input.val()}return this._base_formatDate(inst)};$.datepicker._base_optionDatepicker=$.datepicker._optionDatepicker;$.datepicker._optionDatepicker=function(target,name,value){var inst=this._getInst(target),tp_inst=this._get(inst,"timepicker");if(tp_inst){var min,max,onselect;if(typeof name=="string"){if(name==="minDate"||name==="minDateTime"){min=value}else{if(name==="maxDate"||name==="maxDateTime"){max=value}else{if(name==="onSelect"){onselect=value}}}}else{if(typeof name=="object"){if(name.minDate){min=name.minDate}else{if(name.minDateTime){min=name.minDateTime}else{if(name.maxDate){max=name.maxDate}else{if(name.maxDateTime){max=name.maxDateTime}}}}}}if(min){if(min==0){min=new Date()}else{min=new Date(min)}tp_inst._defaults.minDate=min;tp_inst._defaults.minDateTime=min}else{if(max){if(max==0){max=new Date()}else{max=new Date(max)}tp_inst._defaults.maxDate=max;tp_inst._defaults.maxDateTime=max}else{if(onselect){tp_inst._defaults.onSelect=onselect}}}}if(value===undefined){return this._base_optionDatepicker(target,name)}return this._base_optionDatepicker(target,name,value)};function extendRemove(target,props){$.extend(target,props);for(var name in props){if(props[name]===null||props[name]===undefined){target[name]=props[name]}}return target}$.timepicker=new Timepicker();$.timepicker.version="0.9.9"})(jQuery);(function(a){if(a.datepicker){a.datepicker.dpDiv.hide();a.datepicker.regional["zh-CN"]={showAnim:"slideDown",changeYear:true,showButtonPanel:true,closeText:"确定",clearText:"清除",prevText:"&#x3c;上月",nextText:"下月&#x3e;",currentText:"今天",monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthNamesShort:["一","二","三","四","五","六","七","八","九","十","十一","十二"],dayNames:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],dayNamesShort:["周日","周一","周二","周三","周四","周五","周六"],dayNamesMin:["日","一","二","三","四","五","六"],weekHeader:"周",dateFormat:"yy-mm-dd",firstDay:1,isRTL:false,showMonthAfterYear:true,yearSuffix:"年"};a.datepicker.setDefaults(a.datepicker.regional["zh-CN"])}if(a.timepicker){a.timepicker.regional["zh-CN"]={currentText:"现在",closeText:"确定",ampm:false,amNames:["上午","A"],pmNames:["下午","P"],timeFormat:"hh:mm tt",timeSuffix:"",timeOnlyTitle:"选择时间",timeText:"时间",hourText:"时",minuteText:"分",secondText:"秒",millisecText:"毫秒",timezoneText:"时区"};a.timepicker.setDefaults(a.timepicker.regional["zh-CN"])}})(jQuery);var qq=qq||{};qq.extend=function(b,a){return $.extend(true,b,a)};qq.indexOf=function(b,c,e){if(b.indexOf){return b.indexOf(c,e)}e=e||0;var a=b.length;if(e<0){e+=a}for(;e<a;e++){if(e in b&&b[e]===c){return e}}return -1};qq.getUniqueId=(function(){var a=0;return function(){return a++}})();qq.ie=function(){return navigator.userAgent.indexOf("MSIE")!=-1};qq.safari=function(){return navigator.vendor!=undefined&&navigator.vendor.indexOf("Apple")!=-1};qq.chrome=function(){return navigator.vendor!=undefined&&navigator.vendor.indexOf("Google")!=-1};qq.firefox=function(){return(navigator.userAgent.indexOf("Mozilla")!=-1&&navigator.vendor!=undefined&&navigator.vendor=="")};qq.windows=function(){return navigator.platform=="Win32"};qq.attach=function(a,c,b){if(a.addEventListener){a.addEventListener(c,b,false)}else{if(a.attachEvent){a.attachEvent("on"+c,b)}}return function(){qq.detach(a,c,b)}};qq.detach=function(a,c,b){if(a.removeEventListener){a.removeEventListener(c,b,false)}else{if(a.attachEvent){a.detachEvent("on"+c,b)}}};qq.preventDefault=function(a){if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}};qq.insertBefore=function(e,c){c.parentNode.insertBefore(e,c)};qq.remove=function(a){a.parentNode.removeChild(a)};qq.contains=function(b,a){if(b==a){return true}if(b.contains){return b.contains(a)}else{return !!(a.compareDocumentPosition(b)&8)}};qq.toElement=(function(){var a=document.createElement("div");return function(c){a.innerHTML=c;var b=a.firstChild;a.removeChild(b);return b}})();qq.css=function(a,b){if(b.opacity!=null){if(typeof a.style.opacity!="string"&&typeof(a.filters)!="undefined"){b.filter="alpha(opacity="+Math.round(100*b.opacity)+")"}}qq.extend(a.style,b)};qq.hasClass=function(b,a){var c=new RegExp("(^| )"+a+"( |$)");return c.test(b.className)};qq.addClass=function(b,a){if(!qq.hasClass(b,a)){b.className+=" "+a}};qq.removeClass=function(b,a){var c=new RegExp("(^| )"+a+"( |$)");b.className=b.className.replace(c," ").replace(/^\s+|\s+$/g,"")};qq.setText=function(a,b){a.innerText=b;a.textContent=b};qq.children=function(b){var a=[],c=b.firstChild;while(c){if(c.nodeType==1){a.push(c)}c=c.nextSibling}return a};qq.getByClass=function(e,f){if(e.querySelectorAll){return e.querySelectorAll("."+f)}var b=[];var g=e.getElementsByTagName("*");var a=g.length;for(var c=0;c<a;c++){if(qq.hasClass(g[c],f)){b.push(g[c])}}return b};qq.obj2url=function(g,b,k){var h=[],e="&",f=function(m,l){var n=b?(/\[\]$/.test(b))?b:b+"["+l+"]":l;if((n!="undefined")&&(l!="undefined")){h.push((typeof m==="object")?qq.obj2url(m,n,true):(Object.prototype.toString.call(m)==="[object Function]")?encodeURIComponent(n)+"="+encodeURIComponent(m()):encodeURIComponent(n)+"="+encodeURIComponent(m))}};if(!k&&b){e=(/\?/.test(b))?(/\?$/.test(b))?"":"&":"?";h.push(b);h.push(qq.obj2url(g))}else{if((Object.prototype.toString.call(g)==="[object Array]")&&(typeof g!="undefined")){for(var c=0,a=g.length;c<a;++c){f(g[c],c)}}else{if((typeof g!="undefined")&&(g!==null)&&(typeof g==="object")){for(var c in g){f(g[c],c)}}else{h.push(encodeURIComponent(b)+"="+encodeURIComponent(g))}}}return h.join(e).replace(/^&/,"").replace(/%20/g,"+")};var qq=qq||{};qq.FileUploaderBasic=function(b){var a=this;this._options={debug:false,_loaded:{},customList:false,action:jv.url().root+"Res/FileUploader/FileUploader.ashx",params:{},customHeaders:{},button:null,multiple:true,maxFile:3,disableCancelForFormUploads:false,autoUpload:true,forceMultipart:false,allowedExtensions:[],acceptFiles:null,sizeLimit:0,minSizeLimit:0,stopOnFirstInvalidFile:true,onSubmit:function(e,c){},onComplete:function(f,e,c){},onCancel:function(e,c){},onUpload:function(f,e,c){},onProgress:function(g,f,c,e){},onError:function(f,e,c){},messages:{typeError:"{file} 具有非法的扩展名. 只允许: {extensions}",sizeError:"{file} 文件太大, 最大限值: {sizeLimit}",minSizeError:"{file} 文件太小, 最小限值: {minSizeLimit}",emptyError:"{file} 文件为空, 请另行选择",onLeave:"文件正在上传,现在退出会取消上传.",maxFile:"已超出文件限额,最多只能上传 {maxFile} 个",noFilesError:"No files to upload."},showMessage:function(c){alert(c)},inputName:"qqfile"};qq.extend(this._options,b);this._wrapCallbacks();qq.extend(this,qq.DisposeSupport);this._filesInProgress=0;this._storedFileIds=[];this._handler=this._createUploadHandler();this._remove=function(e){var c=$("li[dbid="+e+"]",this._listElement).attr("qqfileid");if(c){if(this._handler._files){this._handler._files.removeAt(c);$("li:eq("+c+")",this._listElement).remove()}if(this._handler._queue){this._handler._queue.remove(c)}if(this._options._loaded){delete this._options._loaded[c]}if(this._handler._params){delete this._handler._params[c];var f=c.toString();if(f.indexOf("qq-upload-handler-iframe")>=0){f=f.slice("qq-upload-handler-iframe".length)}$("li:eq("+f+")",this._listElement).remove()}}if(e){$("li[dbid="+e+"]",this._listElement).remove();if(this._options._loaded){delete this._options._loaded[e]}}};if(this._options.button){this._button=this._createUploadButton(this._options.button)}this._preventLeaveInProgress()};qq.FileUploaderBasic.prototype={log:function(a){if(this._options.debug&&window.console){console.log("[uploader] "+a)}},setParams:function(a){this._options.params=a},getInProgress:function(){return this._filesInProgress},uploadStoredFiles:function(){while(this._storedFileIds.length){this._filesInProgress++;this._handler.upload(this._storedFileIds.shift(),this._options.params)}},clearStoredFiles:function(){this._storedFileIds=[]},_createUploadButton:function(c){var a=this;var b=new qq.UploadButton({element:c,multiple:this._options.multiple&&qq.UploadHandlerXhr.isSupported(),acceptFiles:this._options.acceptFiles,onChange:function(e){a._onInputChange(e)}});if(this._options.css){$(b._element).css(this._options.css)}this.addDisposer(function(){b.dispose()});return b},_createUploadHandler:function(){var a=this,c;if(qq.UploadHandlerXhr.isSupported()){c="UploadHandlerXhr"}else{c="UploadHandlerForm"}var b=new qq[c]({debug:this._options.debug,sizeLimit:this._options.sizeLimit,action:this._options.action,forceMultipart:this._options.forceMultipart,maxFile:this._options.maxFile,customHeaders:this._options.customHeaders,inputName:this._options.inputName,demoMode:this._options.demoMode,onProgress:function(h,g,e,f){a._onProgress(h,g,e,f);a._options.onProgress(h,g,e,f)},onComplete:function(g,f,e){a._onComplete(g,f,e);a._options.onComplete(g,f,e)},onCancel:function(f,e){a._onCancel(f,e);a._options.onCancel(f,e)},onError:a._options.onError,onUpload:function(g,f,e){a._onUpload(g,f,e);a._options.onUpload(g,f,e)}});return b},_preventLeaveInProgress:function(){var a=this;this._attach(window,"beforeunload",function(b){if(!a._filesInProgress){return}var b=b||window.event;b.returnValue=a._options.messages.onLeave;return a._options.messages.onLeave})},_onSubmit:function(b,a){if(this._options.autoUpload){this._filesInProgress++}},_onProgress:function(e,c,a,b){},_onComplete:function(e,c,b){this._filesInProgress--;if(!b.success){var a=b.error?b.error:"Upload failure reason unknown";this._options.onError(e,c,a)}},_onCancel:function(c,b){var a=qq.indexOf(this._storedFileIds,c);if(this._options.autoUpload||a<0){this._filesInProgress--}else{if(!this._options.autoUpload){this._storedFileIds.splice(a,1)}}},_onUpload:function(c,b,a){},_onInputChange:function(a){var b=this._options&&this._options._loaded&&jv.GetJsonKeys(this._options._loaded).length;if((a.files?a.files.length:1)+b>this._options.maxFile){this._error("maxFile");return}if(this._handler instanceof qq.UploadHandlerXhr){this._uploadFileList(a.files)}else{if(this._validateFile(a)){this._uploadFile(a)}}this._button.reset()},_uploadFileList:function(b){if(b.length>0){for(var a=0;a<b.length;a++){if(this._validateFile(b[a])){this._uploadFile(b[a])}else{if(this._options.stopOnFirstInvalidFile){return}}}}else{this._error("noFilesError","")}},_uploadFile:function(a){var c=this._handler.add(a);var b=this._handler.getName(c);if(this._options.onSubmit(c,b)!==false){this._onSubmit(c,b);if(this._options.autoUpload){this._handler.upload(c,this._options.params)}else{this._storeFileForLater(c)}}},_storeFileForLater:function(a){this._storedFileIds.push(a)},_validateFile:function(c){var a,b;if(c.value){a=c.value.replace(/.*(\/|\\)/,"")}else{a=(c.fileName!==null&&c.fileName!==undefined)?c.fileName:c.name;b=(c.fileSize!==null&&c.fileSize!==undefined)?c.fileSize:c.size}if(!this._isAllowedExtension(a)){this._error("typeError",a);return false}else{if(b===0){this._error("emptyError",a);return false}else{if(b&&this._options.sizeLimit&&b>this._options.sizeLimit){this._error("sizeError",a);return false}else{if(b&&b<this._options.minSizeLimit){this._error("minSizeError",a);return false}}}}return true},_error:function(e,f){var c=this._options.messages[e];function b(g,h){if(!g){return c}c=c.replace(g,h)}var a=this._options.allowedExtensions.join(", ");b("{file}",this._formatFileName(f));b("{extensions}",a);b("{sizeLimit}",this._formatSize(this._options.sizeLimit));b("{minSizeLimit}",this._formatSize(this._options.minSizeLimit));b("{maxFile}",this._formatFileName(this._options.maxFile));this._options.onError(null,f,c);this._options.showMessage(c)},_formatFileName:function(a){if(!a){return""}if(a.length>33){a=a.slice(0,19)+"..."+a.slice(-13)}return a},_isAllowedExtension:function(e){var b=(-1!==e.indexOf("."))?e.replace(/.*[.]/,"").toLowerCase():"";var c=this._options.allowedExtensions;if(!c.length){return true}for(var a=0;a<c.length;a++){if(c[a].toLowerCase()==b){return true}}return false},_formatSize:function(a){var b=-1;do{a=a/1024;b++}while(a>99);return Math.max(a,0.1).toFixed(1)+["kB","MB","GB","TB","PB","EB"][b]},_wrapCallbacks:function(){var a,b;a=this;b=function(g,e){try{return g.apply(a,e)}catch(f){a.log("Caught "+f+" in callback: "+g)}};for(var c in this._options){if(/^on[A-Z]/.test(c)){(function(){var e=a._options[c];a._options[c]=function(){return b(e,arguments)}}())}}}};qq.FileUploader=function(e){qq.FileUploaderBasic.apply(this,arguments);qq.extend(this._options,{element:null,listElement:null,dragText:"拖拽上传",extraDropzones:[],hideDropzones:true,disableDefaultDropzone:false,uploadButtonText:"上传",cancelButtonText:"取消",failUploadText:"上传失败",template:'<div class="qq-uploader">'+(!this._options.disableDefaultDropzone?'<div class="qq-upload-drop-area"><span>{dragText}</span></div>':"")+(!this._options.button?'<div class="qq-upload-button">{uploadButtonText}</div>':"")+(!this._options.listElement?'<ul class="qq-upload-list"></ul>':"")+"</div>",fileTemplate:'<li><div class="qq-progress-bar"></div><span class="qq-upload-spinner"></span><span class="qq-upload-finished"></span><span class="qq-upload-file"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">{cancelButtonText}</a><span class="qq-upload-failed-text">{failUploadtext}</span></li>',classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",dropDisabled:"qq-upload-drop-area-disabled",list:"qq-upload-list",progressBar:"qq-progress-bar",file:"qq-upload-file",spinner:"qq-upload-spinner",finished:"qq-upload-finished",size:"qq-upload-size",cancel:"qq-upload-cancel",failText:"qq-upload-failed-text",success:"qq-upload-success",fail:"qq-upload-fail",successIcon:null,failIcon:null},extraMessages:{formatProgress:"{percent}% of {total_size}",tooManyFilesError:"You may only drop one file"},failedUploadTextDisplay:{mode:"default",maxChars:50,responseProperty:"error",enableTooltip:true}});qq.extend(this._options,e);this._wrapCallbacks();qq.extend(this._options.messages,this._options.extraMessages);this._options.template=this._options.template.replace(/\{dragText\}/g,this._options.dragText);this._options.template=this._options.template.replace(/\{uploadButtonText\}/g,this._options.uploadButtonText);this._options.fileTemplate=this._options.fileTemplate.replace(/\{cancelButtonText\}/g,this._options.cancelButtonText);this._options.fileTemplate=this._options.fileTemplate.replace(/\{failUploadtext\}/g,this._options.failUploadText);this._element=this._options.element;this._element.innerHTML=this._options.template;this._listElement=this._options.listElement||this._find(this._element,"list");this._classes=this._options.classes;if(!this._button){this._button=this._createUploadButton(this._find(this._element,"button"))}this._bindCancelEvent();this._setupDragDrop();this._options._loaded={};if(this._options.data){for(var b=0,a=this._options.data.length;b<a;b++){var c=this._options.data[b];if(!c){continue}this._options._loaded[c.id]=c.name}}};qq.extend(qq.FileUploader.prototype,qq.FileUploaderBasic.prototype);qq.extend(qq.FileUploader.prototype,{clearStoredFiles:function(){qq.FileUploaderBasic.prototype.clearStoredFiles.apply(this,arguments);this._listElement.innerHTML=""},addExtraDropzone:function(a){this._setupExtraDropzone(a)},removeExtraDropzone:function(c){var a=this._options.extraDropzones;for(var b in a){if(a[b]===c){return this._options.extraDropzones.splice(b,1)}}},_leaving_document_out:function(a){return((qq.chrome()||(qq.safari()&&qq.windows()))&&a.clientX==0&&a.clientY==0)||(qq.firefox()&&!a.relatedTarget)},_storeFileForLater:function(b){qq.FileUploaderBasic.prototype._storeFileForLater.apply(this,arguments);var a=this._getItemByFileId(b);this._find(a,"spinner").style.display="none"},_find:function(c,b){var a=qq.getByClass(c,this._options.classes[b])[0];if(!a){throw new Error("element not found "+b)}return a},_setupExtraDropzone:function(a){this._options.extraDropzones.push(a);this._setupDropzone(a)},_setupDropzone:function(c){var b=this;var a=new qq.UploadDropZone({element:c,onEnter:function(f){qq.addClass(c,b._classes.dropActive);f.stopPropagation()},onLeave:function(f){},onLeaveNotDescendants:function(f){qq.removeClass(c,b._classes.dropActive)},onDrop:function(f){if(b._options.hideDropzones){c.style.display="none"}qq.removeClass(c,b._classes.dropActive);if(f.dataTransfer.files.length>1&&!b._options.multiple){b._error("tooManyFilesError","")}else{b._uploadFileList(f.dataTransfer.files)}}});this.addDisposer(function(){a.dispose()});if(this._options.hideDropzones){c.style.display="none"}},_setupDragDrop:function(){var a=this;if(!this._options.disableDefaultDropzone){var b=this._find(this._element,"drop");this._options.extraDropzones.push(b)}var e=this._options.extraDropzones;var c;for(c=0;c<e.length;c++){this._setupDropzone(e[c])}if(!this._options.disableDefaultDropzone&&!qq.ie()){this._attach(document,"dragenter",function(f){if(qq.hasClass(b,a._classes.dropDisabled)){return}b.style.display="block";for(c=0;c<e.length;c++){e[c].style.display="block"}})}this._attach(document,"dragleave",function(f){if(a._options.hideDropzones&&qq.FileUploader.prototype._leaving_document_out(f)){for(c=0;c<e.length;c++){e[c].style.display="none"}}});qq.attach(document,"drop",function(f){if(a._options.hideDropzones){for(c=0;c<e.length;c++){e[c].style.display="none"}}f.preventDefault()})},_onSubmit:function(b,a){qq.FileUploaderBasic.prototype._onSubmit.apply(this,arguments);this._addToList(b,a)},_onProgress:function(a,c,e,g){qq.FileUploaderBasic.prototype._onProgress.apply(this,arguments);var i=this._getItemByFileId(a);if(e===g){var b=this._find(i,"cancel");b.style.display="none"}var k=this._find(i,"size");k.style.display="inline";var h;var f=Math.round(e/g*100);if(e!=g){h=this._formatProgress(e,g)}else{h=this._formatSize(g)}this._find(i,"progressBar").style.width=f+"%";qq.setText(k,h)},_onComplete:function(e,c,a){qq.FileUploaderBasic.prototype._onComplete.apply(this,arguments);var b=this._getItemByFileId(e);qq.remove(this._find(b,"progressBar"));if(!this._options.disableCancelForFormUploads||qq.UploadHandlerXhr.isSupported()){qq.remove(this._find(b,"cancel"))}qq.remove(this._find(b,"spinner"));if(a.success){qq.addClass(b,this._classes.success);if(this._classes.successIcon){this._find(b,"finished").style.display="inline-block";qq.addClass(b,this._classes.successIcon)}this._options._loaded[a.id]=c}else{qq.addClass(b,this._classes.fail);if(this._classes.failIcon){this._find(b,"finished").style.display="inline-block";qq.addClass(b,this._classes.failIcon)}this._controlFailureTextDisplay(b,a)}},_onUpload:function(f,e,b){qq.FileUploaderBasic.prototype._onUpload.apply(this,arguments);var a=this._getItemByFileId(f);if(qq.UploadHandlerXhr.isSupported()){this._find(a,"progressBar").style.display="block"}var c=this._find(a,"spinner");if(c.style.display=="none"){c.style.display="inline-block"}},_addToList:function(f,e){var b=qq.toElement(this._options.fileTemplate);if(this._options.disableCancelForFormUploads&&!qq.UploadHandlerXhr.isSupported()){var a=this._find(b,"cancel");qq.remove(a)}b.qqFileId=f;var c=this._find(b,"file");qq.setText(c,this._formatFileName(e));this._find(b,"size").style.display="none";if(!this._options.multiple){this._clearList()}this._listElement.appendChild(b)},_clearList:function(){this._listElement.innerHTML="";this.clearStoredFiles()},_getItemByFileId:function(b){var a=this._listElement.firstChild;while(a){if(a.qqFileId==b){return a}a=a.nextSibling}},_bindCancelEvent:function(){var a=this,b=this._listElement;this._attach(b,"click",function(g){g=g||window.event;var f=g.target||g.srcElement;if(qq.hasClass(f,a._classes.cancel)){qq.preventDefault(g);var c=f.parentNode;while(c.qqFileId==undefined){c=f=f.parentNode}a._handler.cancel(c.qqFileId);qq.remove(c)}})},_formatProgress:function(e,a){var c=this._options.messages.formatProgress;function b(f,g){c=c.replace(f,g)}b("{percent}",Math.round(e/a*100));b("{total_size}",this._formatSize(a));return c},_controlFailureTextDisplay:function(c,b){var g,e,a,h,f;g=this._options.failedUploadTextDisplay.mode;e=this._options.failedUploadTextDisplay.maxChars;a=this._options.failedUploadTextDisplay.responseProperty;if(g==="custom"){var h=b[a];if(h){if(h.length>e){f=h.substring(0,e)+"..."}qq.setText(this._find(c,"failText"),f||h);if(this._options.failedUploadTextDisplay.enableTooltip){this._showTooltip(c,h)}}else{this.log("'"+a+"' is not a valid property on the server response.")}}else{if(g==="none"){qq.remove(this._find(c,"failText"))}else{if(g!=="default"){this.log("failedUploadTextDisplay.mode value of '"+g+"' is not valid")}}}},_showTooltip:function(a,b){a.title=b}});qq.UploadDropZone=function(a){this._options={element:null,onEnter:function(b){},onLeave:function(b){},onLeaveNotDescendants:function(b){},onDrop:function(b){}};qq.extend(this._options,a);qq.extend(this,qq.DisposeSupport);this._element=this._options.element;this._disableDropOutside();this._attachEvents()};qq.UploadDropZone.prototype={_dragover_should_be_canceled:function(){return qq.safari()||(qq.firefox()&&qq.windows())},_disableDropOutside:function(a){if(!qq.UploadDropZone.dropOutsideDisabled){if(this._dragover_should_be_canceled){qq.attach(document,"dragover",function(b){b.preventDefault()})}else{qq.attach(document,"dragover",function(b){if(b.dataTransfer){b.dataTransfer.dropEffect="none";b.preventDefault()}})}qq.UploadDropZone.dropOutsideDisabled=true}},_attachEvents:function(){var a=this;a._attach(a._element,"dragover",function(c){if(!a._isValidFileDrag(c)){return}var b=qq.ie()?null:c.dataTransfer.effectAllowed;if(b=="move"||b=="linkMove"){c.dataTransfer.dropEffect="move"}else{c.dataTransfer.dropEffect="copy"}c.stopPropagation();c.preventDefault()});a._attach(a._element,"dragenter",function(b){if(!a._isValidFileDrag(b)){return}a._options.onEnter(b)});a._attach(a._element,"dragleave",function(c){if(!a._isValidFileDrag(c)){return}a._options.onLeave(c);var b=document.elementFromPoint(c.clientX,c.clientY);if(qq.contains(this,b)){return}a._options.onLeaveNotDescendants(c)});a._attach(a._element,"drop",function(b){if(!a._isValidFileDrag(b)){return}b.preventDefault();a._options.onDrop(b)})},_isValidFileDrag:function(c){if(qq.ie()){return false}var b=c.dataTransfer,a=qq.safari();return b&&b.effectAllowed!="none"&&(b.files||(!a&&b.types.contains&&b.types.contains("Files")))}};qq.UploadButton=function(a){this._options={element:null,multiple:false,acceptFiles:null,name:"file",onChange:function(b){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"};qq.extend(this._options,a);qq.extend(this,qq.DisposeSupport);this._element=this._options.element;qq.css(this._element,{position:"relative",overflow:"hidden",direction:"ltr"});this._input=this._createInput()};qq.UploadButton.prototype={getInput:function(){return this._input},reset:function(){if(this._input.parentNode){qq.remove(this._input)}qq.removeClass(this._element,this._options.focusClass);this._input=this._createInput()},_createInput:function(){var b=document.createElement("input");if(this._options.multiple){b.setAttribute("multiple","multiple")}if(this._options.acceptFiles){b.setAttribute("accept",this._options.acceptFiles)}b.setAttribute("type","file");b.setAttribute("name",this._options.name);qq.css(b,{position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0});this._element.appendChild(b);var a=this;this._attach(b,"change",function(){a._options.onChange(b)});this._attach(b,"mouseover",function(){qq.addClass(a._element,a._options.hoverClass)});this._attach(b,"mouseout",function(){qq.removeClass(a._element,a._options.hoverClass)});this._attach(b,"focus",function(){qq.addClass(a._element,a._options.focusClass)});this._attach(b,"blur",function(){qq.removeClass(a._element,a._options.focusClass)});if(window.attachEvent){b.setAttribute("tabIndex","-1")}return b}};qq.UploadHandlerAbstract=function(a){this._options={debug:false,action:"/upload.php",maxFile:999,onProgress:function(f,e,b,c){},onComplete:function(e,c,b){},onCancel:function(c,b){},onUpload:function(e,c,b){}};qq.extend(this._options,a);this._queue=[];this._params={}};qq.UploadHandlerAbstract.prototype={log:function(a){if(this._options.debug&&window.console){console.log("[uploader] "+a)}},add:function(a){},upload:function(e,b){var a=this._queue.push(e);var c={};qq.extend(c,b);this._params[e]=c;if(a<=this._options.maxFile){this._upload(e,this._params[e])}},cancel:function(a){this._cancel(a);this._dequeue(a)},cancelAll:function(){for(var a=0;a<this._queue.length;a++){this._cancel(this._queue[a])}this._queue=[]},getName:function(a){},getSize:function(a){},getQueue:function(){return this._queue},_upload:function(a){},_cancel:function(a){},_dequeue:function(e){var b=qq.indexOf(this._queue,e);this._queue.splice(b,1);var a=this._options.maxFile;if(this._queue.length>=a&&b<a){var c=this._queue[a-1];this._upload(c,this._params[c])}}};qq.UploadHandlerForm=function(a){qq.UploadHandlerAbstract.apply(this,arguments);this._inputs={};this._detach_load_events={}};qq.extend(qq.UploadHandlerForm.prototype,qq.UploadHandlerAbstract.prototype);qq.extend(qq.UploadHandlerForm.prototype,{add:function(a){a.setAttribute("name",this._options.inputName);var b="qq-upload-handler-iframe"+qq.getUniqueId();this._inputs[b]=a;if(a.parentNode){qq.remove(a)}return b},getName:function(a){return this._inputs[a].value.replace(/.*(\/|\\)/,"")},_cancel:function(b){this._options.onCancel(b,this.getName(b));delete this._inputs[b];delete this._detach_load_events[b];var a=document.getElementById(b);if(a){a.setAttribute("src","javascript:false;");qq.remove(a)}},_upload:function(h,f){this._options.onUpload(h,this.getName(h),false);var b=this._inputs[h];if(!b){throw new Error("file with passed id was not added, or already uploaded or cancelled")}var g=this.getName(h);f[this._options.inputName]=g;var c=this._createIframe(h);var e=this._createForm(c,f);e.appendChild(b);var a=this;this._attachLoadEvent(c,function(){a.log("iframe loaded");var i=a._getIframeContentJSON(c);if(i.extraJs){jv.execJs(i.extraJs)}a._options.onComplete(h,g,i);a._dequeue(h);delete a._inputs[h];setTimeout(function(){a._detach_load_events[h]();delete a._detach_load_events[h];qq.remove(c)},1)});e.submit();qq.remove(e);return h},_attachLoadEvent:function(a,b){this._detach_load_events[a.id]=qq.attach(a,"load",function(){if(!a.parentNode){return}try{if(a.contentDocument&&a.contentDocument.body&&a.contentDocument.body.innerHTML=="false"){return}}catch(c){}b()})},_getIframeContentJSON:function(iframe){try{var doc=iframe.contentDocument?iframe.contentDocument:iframe.contentWindow.document,response;var innerHTML=doc.body.innerHTML;this.log("converting iframe's innerHTML to JSON");this.log("innerHTML = "+innerHTML);if(innerHTML.slice(0,5).toLowerCase()=="<pre>"&&innerHTML.slice(-6).toLowerCase()=="</pre>"){innerHTML=doc.body.firstChild.firstChild.nodeValue}response=eval("("+innerHTML+")")}catch(err){response={success:false}}return response},_createIframe:function(b){var a=qq.toElement('<iframe src="javascript:false;" name="'+b+'" />');a.setAttribute("id",b);a.style.display="none";document.body.appendChild(a);return a},_createForm:function(a,e){var c=this._options.demoMode?"GET":"POST";var b=qq.toElement('<form method="'+c+'" enctype="multipart/form-data"></form>');var f=qq.obj2url(e,this._options.action);b.setAttribute("action",f);b.setAttribute("target",a.name);b.style.display="none";document.body.appendChild(b);return b}});qq.UploadHandlerXhr=function(a){qq.UploadHandlerAbstract.apply(this,arguments);this._files=[];this._xhrs=[]};qq.UploadHandlerXhr.isSupported=function(){var a=document.createElement("input");a.type="file";return("multiple" in a&&typeof File!="undefined"&&typeof FormData!="undefined"&&typeof(new XMLHttpRequest()).upload!="undefined")};qq.extend(qq.UploadHandlerXhr.prototype,qq.UploadHandlerAbstract.prototype);qq.extend(qq.UploadHandlerXhr.prototype,{add:function(a){if(!(a instanceof File)){throw new Error("Passed obj in not a File (in qq.UploadHandlerXhr)")}return this._files.push(a)-1},getName:function(b){var a=this._files[b];return(a.fileName!==null&&a.fileName!==undefined)?a.fileName:a.name},getSize:function(b){var a=this._files[b];return a.fileSize!=null?a.fileSize:a.size},_upload:function(c,g){this._options.onUpload(c,this.getName(c),true);var f=this._files[c],b=this.getName(c),m=this.getSize(c);var k=this._xhrs[c]=new XMLHttpRequest();var l=this;k.upload.onprogress=function(n){if(n.lengthComputable){l._options.onProgress(c,b,n.loaded,n.total)}};var h=jv.getDoer();k.onreadystatechange=function(){if(k.readyState==4){l._onComplete(c,k,{originalEvent:true,target:h})}};g=g||{};g[this._options.inputName]=b;g.sizeLimit=this._options.sizeLimit;var a=qq.obj2url(g,this._options.action);var i=this._options.demoMode?"GET":"POST";k.open(i,a,true);k.setRequestHeader("X-Requested-With","XMLHttpRequest");k.setRequestHeader("X-File-Name",encodeURIComponent(b));k.setRequestHeader("Cache-Control","no-cache");if(this._options.forceMultipart){var e=new FormData();e.append(this._options.inputName,f);f=e}else{k.setRequestHeader("Content-Type","application/octet-stream");k.setRequestHeader("X-Mime-Type",f.type)}for(key in this._options.customHeaders){k.setRequestHeader(key,this._options.customHeaders[key])}k.send(f)},_onComplete:function(id,xhr){if(!this._files[id]){return}var name=this.getName(id);var size=this.getSize(id);var response;this.log("xhr - server response received");this.log("responseText = "+xhr.responseText);try{if(typeof JSON.parse==="function"){response=JSON.parse(xhr.responseText)}else{response=eval("("+xhr.responseText+")")}}catch(err){response={}}try{if(response.extraJs){jv.execJs(response.extraJs)}}catch(e){}if(xhr.status!==200){this._options.onError(id,name,"XHR returned response code "+xhr.status)}this._options.onComplete(id,name,response);this._xhrs[id]=null;this._dequeue(id)},_cancel:function(a){this._options.onCancel(a,this.getName(a));this._files[a]=null;if(this._xhrs[a]){this._xhrs[a].abort();this._xhrs[a]=null}}});qq.DisposeSupport={_disposers:[],dispose:function(){var a;while(a=this._disposers.shift()){a()}},addDisposer:function(a){this._disposers.push(a)},_attach:function(){this.addDisposer(qq.attach.apply(this,arguments))}};function ListFile(f,c){c=ListFile.GenOption(c);var b=$(jv.getType(f)=="string"?"#"+f:f);b.addClass("ListFile").empty().data("listFile",this);$(c.data).each(function(g,h){if(g>0){b.append(c.separator||" , ")}b.append(ListFile.CreateItem(c,h))});var e=$('<button style="display:none">确定</button>');b.append(e);e.click(function(){if(p.removeOKCallback){var g=[];$(this).parent().find(".FileItem.DelFile").each(function(k,l){g.push($(l).attr("dbid"))});var h=ListFile.GetIds(b);b.find(">input[name="+c.hidden+"]").val(h.join(","));p.removeOKCallback(g,h)}});if(!b.find(">input[name="+c.hidden+"]").length){var a=document.createElement("input");a.type="hidden";a.name=c.hidden;b.append(a)}}ListFile.GenOption=function(a){return $.extend({data:false,canRecv:false,edit:false,link:"{url}",target:"blank",removeOKCallback:function(c,b){},removeCancel:function(b){}},a)};ListFile.Get=function(a){return ListFile.GetContainer(a).data("listFile")};ListFile.GetIds=function(c){var b=[];var a=$(jv.getType(c)=="string"?"#"+c:c);a.find(".FileItem").each(function(g,h){var f=$(h);if(f.hasClass("DelFile")){return}var e=f.attr("dbid");if(e!==""){b.push(e)}});return b};ListFile.GetContainer=function(b){var a=$(jv.getType(b)=="string"?"#"+b:b);return a.closest(".ListFile")};ListFile.CreateLink=function(c,b){c=ListFile.GenOption(c);var a=$(document.createElement("a"));a.attr("target","_blank");if(c.link){a.attr("href",jv.url(c.link.formatEx(b)).toString())}if(b.icon){a.append($('<img src="'+jv.url(b.icon).href+'" />'))}a.append(b.name);if(c.callback){a.click(function(){c.callback(b)})}return a};ListFile.SyncDisplay=function(c){var a=ListFile.GetContainer(elem);var b=false;if(a.find(".FileItem.DelFile").length>0){a.find("button").show()}else{a.find("button").hide()}};ListFile.CreateItem=function(c,b){c=ListFile.GenOption(c);var a=$('<span class="FileItem" dbid="'+b.id+'" qqfileid="'+((b.qqFileId===0||b.qqFileId)?b.qqFileId:"")+'"></span>');a.append(ListFile.CreateLink(c,b));if(c.edit){a.append(ListFile.CreateDel(c,b))}return a};ListFile.AppendItem=function(e,f,a){f=ListFile.GenOption(f);var b=$(jv.getType(e)=="string"?"#"+e:e);if(a.id){var c=b.find("button");if(b.find(".FileItem").length){$(document.createTextNode(f.separator||" , ")).insertBefore(c)}ListFile.CreateItem(f,a).insertBefore(c)}var g=ListFile.GetIds(e);b.find(">input[name="+f.hidden+"]").val(g.join(","))};ListFile.CreateDel=function(c,b){c=ListFile.GenOption(c);if(!c.edit){return null}var a=$('<div class="DelBtn Inline Icon16"></div>');a.click(function(){var f=$(this);var k=ListFile.GetContainer(f);if(c.canRecv){var g=f.parent();if(g.hasClass("DelFile")){g.removeClass("DelFile");ListFile.SyncDisplay(this)}else{g.addClass("DelFile");ListFile.GetContainer(this).find("button").show()}}else{var e=this.parentNode.previousSibling;if(!e||(e.nodeType!=3)){e=this.parentNode.nextSibling}if(e&&(e.nodeType==3)){e.nodeValue=""}var i=jv.getParentTag(this,"SPAN");var h=jv.getParentTag(i,"DIV");c.upFile._remove(i.getAttribute("dbId"));$(i).remove()}var l=ListFile.GetIds(k);k.find(">input[name="+c.hidden+"]").val(l.join(","))});return a};function TableFile(e,a){var g=document.createElement("thead");e.append(g);e.append(document.createElement("tbody"));e.addClass("ListFile");var h=document.createElement("tr");g.appendChild(h);var b=document.createElement("th");h.appendChild(b);var k=document.createElement("input");k.type="hidden";k.name=a.hidden;b.appendChild(k);b.appendChild(k);b.style.display="none";var b=document.createElement("th");b.innerHTML="文件说明";b.className="fileName";h.appendChild(b);var b=document.createElement("th");b.innerHTML="大小（KB）";h.appendChild(b);var b=document.createElement("th");b.innerHTML="[下载]";h.appendChild(b);if(a.edit){var b=document.createElement("th");b.innerHTML="[删除]";h.appendChild(b)}if(a.data){for(var f=0,c=a.data.length;f<c;f++){var l=a.data[f];TableFile.AppendItem(e,a,l)}}}TableFile.AppendItem=function(f,h,c){var g=document.createElement("tr");g.id="row"+c.id;g.setAttribute("qqFileId",c.qqFileId);$(f).find("tbody").append(g);var e=document.createElement("td");e.style.display="none";e.innerHTML=c.id;g.appendChild(e);var e=document.createElement("td");e.innerHTML=c.name;g.appendChild(e);var e=document.createElement("td");e.innerHTML=parseInt(parseInt(c.size)/1024);g.appendChild(e);var e=document.createElement("td");e.innerHTML='<a href="'+c.url+'" target="_blank"><div class="Inline DownloadIcon Icon16"></div></a>';g.appendChild(e);if(h.edit){var e=document.createElement("td");e.innerHTML='<div class="Inline DeleteIcon Icon16" onclick="javascript:return TableFile.DeleteFile(\''+h.hidden+"',event);\" ></div>";g.appendChild(e)}var a=$("input[name="+h.hidden+"]",f);var b=a.val().mySplit(",",true);b.push(c.id);a.val(b.join(","))};TableFile.DeleteFile=function(g,f){if(!confirm("确认删除该文件吗？")){return false}var c=$(jv.GetDoer()).closest("tr");var b=c.closest("table");var a=b.find("thead tr th input[name="+g+"]");var e=a.val().mySplit(",",true);e.remove(c.attr("id").slice(3));a.val(e.join(","));this.upFile._remove(c.attr("qqFileId"));c.remove()};